# 專案現況與下一步建議

**生成時間**: 2025-01-09  
**專案狀態**: 🟡 開發中期（約 60% 完成）

---

## 📊 專案現況總覽

### ✅ 已完成功能

| 模組 | 功能 | 狀態 | 備註 |
|------|------|------|------|
| **認證系統** | 登入/登出/註冊 | ✅ 完成 | 完整實現 |
| **用戶管理 (UPMS)** | 用戶 CRUD、角色、權限 | ✅ 完成 | 功能齊全 |
| **車隊管理 (FMS)** | 車輛管理、司機管理 | ✅ 完成 | 基礎功能完成 |
| **系統管理 (ADM)** | 字典管理 | ✅ 完成 | 基礎功能 |
| **訂單管理 (TOM)** | Overview/List/Create/Detail | 🟡 部分完成 | 使用 Mock 數據 |

### 🔄 進行中功能

| 模組 | 功能 | 狀態 | 問題 |
|------|------|------|------|
| **TOM 訂單模組** | API 整合 | 🔄 進行中 | 目前使用 Mock，需連接真實 API |

### ❌ 待完成功能

| 模組 | 功能 | 優先級 | 預估工時 |
|------|------|--------|----------|
| **TOM 訂單指派** | AssignPage 組件實現 | 🔴 高 | 2-3 天 |
| **TOM 訂單報表** | ReportPage 組件實現 | 🟡 中 | 3-4 天 |
| **後端 API 整合** | 連接真實 API 端點 | 🔴 高 | 視後端進度 |
| **任務管理** | TransportTasksPage 完善 | 🟡 中 | 2-3 天 |
| **代碼清理** | 移除重複代碼 | 🟢 低 | 1 天 |

---

## 🎯 優先級建議

### 🔴 **優先級 1：必須立即處理**

#### 1. **實現訂單指派功能（AssignPage）**

**現況**：
- 路由已配置：`/tom/order/assign`
- 組件未實現（目前是註釋掉的佔位符）

**任務清單**：
- [ ] 創建 `src/app/pages/tom/order/assign/AssignPage.tsx`
- [ ] 實現待指派訂單列表顯示
- [ ] 實現車輛/司機選擇功能
- [ ] 實現指派邏輯與 API 調用
- [ ] 整合 FMS 模組獲取可用車輛/司機

**參考文件**：
- `訂單管理模組文件.md` - 第 6 節「訂單指派」
- `src/app/pages/tom/TOM.README` - TOM v1 規格

**相關文件位置**：
```
src/app/pages/tom/order/
├── assign/              # 需要創建此目錄
│   ├── AssignPage.tsx   # 主組件
│   ├── AssignForm.tsx   # 指派表單（可選）
│   └── VehicleSelect.tsx # 車輛選擇組件（可選）
```

#### 2. **後端 API 整合**

**現況**：
- `Query.tsx` 中 API 調用被註釋，使用 Mock 數據
- API 端點已定義但未連接

**任務清單**：
- [ ] 確認後端 API 端點是否已實現
- [ ] 啟用 `Query.tsx` 中的真實 API 調用
- [ ] 移除或條件化 Mock 數據
- [ ] 測試所有 CRUD 操作
- [ ] 處理錯誤情況與邊界條件

**需要檢查的 API 端點**：
```
GET    /api/tom/orders              # 訂單列表
GET    /api/tom/orders/:id          # 訂單詳情
POST   /api/tom/orders              # 創建訂單
PUT    /api/tom/orders/:id          # 更新訂單
DELETE /api/tom/orders/:id          # 刪除訂單
POST   /api/tom/orders/:id/assign   # 指派訂單（待實現）
GET    /api/tom/orders/:id/history  # 訂單歷史（待實現）
```

**相關文件**：
- `src/app/pages/tom/order/Query.tsx` - 需要啟用真實 API

---

### 🟡 **優先級 2：近期完成**

#### 3. **實現訂單報表功能（ReportPage）**

**現況**：
- 路由已配置：`/tom/order/report`
- 組件未實現

**任務清單**：
- [ ] 創建 `src/app/pages/tom/order/report/ReportPage.tsx`
- [ ] 實現報表篩選條件（日期範圍、狀態、類型）
- [ ] 實現統計圖表顯示
- [ ] 實現報表匯出功能（Excel/PDF）
- [ ] 整合圖表庫（Chart.js/ApexCharts）

**參考文件**：
- `訂單管理模組文件.md` - 第 7 節「訂單報表」

#### 4. **完善任務管理模組**

**現況**：
- 路由已配置但部分頁面未實現
- `TransportTasksPage` 有基礎結構

**任務清單**：
- [ ] 完善 `tasks/overview/OverviewPage.tsx`
- [ ] 完善 `tasks/detail/DetailPage.tsx`
- [ ] 實現任務狀態更新
- [ ] 實現任務指派流程

---

### 🟢 **優先級 3：優化與清理**

#### 5. **代碼清理與重構**

**問題**：
- 存在兩個訂單目錄：
  - `src/app/pages/order/` （舊版？）
  - `src/app/pages/tom/order/` （新版）

**任務清單**：
- [ ] 確認哪個目錄是當前使用的版本
- [ ] 移除未使用的代碼和文件
- [ ] 更新所有引用路徑
- [ ] 清理未使用的組件和工具函數

**需要檢查的文件**：
```
src/app/pages/order/          # 需要確認是否仍在使用
├── OrderCreate.tsx
├── OrderDetail.tsx
├── OrderEdit.tsx
├── OrderAssign.tsx
├── OrderReport.tsx
└── ...
```

#### 6. **完善路由配置**

**現況**：
- `PrivateRoutes.tsx` 有 TODO 註解
- 部分路由資訊需要補充

**任務清單**：
- [ ] 補充路由註解和說明
- [ ] 確認所有路由的權限配置
- [ ] 添加路由守衛（如需要）

---

## 🛠️ 技術債務

### 當前技術債務清單

1. **Mock 數據未移除**
   - `src/app/pages/tom/order/Query.tsx` - 使用 Mock 數據
   - `src/app/pages/tom/order/list/mockOrders.tsx` - Mock 數據文件
   - `src/app/pages/tom/order/overview/OverviewPage.tsx` - 硬編碼的 Mock 數據

2. **API 調用被註釋**
   - 真實 API 調用代碼存在但被註釋，需要啟用

3. **類型定義不完整**
   - 部分組件缺少完整的 TypeScript 類型定義

4. **錯誤處理不統一**
   - 各模組的錯誤處理方式不一致

---

## 📋 建議的開發流程

### 階段 1：核心功能完成（1-2 週）

1. **實現訂單指派功能**
   ```
   Day 1-2: 實現 AssignPage 組件
   Day 3:   整合 FMS 模組獲取車輛/司機
   Day 4:   實現指派邏輯與狀態更新
   Day 5:   測試與調試
   ```

2. **後端 API 整合**
   ```
   Day 1:   與後端確認 API 規格
   Day 2-3: 啟用並測試 API 調用
   Day 4:   移除 Mock 數據
   Day 5:   錯誤處理與優化
   ```

### 階段 2：擴展功能（1-2 週）

3. **實現訂單報表功能**
   ```
   Day 1-2: 實現報表頁面結構
   Day 3:   整合圖表庫與數據視覺化
   Day 4:   實現報表匯出功能
   Day 5:   測試與優化
   ```

### 階段 3：優化與清理（3-5 天）

4. **代碼清理**
   ```
   Day 1:   分析代碼重複情況
   Day 2:   移除未使用代碼
   Day 3:   統一代碼風格
   ```

---

## 🔍 關鍵文件位置

### 訂單管理相關
- **主路由**: `src/app/pages/tom/order/index.tsx`
- **API 調用**: `src/app/pages/tom/order/Query.tsx`
- **數據模型**: `src/app/pages/tom/order/Model.tsx`
- **列表頁**: `src/app/pages/tom/order/list/ListPage.tsx`
- **創建頁**: `src/app/pages/tom/order/create/CreatePage.tsx`
- **詳情頁**: `src/app/pages/tom/order/detail/DetailPage.tsx`
- **總覽頁**: `src/app/pages/tom/order/overview/OverviewPage.tsx`

### 文檔
- **專案架構**: `專案架構分析報告.md`
- **訂單模組**: `訂單管理模組文件.md`
- **TOM 規格**: `src/app/pages/tom/TOM.README`

### 共用組件
- **HTTP 客戶端**: `src/shared/api/http.ts`
- **路由配置**: `src/app/routing/PrivateRoutes.tsx`
- **通用工具**: `src/app/pages/common/`

---

## 💡 開發建議

### 1. **立即行動**

**建議從訂單指派功能開始**，因為：
- 這是核心業務流程
- 路由已配置，只需實現組件
- 可以驗證 TOM 與 FMS 模組的整合

### 2. **API 整合策略**

**建議採用漸進式整合**：
1. 保持 Mock 數據作為 fallback
2. 先連接讀取 API（GET）
3. 再連接寫入 API（POST/PUT/DELETE）
4. 最後移除 Mock 數據

### 3. **代碼組織建議**

**保持現有的模組化結構**：
- 每個功能模組獨立目錄
- Query.ts 負責 API 調用
- Model.ts 負責類型定義
- 組件按功能分離

### 4. **測試建議**

**優先測試核心流程**：
1. 訂單創建 → 訂單列表 → 訂單詳情
2. 訂單指派流程
3. 狀態變更流程

---

## 📞 需要確認的事項

### 與後端對接

1. **API 端點確認**
   - [ ] `/api/tom/orders` 是否已實現？
   - [ ] API 規格文檔是否完整？
   - [ ] 認證機制是否統一？

2. **數據格式確認**
   - [ ] 請求和回應格式是否對齊？
   - [ ] 錯誤回應格式是否統一？

### 業務需求確認

1. **訂單指派流程**
   - [ ] 是否支援批量指派？
   - [ ] 指派規則是什麼？
   - [ ] 是否需要自動指派功能？

2. **報表需求**
   - [ ] 需要哪些統計維度？
   - [ ] 匯出格式需求？

---

## 🎯 總結

### 當前最優先任務

1. **🔴 實現訂單指派功能** - 核心業務流程
2. **🔴 後端 API 整合** - 系統能正常運作

### 預期完成時間

- **核心功能完成**: 1-2 週
- **擴展功能完成**: 3-4 週
- **優化與清理**: 1 週

### 下一步行動

**建議立即開始**：
1. 創建 `AssignPage.tsx` 組件
2. 參考 `CreatePage.tsx` 和 `ListPage.tsx` 的實現方式
3. 整合 FMS 模組獲取車輛/司機列表
4. 實現指派表單與邏輯

---

**最後更新**: 2025-01-09  
**報告生成**: AI 助手自動分析
