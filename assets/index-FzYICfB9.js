import{r,j as e}from"./react-DwkAs-v9.js";import{i as I,h as L,o as B,K as M,e as G,C as X,P as Y}from"./index-CbhZY4ci.js";import{A as H}from"./AppToolbar-BZHSVYI7.js";import{C as J}from"./ConfirmDeleteModal-B-C_keKM.js";import{A as Z,E as Q,M as V}from"./MockDataDialog-BG3uQJ4e.js";import{P as q}from"./PagedTable-fW2f3xMh.js";import{a as K,d as w,e as W,f as A}from"./react-router-Df4HDh8c.js";import"./apexcharts-sziEC8OT.js";import"./react-dom-DVTd-Q6a.js";import"./scheduler-CylivXx-.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-bootstrap-BUaeuJHt.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./@popperjs-D8Kg5PqX.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";import"./@babel-B036hIWL.js";import"./react-select-Z1ywkuii.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";const R=[{id:"1",formulaName:"標準薪資公式",driverId:"1",driverName:"張三",tripFee:5e3,overtimeRate:200,nightShiftSubsidy:150,effectiveDate:"2024-01-01",status:"active",createdAt:"2023-12-20T10:00:00Z",updatedAt:"2023-12-20T10:00:00Z"},{id:"2",formulaName:"高級司機薪資公式",driverId:"2",driverName:"李四",tripFee:6e3,overtimeRate:250,nightShiftSubsidy:200,effectiveDate:"2024-01-01",status:"active",createdAt:"2023-12-20T10:00:00Z",updatedAt:"2023-12-20T10:00:00Z"}],z="/api/hrm/salary-formulas";async function ee(t,a){if(I())return console.log("[Mock] 模擬創建薪資計算公式",t),await new Promise(s=>setTimeout(s,500)),a==null||a("薪資計算公式建立成功 (Mock)","success"),!0;try{return await L.post(z,t),a==null||a("薪資計算公式建立成功","success"),!0}catch(s){return console.error(s),a==null||a("建立薪資計算公式失敗，請稍後再試","danger"),!1}}async function te(t,a){if(I())return console.log("[Mock] 使用 Mock 薪資計算公式列表",t),await new Promise(s=>setTimeout(s,300)),Promise.resolve({content:R,totalElements:R.length,totalPages:1,size:t.size??10,number:t.page??0,first:(t.page??0)===0,last:!0,empty:R.length===0});try{const i=(await L.get(z,{params:t})).data.data;return{...i,content:i.content||[]}}catch(s){console.error(s);const i=Z.fromAxiosError(s);if(i.isServerError)throw i;return a==null||a("取得薪資計算公式列表失敗，請稍後再試","danger"),{content:[],totalElements:0,totalPages:0,size:t.size??10,number:t.page??0,first:!0,last:!0,empty:!0}}}async function ae(t,a,s){if(I())return console.log("[Mock] 模擬更新薪資計算公式",t,a),await new Promise(o=>setTimeout(o,500)),s==null||s("更新薪資計算公式成功 (Mock)","success"),R.find(o=>o.id===t);try{const i=await L.put(`${z}/${t}`,a);return s==null||s("更新薪資計算公式成功","success"),i.data.data}catch(i){throw console.error(i),s==null||s("更新薪資計算公式失敗，請稍後再試","danger"),i}}async function se(t,a){if(I())return console.log("[Mock] 模擬刪除薪資計算公式",t),await new Promise(s=>setTimeout(s,500)),a==null||a("刪除薪資計算公式成功 (Mock)","success"),!0;try{return await L.delete(`${z}/${t}`),a==null||a("刪除薪資計算公式成功","success"),!0}catch(s){return console.error(s),a==null||a("刪除薪資計算公式失敗，請稍後再試","danger"),!1}}const re=10,ne=t=>t?new Date(t).toLocaleDateString("zh-TW"):"-",$=t=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(t),ie=t=>{if(!t)return{label:"-",className:"badge-light-secondary"};switch(t){case"active":return{label:"啟用",className:"badge-light-success"};case"inactive":return{label:"停用",className:"badge-light-danger"};default:return{label:t,className:"badge-light-secondary"}}},le=({searchKeyword:t,showAlert:a,onEdit:s})=>{const i=K(),[o,x]=r.useState([]),[b,S]=r.useState(0),[k,C]=r.useState(1),[u,p]=r.useState(1),[g,f]=r.useState(!1),[c,N]=r.useState(null),[v,h]=r.useState(!1),[m,j]=r.useState(!1),[P,E]=r.useState(!1),d=r.useCallback(async()=>{f(!0),j(!1);try{const n={page:u-1,size:re,keyword:t!=null&&t.trim()?t.trim():void 0},y=await te(n,a);x(y.content),S(y.totalElements),C(y.totalPages||1)}catch(n){Z.fromAxiosError(n).isServerError?(j(!0),E(!0)):a("取得薪資計算公式列表失敗，請稍後再試","danger")}finally{f(!1)}},[u,t,a]),T=r.useCallback(()=>{B(),E(!1),j(!1),d()},[d]),O=r.useCallback(()=>{j(!1),d()},[d]);r.useEffect(()=>{p(1)},[t]),r.useEffect(()=>{d()},[d]);const F=r.useCallback(n=>{i(`/hrm/salary/${n.id}/detail`)},[i]),l=n=>N(n),U=async()=>{if(!c)return;const n=c.id;if(!n){a("缺少薪資計算公式識別碼，無法刪除","danger");return}try{h(!0),await se(String(n),a)&&(await d(),N(null))}finally{h(!1)}};if(m)return e.jsxs(e.Fragment,{children:[e.jsx(Q,{onRetry:O,showMockOption:!0,onUseMock:T}),e.jsx(V,{open:P,onConfirm:T,onCancel:()=>E(!1)})]});const _=[{header:"公式名稱",className:"min-w-150px"},{header:"司機姓名",className:"min-w-100px"},{header:"趟次費",className:"min-w-120px text-end"},{header:"加班費率",className:"min-w-120px text-end"},{header:"夜間補貼",className:"min-w-120px text-end"},{header:"生效日期",className:"min-w-120px"},{header:"狀態",className:"min-w-100px"},{header:"操作",className:"text-end min-w-200px"}];return e.jsxs(e.Fragment,{children:[e.jsx(q,{columns:_,rows:o,loading:g,emptyText:"沒有薪資計算公式資料",page:u,totalPages:k,totalElements:b,onPrev:()=>p(n=>Math.max(1,n-1)),onNext:()=>p(n=>Math.min(k||1,n+1)),renderRow:n=>{const y=ie(n.status);return e.jsxs("tr",{className:"cursor-pointer table-row-hover",onClick:()=>F(n),children:[e.jsx("td",{className:"fw-bold text-gray-900",children:n.formulaName}),e.jsx("td",{children:n.driverName||"-"}),e.jsx("td",{className:"text-end",children:$(n.tripFee)}),e.jsxs("td",{className:"text-end",children:[$(n.overtimeRate),"/時"]}),e.jsxs("td",{className:"text-end",children:[$(n.nightShiftSubsidy),"/時"]}),e.jsx("td",{children:ne(n.effectiveDate)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${y.className} fw-bold`,children:y.label})}),e.jsx("td",{className:"text-end",onClick:D=>D.stopPropagation(),children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-light-primary btn-sm",onClick:D=>{D.preventDefault(),F(n)},title:"查看詳情",children:e.jsx(M,{iconName:"eye",className:"fs-2"})}),s&&e.jsx("button",{className:"btn btn-light-warning btn-sm",onClick:D=>{D.preventDefault(),s(n)},title:"編輯",children:e.jsx(M,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-light-danger btn-sm",onClick:D=>{D.preventDefault(),l(n)},title:"刪除",children:e.jsx(M,{iconName:"trash",className:"fs-2"})})]})})]},String(n.id??Math.random()))}}),c&&e.jsx(J,{open:!!c,title:"刪除薪資計算公式",deleting:v,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除薪資計算公式 ",e.jsx("strong",{children:c.formulaName??"-"})," 嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>v?null:N(null),onConfirm:U})]})},oe=({open:t,onClose:a,onSaved:s,showAlert:i,editingFormula:o})=>{const x=!!o,[b,S]=r.useState(""),[k,C]=r.useState(""),[u,p]=r.useState(""),[g,f]=r.useState(""),[c,N]=r.useState(""),[v,h]=r.useState(""),[m,j]=r.useState(""),[P,E]=r.useState(""),[d,T]=r.useState(!1);r.useEffect(()=>{if(t){if(!o){S(""),C(""),p(""),f(""),N(""),h(""),j(""),E("");return}S(o.formulaName||""),C(o.driverId||""),p(o.tripFee||""),f(o.overtimeRate||""),N(o.nightShiftSubsidy||""),h(o.effectiveDate||""),j(o.expiryDate||"")}},[t,o]);const O=()=>b.trim()?u===""||Number.isNaN(Number(u))||Number(u)<0?(i("請輸入有效的趟次費","warning"),!1):g===""||Number.isNaN(Number(g))||Number(g)<0?(i("請輸入有效的加班費率","warning"),!1):c===""||Number.isNaN(Number(c))||Number(c)<0?(i("請輸入有效的夜間補貼","warning"),!1):v?!0:(i("請選擇生效日期","warning"),!1):(i("請輸入公式名稱","warning"),!1),F=async()=>{if(O())try{T(!0);const l={...x?{id:o.id}:{},formulaName:b.trim(),driverId:k.trim()||void 0,tripFee:Number(u),overtimeRate:Number(g),nightShiftSubsidy:Number(c),effectiveDate:v,expiryDate:m||void 0,notes:P.trim()||void 0};x&&o?await ae(o.id,l,i):await ee(l,i),s()}catch(l){console.error(l),i("儲存失敗，請稍後再試","danger")}finally{T(!1)}};return t?e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,.25)"},role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(M,{iconName:x?"message-edit":"plus",className:"fs-2 me-2"}),x?"編輯薪資計算公式":"新增薪資計算公式"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:a,disabled:d,"aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"公式名稱"}),e.jsx("input",{className:"form-control",value:b,onChange:l=>S(l.target.value),placeholder:"請輸入公式名稱",autoFocus:!x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"司機 ID"}),e.jsx("input",{className:"form-control",value:k,onChange:l=>C(l.target.value),placeholder:"請輸入司機 ID（選填）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"趟次費"}),e.jsx("input",{className:"form-control",type:"number",min:"0",value:u,onChange:l=>p(l.target.value===""?"":Number(l.target.value)),placeholder:"請輸入趟次費"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"加班費率（每小時）"}),e.jsx("input",{className:"form-control",type:"number",min:"0",value:g,onChange:l=>f(l.target.value===""?"":Number(l.target.value)),placeholder:"請輸入加班費率"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"夜間補貼（每小時）"}),e.jsx("input",{className:"form-control",type:"number",min:"0",value:c,onChange:l=>N(l.target.value===""?"":Number(l.target.value)),placeholder:"請輸入夜間補貼"})]})]}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"生效日期"}),e.jsx("input",{className:"form-control",type:"date",value:v,onChange:l=>h(l.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"失效日期"}),e.jsx("input",{className:"form-control",type:"date",value:m,onChange:l=>j(l.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"備註"}),e.jsx("textarea",{className:"form-control",rows:8,value:P,onChange:l=>E(l.target.value),placeholder:"請輸入備註"})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-light",onClick:a,disabled:d,children:"取消"}),e.jsx("button",{className:"btn btn-primary",onClick:F,disabled:d,children:d?"儲存中…":"儲存"})]})]})})}):null};function ce(){const{alert:t,showAlert:a,Alert:s}=G(),i=K(),[o,x]=r.useState(""),[b,S]=r.useState(""),[k,C]=r.useState(0),[u,p]=r.useState(!1),[g,f]=r.useState(null),c=m=>{m.key==="Enter"&&x(b.trim())},N=()=>{C(m=>m+1),p(!1),f(null)},v=()=>{i("/hrm/salary/create")},h=m=>{f(m),p(!0)};return e.jsxs(X,{children:[t&&e.jsx(s,{message:t.message,type:t.type}),e.jsx(H,{title:"薪資計算公式",breadcrumbs:[{label:"人資管理",href:"#"},{label:"薪資計算公式",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(M,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"公式名稱 / 司機姓名…",value:b,onChange:m=>S(m.target.value),onKeyDown:c})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end gap-2 flex-wrap",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:v,children:[e.jsx(M,{iconName:"plus",className:"fs-2"}),"新增薪資計算公式"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(le,{searchKeyword:o,showAlert:a,onEdit:h},k)})]})}),e.jsx(oe,{open:u,onClose:()=>{p(!1),f(null)},showAlert:a,editingFormula:g,onSaved:N})]})}const me=[{title:"薪資計算公式",path:"/hrm/salary/list",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],ot=()=>e.jsxs(w,{children:[e.jsx(W,{path:"",element:e.jsx(A,{to:"list",replace:!0})}),e.jsx(W,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(Y,{breadcrumbs:me,children:"薪資計算公式"}),e.jsx(ce,{})]})})]});export{ot as default};
