import{r as o,j as e}from"./react-DwkAs-v9.js";import{i as I,h as O,K as P,e as H,C as Y,P as F}from"./index-BdFDZIEO.js";import{A as G}from"./AppToolbar-BZHSVYI7.js";import{S as U,M as K}from"./react-bootstrap-BUaeuJHt.js";import{d as W,e as $}from"./react-router-Df4HDh8c.js";import"./apexcharts-sziEC8OT.js";import"./react-dom-DVTd-Q6a.js";import"./scheduler-CylivXx-.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-select-Z1ywkuii.js";import"./@babel-B036hIWL.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./@popperjs-D8Kg5PqX.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";const R=[{id:"dict-001",code:"ORDER_STATUS",name:"訂單狀態",enabled:!0,remark:"訂單狀態字典",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"dict-002",code:"VEHICLE_TYPE",name:"車輛類型",enabled:!0,remark:"車輛類型字典",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"dict-003",code:"DRIVER_STATUS",name:"司機狀態",enabled:!0,remark:"司機狀態字典",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"dict-004",code:"CONTAINER_TYPE",name:"貨櫃類型",enabled:!0,remark:"貨櫃類型字典",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"dict-005",code:"PAYMENT_STATUS",name:"付款狀態",enabled:!0,remark:"付款狀態字典",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"}],V=[{id:"item-001",dictionaryId:"dict-001",itemCode:"PENDING",itemLabel:"待處理",sortOrder:1,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-002",dictionaryId:"dict-001",itemCode:"CONFIRMED",itemLabel:"已確認",sortOrder:2,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-003",dictionaryId:"dict-001",itemCode:"IN_PROGRESS",itemLabel:"進行中",sortOrder:3,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-004",dictionaryId:"dict-001",itemCode:"COMPLETED",itemLabel:"已完成",sortOrder:4,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-005",dictionaryId:"dict-001",itemCode:"CANCELLED",itemLabel:"已取消",sortOrder:5,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-006",dictionaryId:"dict-002",itemCode:"TRACTOR",itemLabel:"車頭",sortOrder:1,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-007",dictionaryId:"dict-002",itemCode:"TRAILER_20",itemLabel:"20尺板車",sortOrder:2,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-008",dictionaryId:"dict-002",itemCode:"TRAILER_40",itemLabel:"40尺板車",sortOrder:3,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-009",dictionaryId:"dict-003",itemCode:"ACTIVE",itemLabel:"在職",sortOrder:1,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-010",dictionaryId:"dict-003",itemCode:"INACTIVE",itemLabel:"離職",sortOrder:2,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-011",dictionaryId:"dict-003",itemCode:"LEAVE",itemLabel:"請假",sortOrder:3,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-012",dictionaryId:"dict-004",itemCode:"20GP",itemLabel:"20尺一般櫃",sortOrder:1,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-013",dictionaryId:"dict-004",itemCode:"40GP",itemLabel:"40尺一般櫃",sortOrder:2,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-014",dictionaryId:"dict-004",itemCode:"40HQ",itemLabel:"40尺高櫃",sortOrder:3,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-015",dictionaryId:"dict-005",itemCode:"UNPAID",itemLabel:"未付款",sortOrder:1,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-016",dictionaryId:"dict-005",itemCode:"PARTIAL",itemLabel:"部分付款",sortOrder:2,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"},{id:"item-017",dictionaryId:"dict-005",itemCode:"PAID",itemLabel:"已付款",sortOrder:3,enabled:!0,remark:"",createdTime:"2024-01-01T00:00:00Z",updatedTime:"2024-01-01T00:00:00Z"}];function z(s){return V.filter(a=>a.dictionaryId===s)}const D="/api/adm/dictionaries";async function q(s,a){if(I())return console.log("[Mock] 模擬建立字典分類",s),await new Promise(t=>setTimeout(t,500)),a==null||a("新增字典分類成功 (Mock)","success"),!0;try{return await O.post(D,s),a==null||a("新增字典分類成功","success"),!0}catch(t){return console.error(t),a==null||a("新增字典分類失敗，請稍後再試","danger"),!1}}async function Q(s,a){if(I())return console.log("[Mock] 使用 Mock 字典分類列表",s),await new Promise(i=>setTimeout(i,300)),[...R];try{return(await O.get(D,{params:s})).data.data??[]}catch(t){return console.error(t),a==null||a("取得字典分類列表失敗，請稍後再試","danger"),[]}}async function B(s,a,t){if(I())return console.log("[Mock] 模擬更新字典分類",s,a),await new Promise(l=>setTimeout(l,500)),t==null||t("更新字典分類成功 (Mock)","success"),R.find(l=>l.id===s)||null;try{const i=await O.patch(`${D}/${s}`,a);return t==null||t("更新字典分類成功","success"),i.data.data}catch(i){throw console.error(i),t==null||t("更新字典分類失敗，請稍後再試","danger"),i}}async function X(s,a,t){if(I())return console.log("[Mock] 模擬建立字典項目",s,a),await new Promise(i=>setTimeout(i,500)),t==null||t("新增字典項目成功 (Mock)","success"),!0;try{return await O.post(`${D}/${s}/items`,a),t==null||t("新增字典項目成功","success"),!0}catch(i){return console.error(i),t==null||t("新增字典項目失敗，請稍後再試","danger"),!1}}async function J(s,a){if(I())return console.log("[Mock] 使用 Mock 字典項目",s),await new Promise(t=>setTimeout(t,300)),z(s);try{return(await O.get(`${D}/${s}/items`)).data.data??[]}catch(t){return console.error(t),a==null||a("取得字典項目失敗，請稍後再試","danger"),[]}}async function w(s,a,t){if(I())return console.log("[Mock] 模擬更新字典項目",s,a),await new Promise(l=>setTimeout(l,500)),t==null||t("更新字典項目成功 (Mock)","success"),V.find(l=>l.id===s)||null;try{const i=await O.patch(`${D}/items/${s}`,a);return t==null||t("更新字典項目成功","success"),i.data.data}catch(i){throw console.error(i),t==null||t("更新字典項目失敗，請稍後再試","danger"),i}}async function A(s,a){if(I())return console.log("[Mock] 模擬刪除字典項目",s),await new Promise(t=>setTimeout(t,500)),a==null||a("刪除字典項目成功 (Mock)","success"),!0;try{return await O.delete(`${D}/items/${s}`),a==null||a("刪除字典項目成功","success"),!0}catch(t){return console.error(t),a==null||a("刪除字典項目失敗，請稍後再試","danger"),!1}}async function ee(s,a,t){if(I()){console.log("[Mock] 模擬複製字典分類",s,a),await new Promise(l=>setTimeout(l,500)),t==null||t("複製字典分類成功 (Mock)","success");const i=R.find(l=>l.id===s);return i?{...i,id:`dict-${Date.now()}`,code:a}:null}try{const i=await O.post(`${D}/${s}/copy`,{newCode:a});return t==null||t("複製字典分類成功","success"),i.data.data}catch(i){return console.error(i),t==null||t("複製字典分類失敗，請稍後再試","danger"),null}}function te({dictionaryId:s,showAlert:a,onReload:t}){const[i,l]=o.useState(!0),[c,g]=o.useState([]),[x,p]=o.useState(!1),[u,m]=o.useState({itemCode:"",itemLabel:"",sortOrder:"",enabled:!0,remark:""}),[f,r]=o.useState(null),[b,N]=o.useState(null),[d,h]=o.useState(null),M=o.useMemo(()=>u.itemCode.trim()&&u.itemLabel.trim(),[u.itemCode,u.itemLabel]),E=async()=>{l(!0);try{const n=await J(s,a);g(n??[])}finally{l(!1)}};o.useEffect(()=>{E()},[s]);const j=n=>{r(n.id),h({itemCode:n.itemCode??"",itemLabel:n.itemLabel??"",sortOrder:n.sortOrder===null||n.sortOrder===void 0?"":String(n.sortOrder),enabled:n.enabled??!0,remark:n.remark??""})},L=()=>{r(null),h(null)},T=async()=>{if(M){p(!0);try{const n={dictionaryId:s,itemCode:u.itemCode.trim(),itemLabel:u.itemLabel.trim(),sortOrder:u.sortOrder===""?void 0:Number(u.sortOrder),enabled:u.enabled,remark:u.remark||void 0};await X(s,n,a)&&(m(S=>({...S,itemCode:"",itemLabel:"",remark:""})),await E(),await(t==null?void 0:t()))}finally{p(!1)}}},k=async n=>{if(d){if(!d.itemCode.trim()||!d.itemLabel.trim()){a==null||a("itemCode / itemLabel 不可為空","danger");return}N(n);try{const y={itemCode:d.itemCode.trim(),itemLabel:d.itemLabel.trim(),sortOrder:d.sortOrder===""?void 0:Number(d.sortOrder),enabled:d.enabled,remark:d.remark||void 0};await w(n,y,a)&&(L(),await E(),await(t==null?void 0:t()))}finally{N(null)}}},C=async n=>{if(!window.confirm(`確定刪除項目「${n.itemLabel}」嗎？`))return;await A(n.id,a)&&(await E(),await(t==null?void 0:t()))};return e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-180px",children:"Label"}),e.jsx("th",{className:"min-w-160px",children:"Value"}),e.jsx("th",{className:"min-w-90px",children:"Sort"}),e.jsx("th",{className:"min-w-120px",children:"狀態"}),e.jsx("th",{className:"min-w-180px text-end",children:"操作"})]})}),e.jsxs("tbody",{className:"text-gray-700 fw-semibold",children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm form-control-solid",placeholder:"例如：已建立",value:u.itemLabel,onChange:n=>m(y=>({...y,itemLabel:n.target.value})),disabled:x})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm form-control-solid",placeholder:"例如：CREATED",value:u.itemCode,onChange:n=>m(y=>({...y,itemCode:n.target.value})),disabled:x})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm form-control-solid",placeholder:"1",value:u.sortOrder,onChange:n=>m(y=>({...y,sortOrder:n.target.value})),disabled:x,inputMode:"numeric"})}),e.jsx("td",{children:e.jsxs("div",{className:"form-check form-switch form-check-custom form-check-solid",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:u.enabled,onChange:n=>m(y=>({...y,enabled:n.target.checked})),disabled:x}),e.jsx("span",{className:"form-check-label",children:u.enabled?"啟用":"停用"})]})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:T,disabled:!M||x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(U,{animation:"border",size:"sm",className:"me-2"}),"新增中..."]}):"新增"})})]}),i?e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx("div",{className:"d-flex justify-content-center py-10",children:e.jsx(U,{animation:"border"})})})}):c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx("div",{className:"text-center py-10 text-muted",children:"尚無項目，請先新增一筆"})})}):c.map(n=>{const y=f===n.id,S=b===n.id;return e.jsxs("tr",{children:[e.jsx("td",{children:y?e.jsx("input",{className:"form-control form-control-sm form-control-solid",value:(d==null?void 0:d.itemLabel)??"",onChange:Z=>h(v=>v&&{...v,itemLabel:Z.target.value}),disabled:S}):e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-bold text-gray-900",children:n.itemLabel}),e.jsxs("span",{className:"text-muted fs-8",children:["UUID：",n.id]})]})}),e.jsx("td",{children:y?e.jsx("input",{className:"form-control form-control-sm form-control-solid",value:(d==null?void 0:d.itemCode)??"",onChange:Z=>h(v=>v&&{...v,itemCode:Z.target.value}),disabled:S}):n.itemCode}),e.jsx("td",{children:y?e.jsx("input",{className:"form-control form-control-sm form-control-solid",value:(d==null?void 0:d.sortOrder)??"",onChange:Z=>h(v=>v&&{...v,sortOrder:Z.target.value}),disabled:S,inputMode:"numeric"}):n.sortOrder??"-"}),e.jsx("td",{children:y?e.jsxs("div",{className:"form-check form-switch form-check-custom form-check-solid",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:!!(d!=null&&d.enabled),onChange:Z=>h(v=>v&&{...v,enabled:Z.target.checked}),disabled:S}),e.jsx("span",{className:"form-check-label",children:d!=null&&d.enabled?"啟用":"停用"})]}):n.enabled?e.jsx("span",{className:"badge badge-light-success",children:"啟用"}):e.jsx("span",{className:"badge badge-light-secondary",children:"停用"})}),e.jsx("td",{className:"text-end",children:y?e.jsxs("div",{className:"d-inline-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>k(n.id),disabled:S,children:S?"更新中...":"更新"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:L,disabled:S,children:"取消"})]}):e.jsxs("div",{className:"d-inline-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:()=>j(n),children:"編輯"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light-danger",onClick:()=>C(n),children:"刪除"})]})})]},n.id)})]})]})})}function ae({show:s,mode:a,initial:t,showAlert:i,onClose:l,onSuccess:c}){const g=a==="edit",x=o.useMemo(()=>g&&t?{code:t.code??"",name:t.name??"",enabled:t.enabled??!0,remark:t.remark??""}:{code:"",name:"",enabled:!0,remark:""},[g,t]),[p,u]=o.useState(!1),[m,f]=o.useState(x);o.useEffect(()=>{s&&f(x)},[s,x]);const r=m.code.trim()&&m.name.trim(),b=async()=>{if(r){u(!0);try{if(!g){const M={code:m.code.trim(),name:m.name.trim(),enabled:m.enabled,remark:m.remark||void 0};await q(M,i)&&(l(),await(c==null?void 0:c(null)));return}if(!(t!=null&&t.id)){i==null||i("缺少字典 ID，無法更新","danger");return}const d={code:m.code.trim(),name:m.name.trim(),enabled:m.enabled,remark:m.remark||void 0},h=await B(t.id,d,i);h&&(l(),await(c==null?void 0:c(h)))}catch(d){console.error(d)}finally{u(!1)}}},N=()=>{p||l()};return e.jsxs(K,{show:s,onHide:N,centered:!0,backdrop:"static",children:[e.jsx(K.Header,{closeButton:!p,children:e.jsx(K.Title,{children:g?"編輯字典分類":"新增字典分類"})}),e.jsx(K.Body,{children:e.jsxs("div",{className:"d-flex flex-column gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"字典代碼 Code"}),e.jsx("input",{className:"form-control form-control-solid",value:m.code,onChange:d=>f(h=>({...h,code:d.target.value})),placeholder:"例如：ORDER_STATUS",disabled:p||g}),e.jsx("div",{className:"text-muted fs-8 mt-1",children:"建議全大寫＋底線（例：ORDER_STATUS / VEHICLE_TYPE）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"字典名稱 Name"}),e.jsx("input",{className:"form-control form-control-solid",value:m.name,onChange:d=>f(h=>({...h,name:d.target.value})),placeholder:"例如：訂單狀態",disabled:p})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"備註 Remark"}),e.jsx("textarea",{className:"form-control form-control-solid",rows:3,value:m.remark,onChange:d=>f(h=>({...h,remark:d.target.value})),placeholder:"可選填",disabled:p})]}),e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsxs("div",{className:"form-check form-switch form-check-custom form-check-solid",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:m.enabled,onChange:d=>f(h=>({...h,enabled:d.target.checked})),disabled:p}),e.jsx("span",{className:"form-check-label",children:m.enabled?"啟用":"停用"})]})})]})}),e.jsxs(K.Footer,{children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:N,disabled:p,children:"取消"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:b,disabled:!r||p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(U,{animation:"border",size:"sm",className:"me-2"}),g?"更新中...":"建立中..."]}):e.jsx(e.Fragment,{children:g?"更新":"建立"})})]})]})}function ie({showAlert:s}){const[a,t]=o.useState(""),[i,l]=o.useState(""),[c,g]=o.useState(""),[x,p]=o.useState(!0),[u,m]=o.useState([]),[f,r]=o.useState(null),b=o.useMemo(()=>{r(null);const T=i.trim().toLowerCase();return(u??[]).filter(k=>{if(c!==""&&k.enabled!==c)return!1;if(!T)return!0;const C=(k.code??"").toLowerCase(),n=(k.name??"").toLowerCase();return C.includes(T)||n.includes(T)})},[u,i,c]),N=async T=>{p(!0);try{const k=await Q(void 0,s);if(m(k),T){const C=k.find(n=>n.id===T)??null;r(C??k[0]??null);return}r(C=>C?k.some(y=>y.id===C.id)?C:null:k[0]??null)}finally{p(!1)}};return o.useEffect(()=>{N(null)},[]),o.useEffect(()=>{if(!f)return;b.some(k=>k.id===f.id)||r(null)},[b]),{tempKeyword:a,keyword:i,enabled:c,setTempKeyword:t,setEnabled:g,search:()=>{r(null),l(a.trim())},reset:()=>{r(null),t(""),l(""),g("")},loadingLeft:x,dictionaries:b,selected:f,setSelected:r,select:T=>r(T),reloadLeftKeepSelected:async()=>{await N((f==null?void 0:f.id)??null)},reloadLeftSelectId:async T=>{await N(T)},toggleCategoryEnabled:async(T,k)=>{try{const C=await B(T,{enabled:k},s);C&&r(C),await N(T)}catch(C){console.error(C)}}}}function se(s){const{loading:a,dictionaries:t,selectedId:i,tempKeyword:l,enabled:c,onTempKeywordChange:g,onEnabledChange:x,onSearch:p,onReset:u,onSelect:m,onCreate:f}=s,r=b=>{b.key==="Enter"&&p()};return e.jsxs("div",{className:"card",style:{background:"#f9fafb"},children:[e.jsxs("div",{className:"card-header border-0 pt-6 pb-4",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-bold fs-4",children:"字典分類"}),e.jsx("span",{className:"text-muted fs-8",children:"平台共用下拉 / 枚舉 / 分類碼表"})]})}),e.jsxs("div",{className:"card-toolbar",children:[e.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:f,children:[e.jsx(P,{iconName:"plus",className:"fs-3"}),"新增"]}),e.jsx("button",{type:"button",className:"btn btn-light",onClick:u,children:e.jsx(P,{iconName:"arrows-circle",className:"fs-2"})})]})]}),e.jsx("div",{className:"card-body pt-0 pb-4",children:e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs("div",{className:"d-flex align-items-center position-relative",children:[e.jsx(P,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid ps-14",placeholder:"搜尋：代碼 / 名稱…",value:l,onChange:b=>g(b.target.value),onKeyDown:r})]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:e.jsxs("select",{className:"form-select form-select-solid",value:c===""?"":c?"true":"false",onChange:b=>{const N=b.target.value;x(N===""?"":N==="true")},children:[e.jsx("option",{value:"",children:"全部狀態"}),e.jsx("option",{value:"true",children:"啟用"}),e.jsx("option",{value:"false",children:"停用"})]})})]})}),e.jsx("div",{className:"card-body pt-0",children:a?e.jsx("div",{className:"d-flex justify-content-center py-10",children:e.jsx(U,{animation:"border"})}):t.length===0?e.jsxs("div",{className:"text-center py-10 text-muted",children:["查無字典分類",e.jsx("div",{className:"fs-8 mt-2",children:"可點右上「新增」建立第一筆"})]}):e.jsx("div",{className:"list-group list-group-flush",children:t.map(b=>{const N=i===b.id;return e.jsxs("button",{type:"button",className:`list-group-item list-group-item-action d-flex justify-content-between align-items-center ${N?"active":""}`,onClick:()=>m(b),style:{borderRadius:10,marginBottom:8,border:N?"1px solid #3e97ff":"1px solid #eef0f3",background:N?"#eef6ff":"#ffffff",opacity:b.enabled?1:.7},children:[e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-bold text-gray-900",children:[b.name," ",!b.enabled&&e.jsx("span",{className:"badge badge-light-secondary ms-2",children:"停用"})]}),e.jsxs("span",{className:"text-muted fs-8",children:["Code：",b.code]}),b.remark&&b.remark.trim()?e.jsx("span",{className:"text-muted fs-8 text-truncate",style:{maxWidth:220},children:b.remark}):null]}),e.jsx(P,{iconName:"arrow-right",className:"fs-2"})]},b.id)})})})]})}function ne({selected:s,onEdit:a,onCopy:t,onToggleEnabled:i}){const l=!s,c=(s==null?void 0:s.enabled)??!1;return e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[s?e.jsx("span",{className:`badge ${c?"badge-light-success":"badge-light-secondary"} ms-2`,children:c?"啟用中":"已停用"}):e.jsx("span",{className:"badge badge-light ms-2",children:"No Selection"}),e.jsxs("button",{type:"button",className:`btn btn-sm ${c?"btn-light-secondary":"btn-light-success"}`,onClick:i,disabled:l,title:"只切換分類 enabled",children:[e.jsx(P,{iconName:c?"toggle-off":"toggle-on",className:"fs-3"}),c?"停用分類":"啟用分類"]}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:a,disabled:l,children:[e.jsx(P,{iconName:"pencil",className:"fs-3"}),"編輯"]}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-light",onClick:t,disabled:l,children:[e.jsx(P,{iconName:"copy",className:"fs-3"}),"複製"]})]})}function re({selected:s,remark:a,onEdit:t,onCopy:i,onToggleEnabled:l,children:c}){return e.jsxs("div",{className:"card",style:{boxShadow:"0 6px 18px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{className:"card-header border-0 pt-6 pb-4",style:{borderBottom:"1px solid #eff2f5"},children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-bold fs-3",children:s?s.name:"字典項目"}),e.jsx("div",{className:"text-muted fs-8",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"me-3",children:["UUID：",s.id]}),e.jsx("br",{}),e.jsxs("span",{className:"me-3",children:["Code：",s.code]}),e.jsxs("span",{children:["Remark：",a]})]}):"尚未選取字典分類"})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx(ne,{selected:s,onEdit:t,onCopy:i,onToggleEnabled:l})})]}),e.jsx("div",{className:"card-body py-4",children:c})]})}function de({show:s,source:a,showAlert:t,onClose:i,onSuccess:l}){const[c,g]=o.useState(""),[x,p]=o.useState(!1),u=o.useMemo(()=>!!(a!=null&&a.id)&&c.trim().length>0&&!x,[c,a==null?void 0:a.id,x]);if(!s)return null;const m=async()=>{if(!(a!=null&&a.id)){t==null||t("請先選取要複製的字典分類","warning");return}const f=c.trim();if(!f){t==null||t("請輸入新分類 code","warning");return}p(!0);try{const r=await ee(a.id,f,t);await l(r),g("")}catch(r){console.error(r)}finally{p(!1)}};return e.jsx("div",{className:"modal fade show d-block",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered mw-600px",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title fw-bold",children:"複製字典分類"}),e.jsx("button",{type:"button",className:"btn btn-icon btn-sm btn-active-light-primary",onClick:i,children:e.jsx("i",{className:"bi bi-x fs-2"})})]}),e.jsx("div",{className:"modal-body",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-muted fs-8 mb-1",children:"來源分類"}),e.jsx("div",{className:"fw-bold",children:a.name}),e.jsxs("div",{className:"text-muted fs-8",children:["Code：",a.code]}),e.jsxs("div",{className:"text-muted fs-8",children:["UUID：",a.id]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"新分類 Code"}),e.jsx("input",{type:"text",className:"form-control form-control-solid",placeholder:"例如：TOM.ORDER_STATUS",value:c,onChange:f=>g(f.target.value)}),e.jsx("div",{className:"text-muted fs-8 mt-2",children:"複製會建立新分類（uuid=null）並複製所有 items 到新分類底下。"})]})]}):e.jsx("div",{className:"text-muted",children:"尚未選取分類"})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:i,disabled:x,children:"取消"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:m,disabled:!u,children:x?"處理中…":"開始複製"})]})]})})})}function ce(){const{alert:s,showAlert:a,Alert:t}=H(),i=ie({showAlert:a}),[l,c]=o.useState(!1),[g,x]=o.useState("create"),[p,u]=o.useState(null),[m,f]=o.useState(!1),r=i.selected,b=(r==null?void 0:r.id)??null,N=()=>{x("create"),u(null),c(!0)},d=()=>{if(!r){a==null||a("請先選取一個字典分類","warning");return}x("edit"),u(r),c(!0)},h=()=>{if(!r){a==null||a("請先選取一個字典分類","warning");return}f(!0)},M=async()=>{if(!r){a==null||a("請先選取一個字典分類","warning");return}await i.toggleCategoryEnabled(r.id,!r.enabled)},E=o.useMemo(()=>{var L;const j=(L=r==null?void 0:r.remark)==null?void 0:L.trim();return j&&j.length>0?j:"-"},[r==null?void 0:r.remark]);return e.jsxs(Y,{children:[s&&e.jsx(t,{message:s.message,type:s.type}),e.jsx(G,{title:"字典檔 Dictionary",breadcrumbs:[{label:"ADM 系統設定",href:"#"},{label:"字典檔",active:!0}]}),e.jsx("div",{className:"app-container container-fluid",children:e.jsxs("div",{className:"row g-6",children:[e.jsx("div",{className:"col-12 col-lg-4 col-xxl-3",children:e.jsx(se,{loading:i.loadingLeft,dictionaries:i.dictionaries,selectedId:b,tempKeyword:i.tempKeyword,enabled:i.enabled,onTempKeywordChange:i.setTempKeyword,onEnabledChange:i.setEnabled,onSearch:()=>i.search(),onReset:()=>i.reset(),onSelect:j=>i.select(j),onCreate:N})}),e.jsx("div",{className:"col-12 col-lg-8 col-xxl-9",children:e.jsx(re,{selected:r,remark:E,onEdit:d,onCopy:h,onToggleEnabled:M,children:r?e.jsxs(e.Fragment,{children:[e.jsx(te,{dictionaryId:r.id,showAlert:a,onReload:async()=>{}}),e.jsx("div",{className:"text-muted fs-8 mt-3",children:"提示：上方第一列為「新增列」，可快速建立項目；每列可 inline 編輯更新。"})]}):e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-10 text-muted",children:[e.jsx("div",{className:"fw-bold",children:"請先從左側選擇一個字典分類"}),e.jsx("div",{className:"fs-8 mt-1",children:"選取後即可在右側新增/編輯/停用字典項目"})]})})})]})}),e.jsx(ae,{show:l,mode:g,initial:p,showAlert:a,onClose:()=>c(!1),onSuccess:async j=>{var L;if(c(!1),g==="create"){j!=null&&j.id?await i.reloadLeftSelectId(j.id):await i.reloadLeftKeepSelected();return}await i.reloadLeftKeepSelected(),j&&((L=i.selected)==null?void 0:L.id)===j.id&&i.setSelected(j)}}),e.jsx(de,{show:m,source:r,showAlert:a,onClose:()=>f(!1),onSuccess:async j=>{f(!1),j!=null&&j.id?await i.reloadLeftSelectId(j.id):await i.reloadLeftKeepSelected()}})]})}const _=[{title:"ADM 系統設定",path:"/adm",isSeparator:!1,isActive:!1},{title:"字典檔",path:"/adm/dictionary",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],it=()=>e.jsxs(W,{children:[e.jsx($,{path:"overview",element:e.jsxs(e.Fragment,{children:[e.jsx(F,{breadcrumbs:_,children:"字典檔總覽"}),e.jsx(ce,{})]})}),e.jsx($,{path:"overview",element:e.jsx(e.Fragment,{children:e.jsx(F,{breadcrumbs:_,children:"字典檔列表"})})}),e.jsx($,{path:"create",element:e.jsx(e.Fragment,{children:e.jsx(F,{breadcrumbs:_,children:"新增字典"})})}),e.jsx($,{path:":id/detail",element:e.jsx(e.Fragment,{children:e.jsx(F,{breadcrumbs:_,children:"字典詳情"})})})]});export{it as default};
