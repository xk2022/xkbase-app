import{r,j as e}from"./react-DwkAs-v9.js";import{i as R,h as z,o as _,K as P,e as B,C as G,P as X}from"./index-BdFDZIEO.js";import{A as J}from"./AppToolbar-BZHSVYI7.js";import{C as Q}from"./ConfirmDeleteModal-BwZdlGN4.js";import{A as O,E as V,M as Y}from"./MockDataDialog-NPR1ODBB.js";import{P as q}from"./PagedTable-fW2f3xMh.js";import{a as U,d as A,e as Z,f as ee}from"./react-router-Df4HDh8c.js";import"./apexcharts-sziEC8OT.js";import"./react-dom-DVTd-Q6a.js";import"./scheduler-CylivXx-.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-bootstrap-BUaeuJHt.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./@popperjs-D8Kg5PqX.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";import"./@babel-B036hIWL.js";import"./react-select-Z1ywkuii.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";const L=[{id:"1",driverId:"1",driverName:"張三",weekStartDate:"2024-01-01",weekEndDate:"2024-01-07",mondayHours:8,tuesdayHours:8,wednesdayHours:8,thursdayHours:8,fridayHours:8,saturdayHours:4,sundayHours:0,totalWeeklyHours:44,status:"confirmed",createdAt:"2023-12-28T10:00:00Z",updatedAt:"2023-12-28T10:00:00Z"},{id:"2",driverId:"2",driverName:"李四",weekStartDate:"2024-01-01",weekEndDate:"2024-01-07",mondayHours:8,tuesdayHours:8,wednesdayHours:8,thursdayHours:8,fridayHours:8,saturdayHours:0,sundayHours:0,totalWeeklyHours:40,status:"confirmed",createdAt:"2023-12-28T10:00:00Z",updatedAt:"2023-12-28T10:00:00Z"}],$="/api/hrm/schedules";async function ae(a,t){if(R())return console.log("[Mock] 模擬創建工時規劃",a),await new Promise(n=>setTimeout(n,500)),t==null||t("工時規劃建立成功 (Mock)","success"),!0;try{return await z.post($,a),t==null||t("工時規劃建立成功","success"),!0}catch(n){return console.error(n),t==null||t("建立工時規劃失敗，請稍後再試","danger"),!1}}async function te(a,t){if(R())return console.log("[Mock] 使用 Mock 工時規劃列表",a),await new Promise(n=>setTimeout(n,300)),Promise.resolve({content:L,totalElements:L.length,totalPages:1,size:a.size??10,number:a.page??0,first:(a.page??0)===0,last:!0,empty:L.length===0});try{const i=(await z.get($,{params:a})).data.data;return{...i,content:i.content||[]}}catch(n){console.error(n);const i=O.fromAxiosError(n);if(i.isServerError)throw i;return t==null||t("取得工時規劃列表失敗，請稍後再試","danger"),{content:[],totalElements:0,totalPages:0,size:a.size??10,number:a.page??0,first:!0,last:!0,empty:!0}}}async function se(a,t,n){if(R())return console.log("[Mock] 模擬更新工時規劃",a,t),await new Promise(l=>setTimeout(l,500)),n==null||n("更新工時規劃成功 (Mock)","success"),L.find(l=>l.id===a);try{const i=await z.put(`${$}/${a}`,t);return n==null||n("更新工時規劃成功","success"),i.data.data}catch(i){throw console.error(i),n==null||n("更新工時規劃失敗，請稍後再試","danger"),i}}async function re(a,t){if(R())return console.log("[Mock] 模擬刪除工時規劃",a),await new Promise(n=>setTimeout(n,500)),t==null||t("刪除工時規劃成功 (Mock)","success"),!0;try{return await z.delete(`${$}/${a}`),t==null||t("刪除工時規劃成功","success"),!0}catch(n){return console.error(n),t==null||t("刪除工時規劃失敗，請稍後再試","danger"),!1}}const ne=10,K=a=>a?new Date(a).toLocaleDateString("zh-TW"):"-",oe=a=>{if(!a)return{label:"-",className:"badge-light-secondary"};switch(a){case"draft":return{label:"草稿",className:"badge-light-warning"};case"confirmed":return{label:"已確認",className:"badge-light-success"};case"completed":return{label:"已完成",className:"badge-light-primary"};default:return{label:a,className:"badge-light-secondary"}}},le=({searchKeyword:a,showAlert:t,onEdit:n})=>{const i=U(),[l,x]=r.useState([]),[j,S]=r.useState(0),[v,H]=r.useState(1),[b,d]=r.useState(1),[C,p]=r.useState(!1),[m,g]=r.useState(null),[h,y]=r.useState(!1),[c,k]=r.useState(!1),[I,D]=r.useState(!1),u=r.useCallback(async()=>{p(!0),k(!1);try{const o={page:b-1,size:ne,keyword:a!=null&&a.trim()?a.trim():void 0},f=await te(o,t);x(f.content),S(f.totalElements),H(f.totalPages||1)}catch(o){O.fromAxiosError(o).isServerError?(k(!0),D(!0)):t("取得工時規劃列表失敗，請稍後再試","danger")}finally{p(!1)}},[b,a,t]),E=r.useCallback(()=>{_(),D(!1),k(!1),u()},[u]),F=r.useCallback(()=>{k(!1),u()},[u]);r.useEffect(()=>{d(1)},[a]),r.useEffect(()=>{u()},[u]);const M=r.useCallback(o=>{i(`/hrm/schedule/${o.id}/detail`)},[i]),W=o=>g(o),w=async()=>{if(!m)return;const o=m.id;if(!o){t("缺少工時規劃識別碼，無法刪除","danger");return}try{y(!0),await re(String(o),t)&&(await u(),g(null))}finally{y(!1)}};if(c)return e.jsxs(e.Fragment,{children:[e.jsx(V,{onRetry:F,showMockOption:!0,onUseMock:E}),e.jsx(Y,{open:I,onConfirm:E,onCancel:()=>D(!1)})]});const T=[{header:"司機姓名",className:"min-w-100px"},{header:"週開始日期",className:"min-w-120px"},{header:"週結束日期",className:"min-w-120px"},{header:"週總工時",className:"min-w-100px text-end"},{header:"狀態",className:"min-w-100px"},{header:"操作",className:"text-end min-w-200px"}];return e.jsxs(e.Fragment,{children:[e.jsx(q,{columns:T,rows:l,loading:C,emptyText:"沒有工時規劃資料",page:b,totalPages:v,totalElements:j,onPrev:()=>d(o=>Math.max(1,o-1)),onNext:()=>d(o=>Math.min(v||1,o+1)),renderRow:o=>{const f=oe(o.status);return e.jsxs("tr",{className:"cursor-pointer table-row-hover",onClick:()=>M(o),children:[e.jsx("td",{className:"fw-bold text-gray-900",children:o.driverName}),e.jsx("td",{children:K(o.weekStartDate)}),e.jsx("td",{children:K(o.weekEndDate)}),e.jsxs("td",{className:"text-end",children:[o.totalWeeklyHours," 小時"]}),e.jsx("td",{children:e.jsx("span",{className:`badge ${f.className} fw-bold`,children:f.label})}),e.jsx("td",{className:"text-end",onClick:N=>N.stopPropagation(),children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-light-primary btn-sm",onClick:N=>{N.preventDefault(),M(o)},title:"查看詳情",children:e.jsx(P,{iconName:"eye",className:"fs-2"})}),n&&e.jsx("button",{className:"btn btn-light-warning btn-sm",onClick:N=>{N.preventDefault(),n(o)},title:"編輯",children:e.jsx(P,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-light-danger btn-sm",onClick:N=>{N.preventDefault(),W(o)},title:"刪除",children:e.jsx(P,{iconName:"trash",className:"fs-2"})})]})})]},String(o.id??Math.random()))}}),m&&e.jsx(Q,{open:!!m,title:"刪除工時規劃",deleting:h,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除司機 ",e.jsx("strong",{children:m.driverName??"-"})," 的工時規劃嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>h?null:g(null),onConfirm:w})]})},ie=({open:a,onClose:t,onSaved:n,showAlert:i,editingSchedule:l})=>{const x=!!l,[j,S]=r.useState(""),[v,H]=r.useState(""),[b,d]=r.useState(""),[C,p]=r.useState(""),[m,g]=r.useState(""),[h,y]=r.useState(""),[c,k]=r.useState(""),[I,D]=r.useState(""),[u,E]=r.useState(""),[F,M]=r.useState(""),[W,w]=r.useState(""),[T,o]=r.useState(!1);r.useEffect(()=>{if(a){if(!l){S(""),H(""),d(""),p(""),g(""),y(""),k(""),D(""),E(""),M(""),w("");return}S(l.driverId||""),H(l.weekStartDate||""),d(l.weekEndDate||""),p(l.mondayHours||""),g(l.tuesdayHours||""),y(l.wednesdayHours||""),k(l.thursdayHours||""),D(l.fridayHours||""),E(l.saturdayHours||""),M(l.sundayHours||"")}},[a,l]);const f=()=>j.trim()?v?b?!0:(i("請選擇週結束日期","warning"),!1):(i("請選擇週開始日期","warning"),!1):(i("請選擇司機","warning"),!1),N=async()=>{if(f())try{o(!0);const s={...x?{id:l.id}:{},driverId:j.trim(),weekStartDate:v,weekEndDate:b,mondayHours:C===""?void 0:Number(C),tuesdayHours:m===""?void 0:Number(m),wednesdayHours:h===""?void 0:Number(h),thursdayHours:c===""?void 0:Number(c),fridayHours:I===""?void 0:Number(I),saturdayHours:u===""?void 0:Number(u),sundayHours:F===""?void 0:Number(F),notes:W.trim()||void 0};x&&l?await se(l.id,s,i):await ae(s,i),n()}catch(s){console.error(s),i("儲存失敗，請稍後再試","danger")}finally{o(!1)}};return a?e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,.25)"},role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(P,{iconName:x?"message-edit":"plus",className:"fs-2 me-2"}),x?"編輯工時規劃":"新增工時規劃"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:t,disabled:T,"aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"司機 ID"}),e.jsx("input",{className:"form-control",value:j,onChange:s=>S(s.target.value),placeholder:"請輸入司機 ID",autoFocus:!x})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"週開始日期"}),e.jsx("input",{className:"form-control",type:"date",value:v,onChange:s=>H(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"週結束日期"}),e.jsx("input",{className:"form-control",type:"date",value:b,onChange:s=>d(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"週一工時"}),e.jsx("input",{className:"form-control",type:"number",min:"0",max:"24",value:C,onChange:s=>p(s.target.value===""?"":Number(s.target.value)),placeholder:"小時"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"週二工時"}),e.jsx("input",{className:"form-control",type:"number",min:"0",max:"24",value:m,onChange:s=>g(s.target.value===""?"":Number(s.target.value)),placeholder:"小時"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"週三工時"}),e.jsx("input",{className:"form-control",type:"number",min:"0",max:"24",value:h,onChange:s=>y(s.target.value===""?"":Number(s.target.value)),placeholder:"小時"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"週四工時"}),e.jsx("input",{className:"form-control",type:"number",min:"0",max:"24",value:c,onChange:s=>k(s.target.value===""?"":Number(s.target.value)),placeholder:"小時"})]})]}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"週五工時"}),e.jsx("input",{className:"form-control",type:"number",min:"0",max:"24",value:I,onChange:s=>D(s.target.value===""?"":Number(s.target.value)),placeholder:"小時"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"週六工時"}),e.jsx("input",{className:"form-control",type:"number",min:"0",max:"24",value:u,onChange:s=>E(s.target.value===""?"":Number(s.target.value)),placeholder:"小時"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"週日工時"}),e.jsx("input",{className:"form-control",type:"number",min:"0",max:"24",value:F,onChange:s=>M(s.target.value===""?"":Number(s.target.value)),placeholder:"小時"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"備註"}),e.jsx("textarea",{className:"form-control",rows:5,value:W,onChange:s=>w(s.target.value),placeholder:"請輸入備註"})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-light",onClick:t,disabled:T,children:"取消"}),e.jsx("button",{className:"btn btn-primary",onClick:N,disabled:T,children:T?"儲存中…":"儲存"})]})]})})}):null};function ce(){const{alert:a,showAlert:t,Alert:n}=B(),i=U(),[l,x]=r.useState(""),[j,S]=r.useState(""),[v,H]=r.useState(0),[b,d]=r.useState(!1),[C,p]=r.useState(null),m=c=>{c.key==="Enter"&&x(j.trim())},g=()=>{H(c=>c+1),d(!1),p(null)},h=()=>{i("/hrm/schedule/create")},y=c=>{p(c),d(!0)};return e.jsxs(G,{children:[a&&e.jsx(n,{message:a.message,type:a.type}),e.jsx(J,{title:"工時規劃",breadcrumbs:[{label:"人資管理",href:"#"},{label:"工時規劃",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(P,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"司機姓名 / 日期…",value:j,onChange:c=>S(c.target.value),onKeyDown:m})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end gap-2 flex-wrap",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:h,children:[e.jsx(P,{iconName:"plus",className:"fs-2"}),"新增工時規劃"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(le,{searchKeyword:l,showAlert:t,onEdit:y},v)})]})}),e.jsx(ie,{open:b,onClose:()=>{d(!1),p(null)},showAlert:t,editingSchedule:C,onSaved:g})]})}const de=[{title:"工時規劃",path:"/hrm/schedule/list",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],ia=()=>e.jsxs(A,{children:[e.jsx(Z,{path:"",element:e.jsx(ee,{to:"list",replace:!0})}),e.jsx(Z,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(X,{breadcrumbs:de,children:"工時規劃"}),e.jsx(ce,{})]})})]});export{ia as default};
