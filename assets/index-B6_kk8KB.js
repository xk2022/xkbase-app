import{r as i,j as e}from"./react-DwkAs-v9.js";import{s as E,h as T,K as y,e as K,C as V,P as M}from"./index-wbzsHQ-6.js";import{A as $}from"./AppToolbar-BZHSVYI7.js";import{c as H}from"./clsx-B-dksMZM.js";import{C as B}from"./ConfirmDeleteModal-BXGAXcew.js";import{P as U}from"./PagedTable-fW2f3xMh.js";import{a as I,d as X,e as D}from"./react-router-Df4HDh8c.js";import"./apexcharts-sziEC8OT.js";import"./react-dom-DVTd-Q6a.js";import"./scheduler-CylivXx-.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-bootstrap-BUaeuJHt.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./@popperjs-D8Kg5PqX.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";import"./@babel-B036hIWL.js";import"./react-select-Z1ywkuii.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";const w=t=>({id:t.id,title:t.title,description:t.description??void 0,status:t.status,enabled:t.enabled,created_at:t.createdAt??void 0,updated_at:t.updatedAt??void 0,category:t.category??void 0,tags:t.tags??[]}),P="/api/sample/v1";async function Y(t,a){if(E())return console.log("[Mock] 模擬創建 Sample",t),await new Promise(n=>setTimeout(n,500)),a==null||a("建立 Sample 成功 (Mock)","success"),!0;try{return await T.post(P,t),a==null||a("建立 Sample 成功","success"),!0}catch(n){return console.error(n),a==null||a("建立 Sample 失敗，請稍後再試","danger"),!1}}async function Z(t,a){var n;if(E()){console.log("[Mock] 使用 Mock Sample 列表",t),await new Promise(u=>setTimeout(u,300));let l=[...[{id:"1",title:"Sample 1",description:"This is sample 1",status:"ACTIVE",enabled:!0,createdAt:new Date().toISOString(),category:"Type A",tags:["tag1","tag2"]},{id:"2",title:"Sample 2",description:"This is sample 2",status:"INACTIVE",enabled:!1,createdAt:new Date().toISOString(),category:"Type B",tags:["tag2"]}]];if((n=t.keyword)!=null&&n.trim()){const u=t.keyword.toLowerCase();l=l.filter(o=>{var j,g;return o.title.toLowerCase().includes(u)||((j=o.description)==null?void 0:j.toLowerCase().includes(u))||((g=o.category)==null?void 0:g.toLowerCase().includes(u))})}const d=t.page||0,p=t.size||10,h=d*p,b=h+p,N=l.slice(h,b);return{content:N.map(w),totalElements:l.length,totalPages:Math.ceil(l.length/p),size:p,number:d,first:d===0,last:b>=l.length,empty:N.length===0}}try{const l=(await T.get(P,{params:t})).data.data;return{...l,content:(l.content||[]).map(w)}}catch(r){return console.error(r),a==null||a("取得 Sample 列表失敗，請稍後再試","danger"),{content:[],totalElements:0,totalPages:0,size:t.size,number:t.page,first:!0,last:!0,empty:!0}}}async function J(t,a,n){if(E())return console.log("[Mock] 模擬更新 Sample",t,a),await new Promise(r=>setTimeout(r,500)),n==null||n("更新 Sample 成功 (Mock)","success"),{id:t,title:a.title||"Updated Sample",description:a.description,status:a.status||"ACTIVE",enabled:a.enabled??!0,category:a.category,tags:a.tags};try{const r=await T.put(`${P}/${t}`,a);return n==null||n("更新 Sample 成功","success"),r.data.data}catch(r){throw console.error(r),n==null||n("更新 Sample 失敗，請稍後再試","danger"),r}}async function Q(t,a){if(E())return console.log("[Mock] 模擬刪除 Sample",t),await new Promise(n=>setTimeout(n,500)),a==null||a("刪除 Sample 成功 (Mock)","success"),!0;try{return await T.delete(`${P}/${t}`),a==null||a("刪除 Sample 成功","success"),!0}catch(n){return console.error(n),a==null||a("刪除 Sample 失敗，請稍後再試","danger"),!1}}const W=10,q=t=>{if(!t)return"-";const a=new Date(t),n=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),d=String(a.getHours()).padStart(2,"0"),p=String(a.getMinutes()).padStart(2,"0");return`${n}/${r}/${l} ${d}:${p}`},L=t=>{switch(t){case"ACTIVE":return"啟用";case"INACTIVE":return"停用";case"PENDING":return"待處理";default:return t||"-"}},O=({searchKeyword:t,showAlert:a,onEdit:n})=>{const r=I(),[l,d]=i.useState([]),[p,h]=i.useState(0),[b,N]=i.useState(1),[m,u]=i.useState(1),[o,j]=i.useState(!1),[g,S]=i.useState(null),[v,c]=i.useState(!1),C=i.useCallback(async()=>{j(!0);try{const s={page:m-1,size:W,keyword:t!=null&&t.trim()?t.trim():void 0},f=await Z(s,a);d(f.content),h(f.totalElements),N(f.totalPages||1)}finally{j(!1)}},[m,t,a]);i.useEffect(()=>{u(1)},[t]),i.useEffect(()=>{C()},[C]);const k=i.useCallback(s=>{r(`/sample/v1/${s.id}/detail`)},[r]),x=s=>S(s),z=async()=>{if(!g)return;const s=g.id;if(!s){a("缺少 Sample 識別碼，無法刪除","danger");return}try{c(!0),await Q(String(s),a)&&(await C(),S(null))}finally{c(!1)}},_=[{header:"標題",className:"min-w-200px"},{header:"描述",className:"min-w-250px"},{header:"狀態",className:"min-w-100px"},{header:"分類",className:"min-w-150px"},{header:"創建時間",className:"min-w-150px"},{header:"功能",className:"text-end min-w-100px"}];return e.jsxs(e.Fragment,{children:[e.jsx(U,{columns:_,rows:l,loading:o,emptyText:"沒有 Sample 資料",page:m,totalPages:b,totalElements:p,onPrev:()=>u(s=>Math.max(1,s-1)),onNext:()=>u(s=>Math.min(b||1,s+1)),renderRow:s=>e.jsxs("tr",{className:"cursor-pointer table-row-hover",onClick:()=>k(s),children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("a",{href:"#",className:"text-gray-800 text-hover-primary mb-1 fw-bold",onClick:f=>{f.stopPropagation(),k(s)},children:s.title}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"d-flex gap-1 mt-1",children:[s.tags.slice(0,3).map((f,G)=>e.jsx("span",{className:H("badge badge-light-primary badge-circle"),children:f},G)),s.tags.length>3&&e.jsxs("span",{className:"text-muted fs-7",children:["+",s.tags.length-3]})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-600 fw-semibold",children:s.description||"-"})}),e.jsx("td",{children:s.enabled?e.jsx("span",{className:"badge badge-light-success fw-bolder px-4 py-3",children:L(s.status)}):e.jsx("span",{className:"badge badge-light-secondary fw-bolder px-4 py-3",children:L(s.status)})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-800 fw-bold",children:s.category||"-"})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semibold",children:q(s.created_at)})}),e.jsx("td",{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-icon btn-light-primary btn-sm",onClick:f=>{f.stopPropagation(),k(s)},title:"查看詳情",children:e.jsx(y,{iconName:"eye",className:"fs-2"})}),e.jsx("button",{className:"btn btn-icon btn-light-warning btn-sm",onClick:f=>{f.stopPropagation(),n(s)},title:"編輯",children:e.jsx(y,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-icon btn-light-danger btn-sm",onClick:f=>{f.stopPropagation(),x(s)},title:"刪除",children:e.jsx(y,{iconName:"trash",className:"fs-2"})})]})})]},s.id)}),g&&e.jsx(B,{open:!!g,title:"刪除 Sample",deleting:v,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除 Sample ",e.jsx("strong",{children:g.title})," 嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>v?null:S(null),onConfirm:z})]})},R=({open:t,onClose:a,onSaved:n,showAlert:r,editingSample:l})=>{const d=!!l,[p,h]=i.useState(""),[b,N]=i.useState(""),[m,u]=i.useState("ACTIVE"),[o,j]=i.useState(!0),[g,S]=i.useState(""),[v,c]=i.useState(!1);i.useEffect(()=>{if(t){if(!l){h(""),N(""),u("ACTIVE"),j(!0),S("");return}h(l.title??""),N(l.description??""),u(l.status??"ACTIVE"),j(!!l.enabled),S(l.category??"")}},[t,l]);const C=()=>p.trim()?!0:(r("請輸入標題（title）","warning"),!1),k=async()=>{if(C())try{if(c(!0),d&&l){const x={title:p.trim(),description:b.trim()||void 0,status:m,enabled:o,category:g.trim()||void 0};await J(l.id,x,r)}else{const x={title:p.trim(),description:b.trim()||void 0,status:m,enabled:o,category:g.trim()||void 0};await Y(x,r)}n()}catch(x){console.error(x),r("儲存失敗，請稍後再試","danger")}finally{c(!1)}};return t?e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,.25)"},role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(y,{iconName:d?"message-edit":"plus",className:"fs-2 me-2"}),d?"編輯 Sample":"新增 Sample"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:a,disabled:v,"aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"標題（title）"}),e.jsx("input",{className:"form-control",value:p,onChange:x=>h(x.target.value),placeholder:"例如：Sample 標題",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"描述（description）"}),e.jsx("textarea",{className:"form-control",value:b,onChange:x=>N(x.target.value),placeholder:"請輸入描述",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"分類（category）"}),e.jsx("input",{className:"form-control",value:g,onChange:x=>S(x.target.value),placeholder:"例如：Type A"})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"form-label required",children:"狀態"}),e.jsxs("select",{className:"form-select form-select-solid",value:m,onChange:x=>u(x.target.value),children:[e.jsx("option",{value:"ACTIVE",children:"啟用"}),e.jsx("option",{value:"INACTIVE",children:"停用"}),e.jsx("option",{value:"PENDING",children:"待處理"})]})]}),e.jsxs("div",{className:"form-check form-switch form-check-custom form-check-solid",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"sampleEnabledSwitch",checked:o,onChange:x=>j(x.target.checked)}),e.jsx("label",{className:"form-check-label",htmlFor:"sampleEnabledSwitch",children:"啟用"})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-light",onClick:a,disabled:v,children:"取消"}),e.jsx("button",{className:"btn btn-primary",onClick:k,disabled:v,children:v?"儲存中…":"儲存"})]})]})})}):null};function A(){const{alert:t,showAlert:a,Alert:n}=K();I();const[r,l]=i.useState(""),[d,p]=i.useState(""),[h,b]=i.useState(0),[N,m]=i.useState(!1),[u,o]=i.useState(null),j=c=>{c.key==="Enter"&&l(d.trim())},g=()=>{b(c=>c+1),m(!1),o(null)},S=()=>{o(null),m(!0)},v=c=>{o(c),m(!0)};return e.jsxs(V,{children:[t&&e.jsx(n,{message:t.message,type:t.type}),e.jsx($,{title:"Sample 列表",breadcrumbs:[{label:"Sample 管理",href:"#",active:!1},{label:"Sample",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(y,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"請輸入關鍵字",value:d,onChange:c=>p(c.target.value),onKeyDown:j})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end","data-kt-sample-table-toolbar":"base",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:S,children:[e.jsx(y,{iconName:"plus",className:"fs-2"}),"新增 Sample"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(O,{searchKeyword:r,showAlert:a,onEdit:v},h)})]})}),e.jsx(R,{open:N,onClose:()=>{m(!1),o(null)},showAlert:a,editingSample:u,onSaved:g})]})}function ee(){const{alert:t,showAlert:a,Alert:n}=K();I();const[r,l]=i.useState(""),[d,p]=i.useState(""),[h,b]=i.useState(0),[N,m]=i.useState(!1),[u,o]=i.useState(null),j=c=>{c.key==="Enter"&&l(d.trim())},g=()=>{b(c=>c+1),m(!1),o(null)},S=()=>{o(null),m(!0)},v=c=>{o(c),m(!0)};return e.jsxs(V,{children:[t&&e.jsx(n,{message:t.message,type:t.type}),e.jsx($,{title:"Sample 列表",breadcrumbs:[{label:"Sample 管理",href:"#"},{label:"Sample",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(y,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"請輸入關鍵字",value:d,onChange:c=>p(c.target.value),onKeyDown:j})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end","data-kt-sample-table-toolbar":"base",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:S,children:[e.jsx(y,{iconName:"plus",className:"fs-2"}),"新增 Sample"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(O,{searchKeyword:r,showAlert:a,onEdit:v},h)})]})}),e.jsx(R,{open:N,onClose:()=>{m(!1),o(null)},showAlert:a,editingSample:u,onSaved:g})]})}const F=[{title:"Sample 管理",path:"/sample/v1/overview",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],We=()=>e.jsxs(X,{children:[e.jsx(D,{path:"overview",element:e.jsxs(e.Fragment,{children:[e.jsx(M,{breadcrumbs:F,children:"Sample 總覽"}),e.jsx(A,{})]})}),e.jsx(D,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(M,{breadcrumbs:F,children:"Sample 列表"}),e.jsx(ee,{})]})})]});export{We as default};
