import{r as t,j as e}from"./react-DwkAs-v9.js";import{e as F,f as q,s as O,j as z,C as L,K as y,k as Z,l as K,m as W,n as J,P as T}from"./index-BdFDZIEO.js";import{A as U}from"./AppToolbar-BZHSVYI7.js";import{a as $,g as Q,d as X,e as C,f as A}from"./react-router-Df4HDh8c.js";import{C as ee}from"./ConfirmDeleteModal-BwZdlGN4.js";import{P as se}from"./PagedTable-fW2f3xMh.js";import{u as R,t as E,C as ae,a as H}from"./formUtils-DYBw-NTu.js";import{u as te}from"./useFormMeta-CziDqAIO.js";import{S as le}from"./react-bootstrap-BUaeuJHt.js";import"./apexcharts-sziEC8OT.js";import"./react-dom-DVTd-Q6a.js";import"./scheduler-CylivXx-.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-select-Z1ywkuii.js";import"./@babel-B036hIWL.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./@popperjs-D8Kg5PqX.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";function ne(){var u;const s=$(),{alert:c,showAlert:d,Alert:l}=F(),[r,h]=t.useState(!0),[m,N]=t.useState([]),i=t.useCallback(async()=>{h(!0);try{const a=await q({page:0,size:1e3},d);N(a.content||[])}catch(a){console.error(a),d("載入系統資料失敗","danger")}finally{h(!1)}},[d]);t.useEffect(()=>{i()},[i]);const n=t.useMemo(()=>{const a=m.length,o=m.filter(S=>S.enabled).length,f=a-o;return{total:a,enabled:o,disabled:f}},[m]),b=t.useMemo(()=>O()?m.map(o=>{const f=z.find(S=>S.id===o.id);return{...o,createdTime:f==null?void 0:f.createdTime}}).sort((o,f)=>!o.createdTime&&!f.createdTime?0:o.createdTime?f.createdTime?new Date(f.createdTime).getTime()-new Date(o.createdTime).getTime():-1:1).slice(0,5):[...m].sort((a,o)=>!a.createdTime&&!o.createdTime?0:a.createdTime?o.createdTime?new Date(o.createdTime).getTime()-new Date(a.createdTime).getTime():-1:1).slice(0,5),[m]),g=a=>{if(!a)return"-";try{const o=new Date(a);return Number.isNaN(o.getTime())?a:o.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return a}},x=a=>{if(!a)return"-";try{const o=new Date(a);return Number.isNaN(o.getTime())?a:o.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return a}},p=a=>a?e.jsx("span",{className:"badge badge-light-success",children:"啟用"}):e.jsx("span",{className:"badge badge-light-secondary",children:"停用"}),v=()=>{i()};return e.jsxs(L,{children:[c&&e.jsx(l,{message:c.message,type:c.type}),e.jsx(U,{title:"系統總覽",breadcrumbs:[{label:"權限管理",href:"#",active:!1},{label:"系統管理",active:!0}]}),e.jsx("div",{className:"app-container container-fluid",children:r?e.jsx("div",{className:"d-flex justify-content-center py-10",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"載入中..."})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-5 g-xl-8 mb-5 mb-xl-10",children:[e.jsx("div",{className:"col-12 col-sm-6 col-xl-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body d-flex flex-column justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"text-muted fw-semibold fs-7",children:"系統總數"}),e.jsx("span",{className:"fw-bold fs-2 text-gray-900 mt-1",children:n.total})]}),e.jsx("span",{className:"badge badge-light-primary p-3",children:e.jsx(y,{iconName:"abstract-27",className:"fs-2"})})]}),e.jsx("div",{className:"separator my-4"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("span",{className:"text-muted fs-8",children:"已啟用"}),e.jsx("span",{className:"fw-bold text-gray-800",children:n.enabled})]})]})})}),e.jsx("div",{className:"col-12 col-sm-6 col-xl-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body d-flex flex-column justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"text-muted fw-semibold fs-7",children:"啟用系統"}),e.jsx("span",{className:"fw-bold fs-2 text-gray-900 mt-1",children:n.enabled})]}),e.jsx("span",{className:"badge badge-light-success p-3",children:e.jsx(y,{iconName:"check-circle",className:"fs-2"})})]}),e.jsx("div",{className:"separator my-4"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("span",{className:"text-muted fs-8",children:"停用"}),e.jsx("span",{className:"fw-bold text-gray-800",children:n.disabled})]})]})})}),e.jsx("div",{className:"col-12 col-sm-6 col-xl-4",children:e.jsx("div",{className:"card h-100",children:e.jsxs("div",{className:"card-body d-flex flex-column justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"text-muted fw-semibold fs-7",children:"最近創建"}),e.jsxs("span",{className:"fw-bold fs-2 text-gray-900 mt-1",children:[b.length," 個"]})]}),e.jsx("span",{className:"badge badge-light-warning p-3",children:e.jsx(y,{iconName:"time",className:"fs-2"})})]}),e.jsx("div",{className:"separator my-4"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("span",{className:"text-muted fs-8",children:"創建時間"}),e.jsx("span",{className:"fw-bold text-gray-800",children:b.length>0?x(O()?(u=z.find(a=>a.id===b[0].id))==null?void 0:u.createdTime:b[0].createdTime):"-"})]})]})})})]}),e.jsx("div",{className:"row g-5 g-xl-8",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card h-100",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"最近創建的系統"}),e.jsx("span",{className:"text-muted mt-1 fw-semibold fs-7",children:"最近創建的 5 個系統"})]}),e.jsx("div",{className:"card-toolbar",children:e.jsxs("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:()=>s("/upms/system/list"),children:["查看全部",e.jsx(y,{iconName:"arrow-right",className:"fs-4 ms-1"})]})})]}),e.jsx("div",{className:"card-body pt-0",children:b.length===0?e.jsxs("div",{className:"text-center py-10 text-muted",children:[e.jsx(y,{iconName:"information-5",className:"fs-2x text-muted mb-3"}),e.jsx("p",{className:"mb-0",children:"尚無系統資料"})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"系統代碼"}),e.jsx("th",{className:"min-w-200px",children:"系統名稱"}),e.jsx("th",{className:"min-w-100px",children:"狀態"}),e.jsx("th",{className:"min-w-150px",children:"創建時間"}),e.jsx("th",{className:"min-w-100px text-end",children:"操作"})]})}),e.jsx("tbody",{children:b.map(a=>{var o;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge badge-light-info fs-7 fw-bold",children:a.code})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-800 fw-bold",children:a.name})}),e.jsx("td",{children:p(a.enabled)}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fs-7",children:g(O()?(o=z.find(f=>f.id===a.id))==null?void 0:o.createdTime:a.createdTime)})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:()=>s(`/upms/system/${a.id}/detail`),children:"詳情"})})]},a.id)})})]})})})]})})}),e.jsx("div",{className:"row g-5 g-xl-8 mt-1",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header border-0 pt-6",children:e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"快速操作"})})}),e.jsx("div",{className:"card-body pt-0",children:e.jsxs("div",{className:"d-flex flex-wrap gap-3",children:[e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:()=>s("/upms/system/create"),children:[e.jsx(y,{iconName:"plus",className:"fs-2 me-2"}),"新增系統"]}),e.jsxs("button",{type:"button",className:"btn btn-light-primary",onClick:()=>s("/upms/system/list"),children:[e.jsx(y,{iconName:"list",className:"fs-2 me-2"}),"查看所有系統"]}),e.jsxs("button",{type:"button",className:"btn btn-light",onClick:v,children:[e.jsx(y,{iconName:"arrows-circle",className:"fs-2 me-2"}),"刷新"]})]})})]})})})]})})]})}const re=10,ce=s=>{if(!s)return"-";try{const c=new Date(s);if(Number.isNaN(c.getTime()))return s;const d=c.getFullYear(),l=String(c.getMonth()+1).padStart(2,"0"),r=String(c.getDate()).padStart(2,"0"),h=String(c.getHours()).padStart(2,"0"),m=String(c.getMinutes()).padStart(2,"0");return`${d}/${l}/${r} ${h}:${m}`}catch{return s}},ie=({searchKeyword:s,showAlert:c,onEdit:d,onReload:l})=>{const r=$(),[h,m]=t.useState([]),[N,i]=t.useState(0),[n,b]=t.useState(1),[g,x]=t.useState(1),[p,v]=t.useState(!1),[u,a]=t.useState(null),[o,f]=t.useState(!1),S=t.useCallback(async()=>{v(!0);try{const j={page:g-1,size:re,keyword:s!=null&&s.trim()?s.trim():void 0},w=await q(j,c);m(w.content),i(w.totalElements),b(w.totalPages||1)}finally{v(!1)}},[g,s,c]);t.useEffect(()=>{x(1)},[s]),t.useEffect(()=>{S()},[S]);const k=t.useCallback(j=>{r(`/upms/system/${j.id}/detail`)},[r]),Y=j=>a(j),G=async()=>{if(!u)return;const j=u.id;if(!j){c("缺少系統識別碼，無法刪除","danger");return}try{f(!0),await Z(String(j),c)&&(await S(),l==null||l(),a(null))}finally{f(!1)}},V=[{header:"系統代碼",className:"min-w-140px"},{header:"系統名稱",className:"min-w-180px"},{header:"狀態",className:"min-w-100px"},{header:"建立時間",className:"min-w-125px"},{header:"操作",className:"text-end min-w-100px"}];return e.jsxs(e.Fragment,{children:[e.jsx(se,{columns:V,rows:h,loading:p,emptyText:"沒有系統資料",page:g,totalPages:n,totalElements:N,onPrev:()=>x(j=>Math.max(1,j-1)),onNext:()=>x(j=>Math.min(n||1,j+1)),tableClassName:"table align-middle table-row-dashed fs-6 gy-5 dataTable no-footer",renderRow:j=>e.jsxs("tr",{className:"cursor-pointer table-row-hover text-gray-600 fw-bold",onClick:()=>k(j),children:[e.jsx("td",{className:"fw-bold text-gray-900",children:j.code??"-"}),e.jsx("td",{children:j.name??"-"}),e.jsx("td",{children:j.enabled?e.jsx("span",{className:"badge badge-light-success fw-bolder",children:"啟用"}):e.jsx("span",{className:"badge badge-light-secondary fw-bolder",children:"停用"})}),e.jsx("td",{children:j.createdTime?e.jsx("span",{className:"text-muted fw-semibold",children:ce(j.createdTime)}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"text-end",onClick:w=>w.stopPropagation(),children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-light-primary btn-sm",onClick:w=>{w.preventDefault(),k(j)},title:"查看詳情",children:e.jsx(y,{iconName:"eye",className:"fs-2"})}),d&&e.jsx("button",{className:"btn btn-light-warning btn-sm",onClick:w=>{w.preventDefault(),d(j)},title:"編輯",children:e.jsx(y,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-light-danger btn-sm",onClick:w=>{w.preventDefault(),Y(j)},title:"刪除",children:e.jsx(y,{iconName:"trash",className:"fs-2"})})]})})]},String(j.id??j.code))}),u&&e.jsx(ee,{open:!!u,title:"刪除系統",deleting:o,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除系統"," ",e.jsx("strong",{children:u.code??u.id??"-"})," ","嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>o?null:a(null),onConfirm:G})]})},B=s=>s.trim().toUpperCase(),I=s=>s.trim(),de=({open:s,onClose:c,onSaved:d,showAlert:l,editingSystem:r,disableCodeOnEdit:h=!0})=>{const m=!!r,N=m&&h,[i,n]=t.useState(""),[b,g]=t.useState(""),[x,p]=t.useState(!0),[v,u]=t.useState(""),[a,o]=t.useState(!1);t.useEffect(()=>{if(s){if(!r){n(""),g(""),p(!0),u("");return}n(r.code??""),g(r.name??""),p(!!r.enabled),u(r.remark??"")}},[s,r]);const f=()=>B(i)?I(b)?!0:(l("請輸入系統名稱（name）","warning"),!1):(l("請輸入系統代碼（code）","warning"),!1),S=async()=>{if(f())try{if(o(!0),m&&r){const k={...N?{}:{code:B(i)},name:I(b),enabled:x,remark:v.trim()||void 0};await K(r.id,k,l)}else{const k={code:B(i),name:I(b),enabled:x,remark:v.trim()||void 0};await W(k,l)}d()}catch(k){console.error(k),l("儲存失敗，請稍後再試","danger")}finally{o(!1)}};return s?e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,.25)"},role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(y,{iconName:m?"message-edit":"plus",className:"fs-2 me-2"}),m?"編輯系統":"新增系統"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:c,disabled:a,"aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"系統代碼（code）"}),e.jsx("input",{className:"form-control",value:i,onChange:k=>n(k.target.value),placeholder:"例如：TOM / UPMS / ADM",autoFocus:!0,disabled:N}),e.jsx("div",{className:"text-muted fs-8 mt-1",children:"會自動 trim + upper（避免 tom / TOM 重複）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"系統名稱（name）"}),e.jsx("input",{className:"form-control",value:b,onChange:k=>g(k.target.value),placeholder:"例如：訂單管理"})]}),e.jsxs("div",{className:"form-check form-switch form-check-custom form-check-solid",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"systemEnabledSwitch",checked:x,onChange:k=>p(k.target.checked)}),e.jsx("label",{className:"form-check-label",htmlFor:"systemEnabledSwitch",children:"啟用"})]})]}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"備註（remark）"}),e.jsx("textarea",{className:"form-control",rows:6,value:v,onChange:k=>u(k.target.value),placeholder:"可留空"})]}),m&&(r==null?void 0:r.id)&&e.jsxs("div",{className:"text-muted fs-8",children:["系統 ID：",e.jsx("span",{className:"fw-semibold",children:String(r.id)})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-light",onClick:c,disabled:a,children:"取消"}),e.jsx("button",{className:"btn btn-primary",onClick:S,disabled:a,children:a?"儲存中…":"儲存"})]})]})})}):null};function me(){const{alert:s,showAlert:c,Alert:d}=F(),l=$(),[r,h]=t.useState(""),[m,N]=t.useState(""),[i,n]=t.useState(0),[b,g]=t.useState(!1),[x,p]=t.useState(null),v=f=>{f.key==="Enter"&&h(m.trim())},u=()=>{n(f=>f+1),g(!1),p(null)},a=()=>{l("/upms/system/create")},o=f=>{p(f),g(!0)};return t.useEffect(()=>{},[]),e.jsxs(L,{children:[s&&e.jsx(d,{message:s.message,type:s.type}),e.jsx(U,{title:"系統列表",breadcrumbs:[{label:"權限管理",href:"#"},{label:"系統管理",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(y,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"搜尋系統...",value:m,onChange:f=>N(f.target.value),onKeyDown:v})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end gap-2","data-kt-user-table-toolbar":"base",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:a,children:[e.jsx(y,{iconName:"plus",className:"fs-2"}),"新增系統"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(ie,{searchKeyword:r,showAlert:c,onEdit:o,onReload:u},i)})]})}),e.jsx(de,{open:b,onClose:()=>{g(!1),p(null)},showAlert:c,editingSystem:x,onSaved:u})]})}const oe=({submitting:s=!1,onSubmit:c,onCancel:d})=>{const[l,r]=t.useState({code:"",name:"",enabled:!0,remark:""}),{touch:h,markSubmitted:m,showError:N,invalidClass:i}=te(),n=t.useMemo(()=>{const x={},p=R(l.code),v=E(l.name);return p?ae.test(p)||(x.code="格式不正確（2~50，英數 + _-，且需以英數開頭）"):x.code="系統代碼為必填",v?v.length>100&&(x.name="系統名稱長度不可超過 100"):x.name="系統名稱為必填",l.remark&&E(l.remark).length>500&&(x.remark="備註長度不可超過 500"),x},[l]),b=x=>p=>r(v=>({...v,[x]:p.target.value})),g=async x=>{x.preventDefault(),m(),!Object.keys(n).length&&await c({...l,code:R(l.code),name:E(l.name),remark:H(l.remark),enabled:!!l.enabled})};return e.jsxs("form",{onSubmit:g,className:"form",children:[e.jsxs("div",{className:"row g-6",children:[e.jsxs("div",{className:"col-12 col-lg-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:["系統代碼 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{className:`form-control form-control-solid ${i("code",n)}`,placeholder:"例如：UPMS / TOM / ADM",value:l.code,onChange:x=>r(p=>({...p,code:x.target.value.toUpperCase()})),onBlur:h("code"),disabled:s,autoFocus:!0}),e.jsxs("div",{className:"form-text text-muted",children:["會自動轉大寫；允許英數 + ",e.jsx("code",{children:"_"})," / ",e.jsx("code",{children:"-"})]}),N("code",n)&&e.jsx("div",{className:"invalid-feedback",children:n.code})]}),e.jsxs("div",{className:"col-12 col-lg-8",children:[e.jsxs("label",{className:"form-label fw-bold",children:["系統名稱 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{className:`form-control form-control-solid ${i("name",n)}`,placeholder:"例如：權限管理系統",value:l.name,onChange:b("name"),onBlur:h("name"),disabled:s}),N("name",n)&&e.jsx("div",{className:"invalid-feedback",children:n.name})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:!!l.enabled,onChange:x=>r(p=>({...p,enabled:x.target.checked})),disabled:s}),e.jsx("label",{className:"form-check-label",children:"啟用"})]}),e.jsx("div",{className:"text-muted fs-8 mt-1",children:"停用後通常不允許登入或不顯示於下拉選單（視後端規則）"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-bold",children:"備註"}),e.jsx("textarea",{className:`form-control form-control-solid ${i("remark",n)}`,placeholder:"可留空",rows:3,value:l.remark??"",onChange:b("remark"),onBlur:h("remark"),disabled:s}),N("remark",n)&&e.jsx("div",{className:"invalid-feedback d-block",children:n.remark})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-3 mt-10",children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:d,disabled:s,children:"取消"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s,children:"新增系統"})]})]})},xe=s=>({code:R(s.code),name:E(s.name),enabled:s.enabled??!0,remark:H(s.remark)}),he=()=>{const s=$(),{alert:c,showAlert:d,Alert:l}=F(),[r,h]=t.useState(!1),m=t.useCallback(()=>{s(-1)},[s]),N=t.useCallback(async i=>{h(!0);try{if(await W(xe(i),d)){s("/upms/system/list");return}}catch(n){console.error(n),d("系統發生錯誤，請稍後再試","danger")}finally{h(!1)}},[s,d]);return e.jsxs(L,{children:[c&&e.jsx(l,{message:c.message,type:c.type}),e.jsx(U,{title:"新增系統",breadcrumbs:[{label:"UPMS 權限管理",href:"#",active:!1},{label:"系統",active:!1},{label:"新增",active:!0}]}),e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx(oe,{submitting:r,onSubmit:N,onCancel:m})})})})]})},D=s=>s==null||s===""?"-":String(s),P=s=>s.trim(),_=s=>{var d;const c=P(s.name);return c?c.length>128?"系統名稱長度不可超過 128":((d=s.remark)==null?void 0:d.length)>255?"系統描述長度不可超過 255":null:"系統名稱不可為空"},ue=({detail:s,reload:c,showAlert:d})=>{const l=t.useMemo(()=>({name:s.name??"",remark:s.remark??"",enabled:s.enabled??!1}),[s]),[r,h]=t.useState(!1),[m,N]=t.useState(!1),[i,n]=t.useState(l),b=t.useMemo(()=>P(i.name)!==P(l.name)||(i.remark??"")!==(l.remark??"")||!!i.enabled!=!!l.enabled,[i,l]),g=t.useMemo(()=>_(i),[i]);t.useEffect(()=>{r||n(l)},[l,r]);const x=()=>{n(l),h(!0)},p=()=>{n(l),h(!1)},v=async()=>{const u=_(i);if(u){d==null||d(u,"warning");return}if(!b){h(!1);return}N(!0);try{await K(s.id,{name:P(i.name),remark:i.remark,enabled:i.enabled}),d==null||d("更新成功","success"),h(!1),await c()}catch(a){console.error(a),d==null||d("更新失敗，請稍後再試","danger")}finally{N(!1)}};return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header align-items-center",children:[e.jsx("div",{className:"card-title m-0",children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(y,{iconName:"information-4",className:"fs-2"}),e.jsx("h3",{className:"fw-bold m-0",children:"基本資訊"})]})}),e.jsx("div",{className:"card-toolbar",children:r?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:v,disabled:m||!!g||!b,title:b?g??"":"尚未修改",children:m?e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"spinner-border spinner-border-sm"}),"更新中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{iconName:"check",className:"fs-3 me-1"}),"更新"]})}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:p,disabled:m,children:"取消"})]}):e.jsxs("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:x,children:[e.jsx(y,{iconName:"pencil",className:"fs-3 me-1"}),"編輯"]})})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"table-responsive",children:e.jsx("table",{className:"table table-row-dashed table-row-gray-200 align-middle gs-0 gy-3",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted w-150px",children:"系統代碼"}),e.jsx("td",{className:"fw-semibold",children:e.jsx("span",{className:"badge badge-light text-gray-800",children:D(s.code)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"系統名稱"}),e.jsx("td",{className:"fw-semibold",children:r?e.jsx("input",{className:"form-control form-control-sm",value:i.name,onChange:u=>n(a=>({...a,name:u.target.value})),placeholder:"例如：權限管理系統",disabled:m,maxLength:128}):D(s.name)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"系統描述"}),e.jsx("td",{className:"fw-semibold",children:r?e.jsx("textarea",{className:"form-control form-control-sm",rows:3,value:i.remark,onChange:u=>n(a=>({...a,remark:u.target.value})),placeholder:"備註 / 描述",disabled:m,maxLength:255}):e.jsx("div",{className:"text-gray-800",style:{whiteSpace:"pre-wrap"},children:D(s.remark)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"啟用狀態"}),e.jsx("td",{className:"fw-semibold",children:r?e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"form-check form-switch form-check-custom form-check-solid m-0",children:e.jsx("input",{className:"form-check-input",type:"checkbox",checked:i.enabled,onChange:u=>n(a=>({...a,enabled:u.target.checked})),disabled:m})}),e.jsx("span",{className:"text-muted fs-8",children:i.enabled?"啟用中（前端可使用此分類）":"停用（保留資料，不建議硬刪）"})]}):s.enabled?e.jsx("span",{className:"badge badge-light-success",children:"啟用"}):e.jsx("span",{className:"badge badge-light-secondary",children:"停用"})})]})]})})}),e.jsx("div",{className:"d-flex justify-content-between align-items-center mt-3",children:e.jsxs("div",{className:"text-muted fs-8",children:["UUID：",D(s.id)]})})]})]})},fe=()=>{const{id:s}=Q(),{alert:c,showAlert:d,Alert:l}=F(),[r,h]=t.useState(!0),[m,N]=t.useState(null),i=t.useCallback(async()=>{if(s){h(!0);try{const n=await J(s);N(n)}catch(n){console.error(n),d("取得系統詳情失敗","danger"),N(null)}finally{h(!1)}}},[s,d]);return t.useEffect(()=>{i()},[]),e.jsxs(L,{children:[c&&e.jsx(l,{message:c.message,type:c.type}),e.jsx(U,{title:"系統詳情",breadcrumbs:[{label:"系統管理",href:"#"},{label:"系統",active:!1},{label:"詳情",active:!0}]}),e.jsx("div",{className:"app-container container-fluid",children:r?e.jsx("div",{className:"d-flex justify-content-center py-10",children:e.jsx(le,{animation:"border"})}):m?e.jsxs("div",{className:"row g-6",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsx(ue,{detail:m,reload:i})}),e.jsx("div",{className:"col-12 col-lg-6"}),e.jsx("div",{className:"col-12 col-lg-6"}),e.jsx("div",{className:"col-12 col-lg-6"})]}):e.jsx("div",{className:"text-center py-10 text-muted",children:"查無系統資料"})})]})},M=[{title:"系統管理",path:"/upms/system/overview",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],us=()=>e.jsxs(X,{children:[e.jsx(C,{index:!0,element:e.jsx(A,{to:"overview",replace:!0})}),e.jsx(C,{path:"overview",element:e.jsxs(e.Fragment,{children:[e.jsx(T,{breadcrumbs:M,children:"系統總覽"}),e.jsx(ne,{})]})}),e.jsx(C,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(T,{breadcrumbs:M,children:"系統列表"}),e.jsx(me,{})]})}),e.jsx(C,{path:"create",element:e.jsxs(e.Fragment,{children:[e.jsx(T,{breadcrumbs:M,children:"新增系統"}),e.jsx(he,{})]})}),e.jsx(C,{path:":id/detail",element:e.jsxs(e.Fragment,{children:[e.jsx(T,{breadcrumbs:M,children:"系統詳情"}),e.jsx(fe,{})]})})]});export{us as default};
