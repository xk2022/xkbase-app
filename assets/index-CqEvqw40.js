import{r as s,j as e}from"./react-DwkAs-v9.js";import{i as $,h as Q,o as V,K as P,e as X,C as H,P as J}from"./index-wbzsHQ-6.js";import{A as Y}from"./AppToolbar-BZHSVYI7.js";import{C as w}from"./ConfirmDeleteModal-BXGAXcew.js";import{A as W,E as A,M as ee}from"./MockDataDialog-BDsNkKVe.js";import{P as ae}from"./PagedTable-fW2f3xMh.js";import{a as _,d as te,e as O,f as se}from"./react-router-Df4HDh8c.js";import"./apexcharts-sziEC8OT.js";import"./react-dom-DVTd-Q6a.js";import"./scheduler-CylivXx-.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-bootstrap-BUaeuJHt.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./@popperjs-D8Kg5PqX.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";import"./@babel-B036hIWL.js";import"./react-select-Z1ywkuii.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";const I=[{id:"1",name:"張三",licenseNumber:"A123456789",licenseType:"大貨車",licenseExpiryDate:"2025-12-31",qualificationCert:"Q001",qualificationExpiryDate:"2025-06-30",phone:"0912-345-678",email:"zhang@example.com",status:"active",createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-01-15T10:00:00Z"},{id:"2",name:"李四",licenseNumber:"B987654321",licenseType:"聯結車",licenseExpiryDate:"2026-03-31",qualificationCert:"Q002",qualificationExpiryDate:"2025-09-30",phone:"0923-456-789",email:"li@example.com",status:"active",createdAt:"2024-02-20T10:00:00Z",updatedAt:"2024-02-20T10:00:00Z"},{id:"3",name:"王五",licenseNumber:"C111222333",licenseType:"大貨車",licenseExpiryDate:"2025-08-15",qualificationCert:"Q003",qualificationExpiryDate:"2025-12-31",phone:"0934-567-890",email:"wang@example.com",status:"active",createdAt:"2024-03-10T10:00:00Z",updatedAt:"2024-03-10T10:00:00Z"}],K="/api/hrm/drivers";async function ne(a,t){if($())return console.log("[Mock] 模擬創建司機",a),await new Promise(l=>setTimeout(l,500)),t==null||t("司機資料建立成功 (Mock)","success"),!0;try{return await Q.post(K,a),t==null||t("司機資料建立成功","success"),!0}catch(l){return console.error(l),t==null||t("建立司機資料失敗，請稍後再試","danger"),!1}}async function le(a,t){if($())return console.log("[Mock] 使用 Mock 司機列表",a),await new Promise(l=>setTimeout(l,300)),Promise.resolve({content:I,totalElements:I.length,totalPages:1,size:a.size??10,number:a.page??0,first:(a.page??0)===0,last:!0,empty:I.length===0});try{const r=(await Q.get(K,{params:a})).data.data;return{...r,content:r.content||[]}}catch(l){console.error(l);const r=W.fromAxiosError(l);if(r.isServerError)throw r;return t==null||t("取得司機列表失敗，請稍後再試","danger"),{content:[],totalElements:0,totalPages:0,size:a.size??10,number:a.page??0,first:!0,last:!0,empty:!0}}}async function ie(a,t,l){if($())return console.log("[Mock] 模擬更新司機",a,t),await new Promise(c=>setTimeout(c,500)),l==null||l("更新司機資料成功 (Mock)","success"),I.find(c=>c.id===a);try{const r=await Q.put(`${K}/${a}`,t);return l==null||l("更新司機資料成功","success"),r.data.data}catch(r){throw console.error(r),l==null||l("更新司機資料失敗，請稍後再試","danger"),r}}async function re(a,t){if($())return console.log("[Mock] 模擬刪除司機",a),await new Promise(l=>setTimeout(l,500)),t==null||t("刪除司機資料成功 (Mock)","success"),!0;try{return await Q.delete(`${K}/${a}`),t==null||t("刪除司機資料成功","success"),!0}catch(l){return console.error(l),t==null||t("刪除司機資料失敗，請稍後再試","danger"),!1}}const oe=10,U=a=>a?new Date(a).toLocaleDateString("zh-TW"):"-",ce=a=>{if(!a)return{label:"-",className:"badge-light-secondary"};switch(a){case"active":return{label:"啟用",className:"badge-light-success"};case"inactive":return{label:"停用",className:"badge-light-danger"};default:return{label:a,className:"badge-light-secondary"}}},me=({searchKeyword:a,showAlert:t,onEdit:l})=>{const r=_(),[c,N]=s.useState([]),[j,S]=s.useState(0),[v,D]=s.useState(1),[f,u]=s.useState(1),[k,g]=s.useState(!1),[p,b]=s.useState(null),[y,C]=s.useState(!1),[m,E]=s.useState(!1),[M,T]=s.useState(!1),x=s.useCallback(async()=>{g(!0),E(!1);try{const n={page:f-1,size:oe,keyword:a!=null&&a.trim()?a.trim():void 0},d=await le(n,t);N(d.content),S(d.totalElements),D(d.totalPages||1)}catch(n){W.fromAxiosError(n).isServerError?(E(!0),T(!0)):t("取得司機列表失敗，請稍後再試","danger")}finally{g(!1)}},[f,a,t]),q=s.useCallback(()=>{V(),T(!1),E(!1),x()},[x]),L=s.useCallback(()=>{E(!1),x()},[x]);s.useEffect(()=>{u(1)},[a]),s.useEffect(()=>{x()},[x]);const R=s.useCallback(n=>{r(`/hrm/driver/${n.id}/detail`)},[r]),z=n=>b(n),Z=async()=>{if(!p)return;const n=p.id;if(!n){t("缺少司機識別碼，無法刪除","danger");return}try{C(!0),await re(String(n),t)&&(await x(),b(null))}finally{C(!1)}};if(m)return e.jsxs(e.Fragment,{children:[e.jsx(A,{onRetry:L,showMockOption:!0,onUseMock:q}),e.jsx(ee,{open:M,onConfirm:q,onCancel:()=>T(!1)})]});const F=[{header:"姓名",className:"min-w-100px"},{header:"駕照號碼",className:"min-w-150px"},{header:"駕照類型",className:"min-w-120px"},{header:"駕照到期日",className:"min-w-120px"},{header:"資格證",className:"min-w-120px"},{header:"資格證到期日",className:"min-w-120px"},{header:"聯絡電話",className:"min-w-120px"},{header:"狀態",className:"min-w-100px"},{header:"操作",className:"text-end min-w-200px"}];return e.jsxs(e.Fragment,{children:[e.jsx(ae,{columns:F,rows:c,loading:k,emptyText:"沒有司機資料",page:f,totalPages:v,totalElements:j,onPrev:()=>u(n=>Math.max(1,n-1)),onNext:()=>u(n=>Math.min(v||1,n+1)),renderRow:n=>{const d=ce(n.status);return e.jsxs("tr",{className:"cursor-pointer table-row-hover",onClick:()=>R(n),children:[e.jsx("td",{className:"fw-bold text-gray-900",children:n.name}),e.jsx("td",{children:n.licenseNumber}),e.jsx("td",{children:n.licenseType}),e.jsx("td",{children:U(n.licenseExpiryDate)}),e.jsx("td",{children:n.qualificationCert||"-"}),e.jsx("td",{children:U(n.qualificationExpiryDate)}),e.jsx("td",{children:n.phone||"-"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${d.className} fw-bold`,children:d.label})}),e.jsx("td",{className:"text-end",onClick:h=>h.stopPropagation(),children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-light-primary btn-sm",onClick:h=>{h.preventDefault(),R(n)},title:"查看詳情",children:e.jsx(P,{iconName:"eye",className:"fs-2"})}),l&&e.jsx("button",{className:"btn btn-light-warning btn-sm",onClick:h=>{h.preventDefault(),l(n)},title:"編輯",children:e.jsx(P,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-light-danger btn-sm",onClick:h=>{h.preventDefault(),z(n)},title:"刪除",children:e.jsx(P,{iconName:"trash",className:"fs-2"})})]})})]},String(n.id??Math.random()))}}),p&&e.jsx(w,{open:!!p,title:"刪除司機資料",deleting:y,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除司機 ",e.jsx("strong",{children:p.name??"-"})," 的資料嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>y?null:b(null),onConfirm:Z})]})},o=a=>a.trim(),de=({open:a,onClose:t,onSaved:l,showAlert:r,editingDriver:c})=>{const N=!!c,[j,S]=s.useState(""),[v,D]=s.useState(""),[f,u]=s.useState(""),[k,g]=s.useState(""),[p,b]=s.useState(""),[y,C]=s.useState(""),[m,E]=s.useState(""),[M,T]=s.useState(""),[x,q]=s.useState(""),[L,R]=s.useState(""),[z,Z]=s.useState(""),[F,n]=s.useState(""),[d,h]=s.useState(!1);s.useEffect(()=>{if(a){if(!c){S(""),D(""),u(""),g(""),b(""),C(""),E(""),T(""),q(""),R(""),Z(""),n("");return}S(c.name||""),D(c.licenseNumber||""),u(c.licenseType||""),g(c.licenseExpiryDate||""),b(c.qualificationCert||""),C(c.qualificationExpiryDate||""),E(c.phone||""),T(c.email||"")}},[a,c]);const B=()=>o(j)?o(v)?o(f)?!0:(r("請輸入駕照類型","warning"),!1):(r("請輸入駕照號碼","warning"),!1):(r("請輸入姓名","warning"),!1),G=async()=>{if(B())try{if(h(!0),N&&c){const i={id:c.id,name:o(j),licenseNumber:o(v),licenseType:o(f),licenseExpiryDate:k||void 0,qualificationCert:o(p)||void 0,qualificationExpiryDate:y||void 0,phone:o(m)||void 0,email:o(M)||void 0,address:o(x)||void 0,emergencyContact:o(L)||void 0,emergencyPhone:o(z)||void 0,notes:o(F)||void 0};await ie(c.id,i,r)}else{const i={name:o(j),licenseNumber:o(v),licenseType:o(f),licenseExpiryDate:k||void 0,qualificationCert:o(p)||void 0,qualificationExpiryDate:y||void 0,phone:o(m)||void 0,email:o(M)||void 0,address:o(x)||void 0,emergencyContact:o(L)||void 0,emergencyPhone:o(z)||void 0,notes:o(F)||void 0};await ne(i,r)}l()}catch(i){console.error(i),r("儲存失敗，請稍後再試","danger")}finally{h(!1)}};return a?e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,.25)"},role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(P,{iconName:N?"message-edit":"plus",className:"fs-2 me-2"}),N?"編輯司機資料":"新增司機資料"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:t,disabled:d,"aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"姓名"}),e.jsx("input",{className:"form-control",value:j,onChange:i=>S(i.target.value),placeholder:"請輸入姓名",autoFocus:!N})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"駕照號碼"}),e.jsx("input",{className:"form-control",value:v,onChange:i=>D(i.target.value),placeholder:"請輸入駕照號碼"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"駕照類型"}),e.jsxs("select",{className:"form-select",value:f,onChange:i=>u(i.target.value),children:[e.jsx("option",{value:"",children:"請選擇"}),e.jsx("option",{value:"大貨車",children:"大貨車"}),e.jsx("option",{value:"聯結車",children:"聯結車"}),e.jsx("option",{value:"小貨車",children:"小貨車"}),e.jsx("option",{value:"其他",children:"其他"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"駕照到期日"}),e.jsx("input",{className:"form-control",type:"date",value:k,onChange:i=>g(i.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"資格證"}),e.jsx("input",{className:"form-control",value:p,onChange:i=>b(i.target.value),placeholder:"請輸入資格證號碼"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"資格證到期日"}),e.jsx("input",{className:"form-control",type:"date",value:y,onChange:i=>C(i.target.value)})]})]}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"聯絡電話"}),e.jsx("input",{className:"form-control",value:m,onChange:i=>E(i.target.value),placeholder:"請輸入聯絡電話"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"電子郵件"}),e.jsx("input",{className:"form-control",type:"email",value:M,onChange:i=>T(i.target.value),placeholder:"請輸入電子郵件"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"地址"}),e.jsx("textarea",{className:"form-control",rows:3,value:x,onChange:i=>q(i.target.value),placeholder:"請輸入地址"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"緊急聯絡人"}),e.jsx("input",{className:"form-control",value:L,onChange:i=>R(i.target.value),placeholder:"請輸入緊急聯絡人姓名"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"緊急聯絡電話"}),e.jsx("input",{className:"form-control",value:z,onChange:i=>Z(i.target.value),placeholder:"請輸入緊急聯絡電話"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"備註"}),e.jsx("textarea",{className:"form-control",rows:3,value:F,onChange:i=>n(i.target.value),placeholder:"請輸入備註"})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-light",onClick:t,disabled:d,children:"取消"}),e.jsx("button",{className:"btn btn-primary",onClick:G,disabled:d,children:d?"儲存中…":"儲存"})]})]})})}):null};function ue(){const{alert:a,showAlert:t,Alert:l}=X(),r=_(),[c,N]=s.useState(""),[j,S]=s.useState(""),[v,D]=s.useState(0),[f,u]=s.useState(!1),[k,g]=s.useState(null),p=m=>{m.key==="Enter"&&N(j.trim())},b=()=>{D(m=>m+1),u(!1),g(null)},y=()=>{r("/hrm/driver/create")},C=m=>{g(m),u(!0)};return s.useEffect(()=>{},[t]),e.jsxs(H,{children:[a&&e.jsx(l,{message:a.message,type:a.type}),e.jsx(Y,{title:"司機資料台帳",breadcrumbs:[{label:"人資管理",href:"#"},{label:"司機資料台帳",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(P,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"姓名 / 駕照號碼 / 資格證…",value:j,onChange:m=>S(m.target.value),onKeyDown:p})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end gap-2 flex-wrap",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:y,children:[e.jsx(P,{iconName:"plus",className:"fs-2"}),"新增司機"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(me,{searchKeyword:c,showAlert:t,onEdit:C},v)})]})}),e.jsx(de,{open:f,onClose:()=>{u(!1),g(null)},showAlert:t,editingDriver:k,onSaved:b})]})}const pe=[{title:"司機資料台帳",path:"/hrm/driver/list",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],da=()=>e.jsxs(te,{children:[e.jsx(O,{path:"",element:e.jsx(se,{to:"list",replace:!0})}),e.jsx(O,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(J,{breadcrumbs:pe,children:"司機資料台帳"}),e.jsx(ue,{})]})})]});export{da as default};
