import{r as n,j as e}from"./react-DwkAs-v9.js";import{b as ce,c as oe,d as de,C as _,K as y,P as H,T as me,i as L,h as O,o as A,e as Q}from"./index-wbzsHQ-6.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-dom-DVTd-Q6a.js";import{a as ee,g as ue,d as xe,e as K,f as he}from"./react-router-Df4HDh8c.js";import{A as W}from"./AppToolbar-BZHSVYI7.js";import{C as te}from"./ConfirmDeleteModal-BXGAXcew.js";import{A as Y,E as ae,M as le}from"./MockDataDialog-BDsNkKVe.js";import{P as re}from"./PagedTable-fW2f3xMh.js";import"./apexcharts-sziEC8OT.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-bootstrap-BUaeuJHt.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./@popperjs-D8Kg5PqX.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";import"./@babel-B036hIWL.js";import"./react-select-Z1ywkuii.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";import"./scheduler-CylivXx-.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";const pe=()=>{const{hasSystemPermission:s,hasSystem:a,systems:l,setSelectedSystemUuid:c}=ce(),{hasPermission:o}=oe(),r=ee();n.useEffect(()=>{const h=l.find(i=>{var d;return((d=i.code)==null?void 0:d.toUpperCase())==="CRM"});h&&c(h.id)},[l,c]);const p=n.useMemo(()=>{const h=[];return de.forEach(i=>{if(i.requiredSystem!=="CRM"||!i.sectionTitle)return;const d=[];i.items.forEach(m=>{if(!(m.to==="/crm/dashboard"||m.to.includes("/:id/")||m.to.includes("/:uuid/"))&&m.type==="item"){let x=!1;if(m.requiredPermission){const b=s(m.requiredPermission),g=o(m.requiredPermission);x=!b||!g}d.push({title:m.title,path:m.to,requiredPermission:m.requiredPermission,disabled:x})}}),h.push({sectionTitle:i.sectionTitle,displayTitle:i.sectionTitle,items:d})}),h},[s,a,o]),j=(h,i)=>{i||r(h)};return e.jsx(_,{children:e.jsxs("div",{className:"row g-5 g-xl-10 mb-5 mb-xl-10",children:[e.jsx("div",{className:"col-12 mb-5",children:e.jsxs("div",{className:"card card-flush",children:[e.jsx("div",{className:"card-header pt-7",children:e.jsx("div",{className:"card-title",children:e.jsx("h2",{className:"fw-bold text-gray-800",children:"CRM 客戶管理系統"})})}),e.jsx("div",{className:"card-body pt-6",children:e.jsx("p",{className:"text-gray-600 fs-6 mb-0",children:"以下是 CRM 系統的可用功能模組，請選擇一個模組開始使用。"})})]})}),p.length===0?e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card card-flush",children:e.jsxs("div",{className:"card-body text-center py-10",children:[e.jsx(y,{iconName:"information-5",className:"fs-3x text-gray-400 mb-5"}),e.jsx("h3",{className:"text-gray-800 mb-3",children:"暫無可用功能"}),e.jsx("p",{className:"text-gray-600 mb-0",children:"您目前沒有可訪問的功能，請聯繫管理員分配權限。"})]})})}):e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex gap-5 overflow-x-auto pb-3 crm-dashboard-scroll",style:{scrollbarWidth:"thin",scrollbarColor:"#cbd5e0 transparent",WebkitOverflowScrolling:"touch"},children:[e.jsx("style",{children:`
                .crm-dashboard-scroll::-webkit-scrollbar {
                  height: 8px;
                }
                .crm-dashboard-scroll::-webkit-scrollbar-track {
                  background: transparent;
                }
                .crm-dashboard-scroll::-webkit-scrollbar-thumb {
                  background-color: #cbd5e0;
                  border-radius: 4px;
                }
                .crm-dashboard-scroll::-webkit-scrollbar-thumb:hover {
                  background-color: #a0aec0;
                }
              `}),p.map(h=>e.jsxs("div",{className:"card card-flush flex-shrink-0",style:{minWidth:"300px",width:"300px"},children:[e.jsx("div",{className:"card-header pt-7",children:e.jsx("div",{className:"card-title",children:e.jsx("h3",{className:"fw-bold text-gray-800 fs-4",children:h.displayTitle})})}),e.jsx("div",{className:"card-body pt-6",children:e.jsxs("div",{className:"d-flex flex-column gap-3",children:[h.items.map((i,d)=>e.jsx("button",{type:"button",className:`btn btn-flex text-start p-4 ${i.disabled?"btn-light-secondary":"btn-light btn-active-light-primary"}`,onClick:()=>j(i.path,i.disabled),disabled:i.disabled,style:{transition:"all 0.2s ease",opacity:i.disabled?.6:1,cursor:i.disabled?"not-allowed":"pointer"},onMouseEnter:m=>{i.disabled||(m.currentTarget.classList.remove("btn-light"),m.currentTarget.classList.add("btn-primary"))},onMouseLeave:m=>{i.disabled||(m.currentTarget.classList.remove("btn-primary"),m.currentTarget.classList.add("btn-light"))},children:e.jsxs("span",{className:`fw-semibold ${i.disabled?"text-gray-400":"text-gray-700"}`,children:[i.title,i.disabled&&e.jsx(y,{iconName:"lock",className:"fs-6 ms-2 text-gray-400"})]})},d)),h.items.length===0&&e.jsx("p",{className:"text-muted fs-7 mb-0",children:"暫無功能"})]})})]},h.sectionTitle))]})})]})})},be=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{breadcrumbs:[],children:"CRM 儀表板"}),e.jsx(me,{}),e.jsx(pe,{})]}),ne=[{id:"1",companyName:"ABC 貿易有限公司",companyCode:"ABC001",taxId:"12345678",status:"active",primaryContact:{name:"張三",title:"業務經理",phone:"02-1234-5678",mobile:"0912-345-678",email:"zhang@abc.com",isPrimary:!0},contactCount:3,phone:"02-1234-5678",email:"info@abc.com",address:"台北市信義區信義路五段7號",createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-01-15T10:00:00Z"},{id:"2",companyName:"XYZ 物流股份有限公司",companyCode:"XYZ002",taxId:"87654321",status:"active",primaryContact:{name:"李四",title:"營運總監",phone:"02-8765-4321",mobile:"0987-654-321",email:"li@xyz.com",isPrimary:!0},contactCount:5,phone:"02-8765-4321",email:"contact@xyz.com",address:"新北市板橋區文化路一段188巷",createdAt:"2024-02-20T14:30:00Z",updatedAt:"2024-02-20T14:30:00Z"},{id:"3",companyName:"DEF 國際運輸公司",companyCode:"DEF003",taxId:"11223344",status:"inactive",primaryContact:{name:"王五",title:"總經理",phone:"03-1111-2222",mobile:"0933-111-222",email:"wang@def.com",isPrimary:!0},contactCount:2,phone:"03-1111-2222",email:"info@def.com",address:"桃園市中壢區中正路123號",createdAt:"2024-03-10T09:00:00Z",updatedAt:"2024-03-10T09:00:00Z"},{id:"4",companyName:"GHI 海運股份有限公司",companyCode:"GHI004",taxId:"55667788",status:"active",primaryContact:{name:"陳六",title:"業務副總",phone:"04-2222-3333",mobile:"0944-222-333",email:"chen@ghi.com",isPrimary:!0},contactCount:4,phone:"04-2222-3333",email:"service@ghi.com",address:"台中市西屯區台灣大道三段99號",createdAt:"2024-04-05T11:20:00Z",updatedAt:"2024-04-05T11:20:00Z"},{id:"5",companyName:"JKL 倉儲管理公司",companyCode:"JKL005",taxId:"99887766",status:"suspended",primaryContact:{name:"林七",title:"營運經理",phone:"07-3333-4444",mobile:"0955-333-444",email:"lin@jkl.com",isPrimary:!0},contactCount:3,phone:"07-3333-4444",email:"info@jkl.com",address:"高雄市前鎮區中山二路5號",createdAt:"2024-05-12T08:15:00Z",updatedAt:"2024-05-12T08:15:00Z"}],fe={1:{id:"1",companyName:"ABC 貿易有限公司",companyCode:"ABC001",taxId:"12345678",status:"active",phone:"02-1234-5678",email:"info@abc.com",address:"台北市信義區信義路五段7號",website:"https://www.abc.com",contacts:[{id:"1",name:"張三",title:"業務經理",phone:"02-1234-5678",mobile:"0912-345-678",email:"zhang@abc.com",isPrimary:!0},{id:"2",name:"王五",title:"業務助理",phone:"02-1234-5679",mobile:"0912-345-679",email:"wang@abc.com",isPrimary:!1},{id:"3",name:"趙六",title:"財務經理",phone:"02-1234-5680",mobile:"0912-345-680",email:"zhao@abc.com",isPrimary:!1}],createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-01-15T10:00:00Z"},2:{id:"2",companyName:"XYZ 物流股份有限公司",companyCode:"XYZ002",taxId:"87654321",status:"active",phone:"02-8765-4321",email:"contact@xyz.com",address:"新北市板橋區文化路一段188巷",website:"https://www.xyz.com",contacts:[{id:"1",name:"李四",title:"營運總監",phone:"02-8765-4321",mobile:"0987-654-321",email:"li@xyz.com",isPrimary:!0},{id:"2",name:"周八",title:"業務經理",phone:"02-8765-4322",mobile:"0987-654-322",email:"zhou@xyz.com",isPrimary:!1},{id:"3",name:"吳九",title:"倉儲主管",phone:"02-8765-4323",mobile:"0987-654-323",email:"wu@xyz.com",isPrimary:!1},{id:"4",name:"鄭十",title:"運輸經理",phone:"02-8765-4324",mobile:"0987-654-324",email:"zheng@xyz.com",isPrimary:!1},{id:"5",name:"孫十一",title:"客服專員",phone:"02-8765-4325",mobile:"0987-654-325",email:"sun@xyz.com",isPrimary:!1}],createdAt:"2024-02-20T14:30:00Z",updatedAt:"2024-02-20T14:30:00Z"},3:{id:"3",companyName:"DEF 國際運輸公司",companyCode:"DEF003",taxId:"11223344",status:"inactive",phone:"03-1111-2222",email:"info@def.com",address:"桃園市中壢區中正路123號",website:"https://www.def.com",contacts:[{id:"1",name:"王五",title:"總經理",phone:"03-1111-2222",mobile:"0933-111-222",email:"wang@def.com",isPrimary:!0},{id:"2",name:"錢十二",title:"副總經理",phone:"03-1111-2223",mobile:"0933-111-223",email:"qian@def.com",isPrimary:!1}],createdAt:"2024-03-10T09:00:00Z",updatedAt:"2024-03-10T09:00:00Z"},4:{id:"4",companyName:"GHI 海運股份有限公司",companyCode:"GHI004",taxId:"55667788",status:"active",phone:"04-2222-3333",email:"service@ghi.com",address:"台中市西屯區台灣大道三段99號",website:"https://www.ghi.com",contacts:[{id:"1",name:"陳六",title:"業務副總",phone:"04-2222-3333",mobile:"0944-222-333",email:"chen@ghi.com",isPrimary:!0},{id:"2",name:"黃十三",title:"業務經理",phone:"04-2222-3334",mobile:"0944-222-334",email:"huang@ghi.com",isPrimary:!1},{id:"3",name:"楊十四",title:"營運經理",phone:"04-2222-3335",mobile:"0944-222-335",email:"yang@ghi.com",isPrimary:!1},{id:"4",name:"劉十五",title:"財務經理",phone:"04-2222-3336",mobile:"0944-222-336",email:"liu@ghi.com",isPrimary:!1}],createdAt:"2024-04-05T11:20:00Z",updatedAt:"2024-04-05T11:20:00Z"},5:{id:"5",companyName:"JKL 倉儲管理公司",companyCode:"JKL005",taxId:"99887766",status:"suspended",phone:"07-3333-4444",email:"info@jkl.com",address:"高雄市前鎮區中山二路5號",website:"https://www.jkl.com",contacts:[{id:"1",name:"林七",title:"營運經理",phone:"07-3333-4444",mobile:"0955-333-444",email:"lin@jkl.com",isPrimary:!0},{id:"2",name:"何十六",title:"倉儲主管",phone:"07-3333-4445",mobile:"0955-333-445",email:"he@jkl.com",isPrimary:!1},{id:"3",name:"羅十七",title:"業務專員",phone:"07-3333-4446",mobile:"0955-333-446",email:"luo@jkl.com",isPrimary:!1}],createdAt:"2024-05-12T08:15:00Z",updatedAt:"2024-05-12T08:15:00Z"}},ge=[{id:"1",name:"標準物流合約",billingMode:"volume",status:"active",effectiveDate:"2024-01-01",expiryDate:"2024-12-31",createdAt:"2024-01-01T10:00:00Z",updatedAt:"2024-01-01T10:00:00Z"},{id:"2",name:"ABC 貿易專案合約",customerId:"1",customerName:"ABC 貿易有限公司",billingMode:"hybrid",status:"active",effectiveDate:"2024-02-01",expiryDate:"2025-01-31",createdAt:"2024-02-01T10:00:00Z",updatedAt:"2024-02-01T10:00:00Z"},{id:"3",name:"XYZ 物流長期合約",customerId:"2",customerName:"XYZ 物流股份有限公司",billingMode:"distance",status:"active",effectiveDate:"2024-03-01",expiryDate:"2025-02-28",createdAt:"2024-03-01T10:00:00Z",updatedAt:"2024-03-01T10:00:00Z"},{id:"4",name:"固定價格合約模板",billingMode:"fixed",status:"draft",effectiveDate:"2024-06-01",expiryDate:"2024-12-31",createdAt:"2024-05-15T10:00:00Z",updatedAt:"2024-05-15T10:00:00Z"},{id:"5",name:"按時計費合約模板",billingMode:"time",status:"active",effectiveDate:"2024-04-01",expiryDate:"2024-12-31",createdAt:"2024-04-01T10:00:00Z",updatedAt:"2024-04-01T10:00:00Z"}],q={TGHU1234567:{containerNo:"TGHU1234567",orderNo:"ORD-2024-001",status:"in_transit",currentLocation:"桃園物流中心",pickupDate:"2024-03-01",estimatedDeliveryDate:"2024-03-05",actualDeliveryDate:void 0,trackingEvents:[{id:"1",time:"2024-03-01T08:00:00Z",location:"台北港",status:"pending",description:"貨櫃已提領",operator:"司機 張三"},{id:"2",time:"2024-03-01T10:30:00Z",location:"台北港",status:"pending",description:"貨物裝載完成",operator:"倉管 李四"},{id:"3",time:"2024-03-02T10:30:00Z",location:"桃園物流中心",status:"in_transit",description:"貨物已裝載，運送中",operator:"系統"}]},TGHU7654321:{containerNo:"TGHU7654321",orderNo:"ORD-2024-002",status:"arrived",currentLocation:"台中倉庫",pickupDate:"2024-03-10",estimatedDeliveryDate:"2024-03-12",actualDeliveryDate:void 0,trackingEvents:[{id:"1",time:"2024-03-10T09:00:00Z",location:"高雄港",status:"pending",description:"貨櫃已提領",operator:"司機 王五"},{id:"2",time:"2024-03-10T11:00:00Z",location:"高雄港",status:"pending",description:"貨物裝載完成",operator:"倉管 趙六"},{id:"3",time:"2024-03-11T14:00:00Z",location:"台中倉庫",status:"in_transit",description:"運送中，預計今日抵達",operator:"系統"},{id:"4",time:"2024-03-12T10:00:00Z",location:"台中倉庫",status:"arrived",description:"貨櫃已抵達目的地",operator:"系統"}]},TGHU9876543:{containerNo:"TGHU9876543",orderNo:"ORD-2024-003",status:"delivered",currentLocation:"客戶倉庫",pickupDate:"2024-02-20",estimatedDeliveryDate:"2024-02-25",actualDeliveryDate:"2024-02-24",trackingEvents:[{id:"1",time:"2024-02-20T08:00:00Z",location:"基隆港",status:"pending",description:"貨櫃已提領",operator:"司機 陳七"},{id:"2",time:"2024-02-20T10:00:00Z",location:"基隆港",status:"pending",description:"貨物裝載完成",operator:"倉管 林八"},{id:"3",time:"2024-02-21T12:00:00Z",location:"新竹物流中心",status:"in_transit",description:"運送中",operator:"系統"},{id:"4",time:"2024-02-23T15:00:00Z",location:"客戶倉庫",status:"arrived",description:"貨櫃已抵達目的地",operator:"系統"},{id:"5",time:"2024-02-24T09:00:00Z",location:"客戶倉庫",status:"delivered",description:"貨物已交付客戶",operator:"司機 陳七"}]},TGHU1111111:{containerNo:"TGHU1111111",orderNo:"ORD-2024-004",status:"pending",currentLocation:"台北港",pickupDate:"2024-03-15",estimatedDeliveryDate:"2024-03-18",actualDeliveryDate:void 0,trackingEvents:[{id:"1",time:"2024-03-15T08:00:00Z",location:"台北港",status:"pending",description:"貨櫃已提領，等待裝載",operator:"司機 周九"}]}};function je(s){if(q[s])return q[s];const a=Object.keys(q).find(l=>l.includes(s)||s.includes(l));return a?q[a]:{containerNo:s,orderNo:`ORD-${Date.now()}`,status:"pending",currentLocation:"台北港",pickupDate:new Date().toISOString().split("T")[0],estimatedDeliveryDate:new Date(Date.now()+3*24*60*60*1e3).toISOString().split("T")[0],trackingEvents:[{id:"1",time:new Date().toISOString(),location:"台北港",status:"pending",description:"貨櫃已提領，等待處理",operator:"系統"}]}}const J="/api/crm/customers",V="/api/crm/contracts",ie="/api/crm/portal";async function Ne(s,a){var l;if(L()){console.log("[Mock] 使用 Mock 客戶列表",s),await new Promise(x=>setTimeout(x,300));let c=[...ne];const o=(l=s.keyword)==null?void 0:l.trim().toLowerCase();o&&(c=c.filter(x=>{var b,g,C,k,t;return x.companyName.toLowerCase().includes(o)||((b=x.companyCode)==null?void 0:b.toLowerCase().includes(o))||((g=x.taxId)==null?void 0:g.toLowerCase().includes(o))||((C=x.primaryContact)==null?void 0:C.name.toLowerCase().includes(o))||((k=x.phone)==null?void 0:k.toLowerCase().includes(o))||((t=x.email)==null?void 0:t.toLowerCase().includes(o))}));const r=s.page??0,p=s.size??10,j=r*p,h=j+p,i=c.slice(j,h),d=c.length,m=Math.ceil(d/p);return Promise.resolve({content:i,totalElements:d,totalPages:m,size:p,number:r,first:r===0,last:r>=m-1,empty:i.length===0})}try{const c=await O.get(J,{params:s});return{...c.data.data,content:c.data.data.content||[]}}catch(c){console.error(c);const o=Y.fromAxiosError(c);if(o.isServerError)throw o;return a==null||a("取得客戶列表失敗，請稍後再試","danger"),{content:[],totalElements:0,totalPages:0,size:s.size??10,number:s.page??0,first:!0,last:!0,empty:!0}}}async function ve(s,a){var l;if(L()){console.log("[Mock] 使用 Mock 客戶詳情",s),await new Promise(r=>setTimeout(r,300));const c=fe[s];if(c)return c;const o=ne.find(r=>r.id===s);return o?{...o,website:`https://www.${((l=o.companyCode)==null?void 0:l.toLowerCase())||"company"}.com`,contacts:o.primaryContact?[o.primaryContact]:[]}:null}try{return(await O.get(`${J}/${s}`)).data.data}catch(c){return console.error(c),a==null||a("取得客戶詳情失敗，請稍後再試","danger"),null}}async function ye(s,a){if(L())return console.log("[Mock] 模擬建立客戶",s),await new Promise(l=>setTimeout(l,500)),a==null||a("客戶建立成功 (Mock)","success"),!0;try{return await O.post(J,s),a==null||a("客戶建立成功","success"),!0}catch(l){return console.error(l),a==null||a("建立客戶失敗，請稍後再試","danger"),!1}}async function Ce(s,a,l){if(L())return console.log("[Mock] 模擬更新客戶",s,a),await new Promise(c=>setTimeout(c,500)),l==null||l("客戶更新成功 (Mock)","success"),!0;try{return await O.put(`${J}/${s}`,a),l==null||l("客戶更新成功","success"),!0}catch(c){return console.error(c),l==null||l("更新客戶失敗，請稍後再試","danger"),!1}}async function ke(s,a){if(L())return console.log("[Mock] 模擬刪除客戶",s),await new Promise(l=>setTimeout(l,500)),a==null||a("客戶刪除成功 (Mock)","success"),!0;try{return await O.delete(`${J}/${s}`),a==null||a("客戶刪除成功","success"),!0}catch(l){return console.error(l),a==null||a("刪除客戶失敗，請稍後再試","danger"),!1}}async function De(s,a){var l;if(L()){console.log("[Mock] 使用 Mock 合約模板列表",s),await new Promise(x=>setTimeout(x,300));let c=[...ge];const o=(l=s.keyword)==null?void 0:l.trim().toLowerCase();o&&(c=c.filter(x=>{var b;return x.name.toLowerCase().includes(o)||((b=x.customerName)==null?void 0:b.toLowerCase().includes(o))||x.billingMode.toLowerCase().includes(o)}));const r=s.page??0,p=s.size??10,j=r*p,h=j+p,i=c.slice(j,h),d=c.length,m=Math.ceil(d/p);return Promise.resolve({content:i,totalElements:d,totalPages:m,size:p,number:r,first:r===0,last:r>=m-1,empty:i.length===0})}try{const c=await O.get(V,{params:s});return{...c.data.data,content:c.data.data.content||[]}}catch(c){console.error(c);const o=Y.fromAxiosError(c);if(o.isServerError)throw o;return a==null||a("取得合約模板列表失敗，請稍後再試","danger"),{content:[],totalElements:0,totalPages:0,size:s.size??10,number:s.page??0,first:!0,last:!0,empty:!0}}}async function Te(s,a){if(L())return console.log("[Mock] 模擬建立合約模板",s),await new Promise(l=>setTimeout(l,500)),a==null||a("合約模板建立成功 (Mock)","success"),!0;try{return await O.post(V,s),a==null||a("合約模板建立成功","success"),!0}catch(l){return console.error(l),a==null||a("建立合約模板失敗，請稍後再試","danger"),!1}}async function we(s,a,l){if(L())return console.log("[Mock] 模擬更新合約模板",s,a),await new Promise(c=>setTimeout(c,500)),l==null||l("合約模板更新成功 (Mock)","success"),!0;try{return await O.put(`${V}/${s}`,a),l==null||l("合約模板更新成功","success"),!0}catch(c){return console.error(c),l==null||l("更新合約模板失敗，請稍後再試","danger"),!1}}async function Se(s,a){if(L())return console.log("[Mock] 模擬刪除合約模板",s),await new Promise(l=>setTimeout(l,500)),a==null||a("合約模板刪除成功 (Mock)","success"),!0;try{return await O.delete(`${V}/${s}`),a==null||a("合約模板刪除成功","success"),!0}catch(l){return console.error(l),a==null||a("刪除合約模板失敗，請稍後再試","danger"),!1}}async function Pe(s,a){if(L())return console.log("[Mock] 使用 Mock 貨櫃進度",s),await new Promise(c=>setTimeout(c,300)),je(s);try{return(await O.get(`${ie}/containers/${s}/progress`)).data.data}catch(l){return console.error(l),a==null||a("查詢貨櫃進度失敗，請稍後再試","danger"),null}}async function Me(s,a){if(L())return console.log("[Mock] 模擬建立線上提單",s),await new Promise(l=>setTimeout(l,500)),a==null||a("提單建立成功 (Mock)","success"),{bookingNo:`BK-${Date.now()}`,orderNo:`ORD-${Date.now()}`,status:"pending",message:"提單已建立，等待處理"};try{const l=await O.post(`${ie}/bookings`,s);return a==null||a("提單建立成功","success"),l.data.data}catch(l){return console.error(l),a==null||a("建立提單失敗，請稍後再試","danger"),null}}const Ee=10,Ie=s=>{if(!s)return{label:"-",className:"badge-light-secondary"};switch(s){case"active":return{label:"啟用",className:"badge-light-success"};case"inactive":return{label:"停用",className:"badge-light-secondary"};case"suspended":return{label:"暫停",className:"badge-light-warning"};default:return{label:s,className:"badge-light-secondary"}}},Re=({searchKeyword:s,showAlert:a,onEdit:l})=>{const c=ee(),[o,r]=n.useState([]),[p,j]=n.useState(0),[h,i]=n.useState(1),[d,m]=n.useState(1),[x,b]=n.useState(!1),[g,C]=n.useState(null),[k,t]=n.useState(!1),[w,R]=n.useState(!1),[E,S]=n.useState(!1),P=n.useCallback(async()=>{b(!0),R(!1);try{const f={page:d-1,size:Ee,keyword:s!=null&&s.trim()?s.trim():void 0},F=await Ne(f,a);r(F.content),j(F.totalElements),i(F.totalPages||1)}catch(f){Y.fromAxiosError(f).isServerError?(R(!0),S(!0)):a("取得客戶列表失敗，請稍後再試","danger")}finally{b(!1)}},[d,s,a]),z=n.useCallback(()=>{A(),S(!1),R(!1),P()},[P]),U=n.useCallback(()=>{R(!1),P()},[P]);n.useEffect(()=>{m(1)},[s]),n.useEffect(()=>{P()},[P]);const $=n.useCallback(f=>{c(`/crm/customer/${f.id}/detail`)},[c]),N=f=>C(f),v=async()=>{if(!g)return;const f=g.id;if(!f){a("缺少客戶識別碼，無法刪除","danger");return}try{t(!0),await ke(String(f),a)&&(await P(),C(null))}finally{t(!1)}};if(w)return e.jsxs(e.Fragment,{children:[e.jsx(ae,{onRetry:U,showMockOption:!0,onUseMock:z}),e.jsx(le,{open:E,onConfirm:z,onCancel:()=>S(!1)})]});const Z=[{header:"公司名稱",className:"min-w-200px"},{header:"公司代碼",className:"min-w-120px"},{header:"統一編號",className:"min-w-120px"},{header:"主要聯絡人",className:"min-w-150px"},{header:"聯絡方式",className:"min-w-180px"},{header:"狀態",className:"min-w-100px"},{header:"操作",className:"text-end min-w-200px"}];return e.jsxs(e.Fragment,{children:[e.jsx(re,{columns:Z,rows:o,loading:x,emptyText:"沒有客戶資料",page:d,totalPages:h,totalElements:p,onPrev:()=>m(f=>Math.max(1,f-1)),onNext:()=>m(f=>Math.min(h||1,f+1)),renderRow:f=>{const F=Ie(f.status),D=f.primaryContact;return e.jsxs("tr",{className:"cursor-pointer table-row-hover",onClick:()=>$(f),children:[e.jsx("td",{className:"fw-bold text-gray-900",children:f.companyName}),e.jsx("td",{children:f.companyCode||"-"}),e.jsx("td",{children:f.taxId||"-"}),e.jsx("td",{children:D?e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:D.name}),D.title&&e.jsx("div",{className:"text-muted fs-7",children:D.title})]}):"-"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column",children:[(D==null?void 0:D.phone)&&e.jsxs("span",{className:"text-gray-600 fs-7",children:[e.jsx(y,{iconName:"phone",className:"fs-7 me-1"}),D.phone]}),(D==null?void 0:D.email)&&e.jsxs("span",{className:"text-gray-600 fs-7",children:[e.jsx(y,{iconName:"sms",className:"fs-7 me-1"}),D.email]}),!(D!=null&&D.phone)&&!(D!=null&&D.email)&&e.jsx("span",{className:"text-muted",children:"-"})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${F.className} fw-bold`,children:F.label})}),e.jsx("td",{className:"text-end",onClick:u=>u.stopPropagation(),children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-light-primary btn-sm",onClick:u=>{u.preventDefault(),$(f)},title:"查看詳情",children:e.jsx(y,{iconName:"eye",className:"fs-2"})}),l&&e.jsx("button",{className:"btn btn-light-warning btn-sm",onClick:u=>{u.preventDefault(),l(f)},title:"編輯",children:e.jsx(y,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-light-danger btn-sm",onClick:u=>{u.preventDefault(),N(f)},title:"刪除",children:e.jsx(y,{iconName:"trash",className:"fs-2"})})]})})]},String(f.id??Math.random()))}}),g&&e.jsx(te,{open:!!g,title:"刪除客戶",deleting:k,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除客戶 ",e.jsx("strong",{children:g.companyName})," 嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>k?null:C(null),onConfirm:v})]})},I=s=>s.trim(),Ze=({open:s,onClose:a,onSaved:l,showAlert:c,editingCustomer:o})=>{const r=!!o,[p,j]=n.useState(""),[h,i]=n.useState(""),[d,m]=n.useState(""),[x,b]=n.useState(""),[g,C]=n.useState(""),[k,t]=n.useState(""),[w,R]=n.useState(""),[E,S]=n.useState("active"),[P,z]=n.useState(!1);n.useEffect(()=>{if(s){if(!o){j(""),i(""),m(""),b(""),C(""),t(""),R(""),S("active");return}j(o.companyName||""),i(o.companyCode||""),m(o.taxId||""),b(o.phone||""),C(o.email||""),t(o.address||""),S(o.status||"active")}},[s,o]);const U=()=>I(p)?!0:(c("請輸入公司名稱","warning"),!1),$=async()=>{if(U())try{if(z(!0),r&&o){const N={companyName:I(p),companyCode:I(h)||void 0,taxId:I(d)||void 0,phone:I(x)||void 0,email:I(g)||void 0,address:I(k)||void 0,website:I(w)||void 0,status:E};await Ce(o.id,N,c)}else{const N={companyName:I(p),companyCode:I(h)||void 0,taxId:I(d)||void 0,phone:I(x)||void 0,email:I(g)||void 0,address:I(k)||void 0,website:I(w)||void 0};await ye(N,c)}l()}catch(N){console.error(N),c("儲存失敗，請稍後再試","danger")}finally{z(!1)}};return s?e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,.25)"},role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(y,{iconName:r?"message-edit":"plus",className:"fs-2 me-2"}),r?"編輯客戶":"新增客戶"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:a,disabled:P,"aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label required",children:"公司名稱"}),e.jsx("input",{className:"form-control",value:p,onChange:N=>j(N.target.value),placeholder:"請輸入公司名稱",autoFocus:!r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"公司代碼"}),e.jsx("input",{className:"form-control",value:h,onChange:N=>i(N.target.value),placeholder:"例如：ABC001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"統一編號"}),e.jsx("input",{className:"form-control",value:d,onChange:N=>m(N.target.value),placeholder:"例如：12345678"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"公司電話"}),e.jsx("input",{className:"form-control",value:x,onChange:N=>b(N.target.value),placeholder:"例如：02-1234-5678"})]}),r&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"狀態"}),e.jsxs("select",{className:"form-select",value:E,onChange:N=>S(N.target.value),children:[e.jsx("option",{value:"active",children:"啟用"}),e.jsx("option",{value:"inactive",children:"停用"}),e.jsx("option",{value:"suspended",children:"暫停"})]})]})]}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"公司郵箱"}),e.jsx("input",{className:"form-control",type:"email",value:g,onChange:N=>C(N.target.value),placeholder:"例如：info@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"公司地址"}),e.jsx("textarea",{className:"form-control",rows:3,value:k,onChange:N=>t(N.target.value),placeholder:"請輸入公司地址"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"公司網站"}),e.jsx("input",{className:"form-control",type:"url",value:w,onChange:N=>R(N.target.value),placeholder:"例如：https://www.company.com"})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-light",onClick:a,disabled:P,children:"取消"}),e.jsx("button",{className:"btn btn-primary",onClick:$,disabled:P,children:P?"儲存中…":"儲存"})]})]})})}):null};function Le(){const{alert:s,showAlert:a,Alert:l}=Q(),[c,o]=n.useState(""),[r,p]=n.useState(""),[j,h]=n.useState(0),[i,d]=n.useState(!1),[m,x]=n.useState(null),b=t=>{t.key==="Enter"&&o(r.trim())},g=()=>{h(t=>t+1),d(!1),x(null)},C=()=>{x(null),d(!0)},k=t=>{x(t),d(!0)};return n.useEffect(()=>{},[a]),e.jsxs(_,{children:[s&&e.jsx(l,{message:s.message,type:s.type}),e.jsx(W,{title:"客戶清單",breadcrumbs:[{label:"CRM 客戶管理",href:"#"},{label:"客戶清單",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(y,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"公司名稱 / 公司代碼 / 統一編號…",value:r,onChange:t=>p(t.target.value),onKeyDown:b})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end gap-2 flex-wrap",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:C,children:[e.jsx(y,{iconName:"plus",className:"fs-2"}),"新增客戶"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(Re,{searchKeyword:c,showAlert:a,onEdit:k},j)})]})}),e.jsx(Ze,{open:i,onClose:()=>{d(!1),x(null)},showAlert:a,editingCustomer:m,onSaved:g})]})}function Oe(){var k;const{id:s}=ue(),a=ee(),{alert:l,showAlert:c,Alert:o}=Q(),[r,p]=n.useState(null),[j,h]=n.useState(!0),[i,d]=n.useState(!1);n.useEffect(()=>{if(!s){c("缺少客戶 ID","danger"),a("/crm/customer/list");return}m()},[s]);const m=async()=>{if(s){h(!0),d(!1);try{const t=await ve(s,c);p(t)}catch(t){Y.fromAxiosError(t).isServerError?d(!0):c("取得客戶詳情失敗，請稍後再試","danger")}finally{h(!1)}}},x=()=>{A(),d(!1),m()},b=()=>{d(!1),m()};if(i)return e.jsx(_,{children:e.jsx(ae,{onRetry:b,showMockOption:!0,onUseMock:x})});if(j)return e.jsxs(_,{children:[e.jsx(W,{title:"客戶詳情",breadcrumbs:[{label:"CRM 客戶管理",href:"#"},{label:"客戶詳情",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body text-center py-10",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"載入中…"})})})})})]});if(!r)return e.jsxs(_,{children:[e.jsx(W,{title:"客戶詳情",breadcrumbs:[{label:"CRM 客戶管理",href:"#"},{label:"客戶詳情",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center py-10",children:[e.jsx("p",{className:"text-muted",children:"找不到客戶資料"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a("/crm/customer/list"),children:"返回列表"})]})})})]});const g=t=>{switch(t){case"active":return"badge-light-success";case"inactive":return"badge-light-secondary";case"suspended":return"badge-light-warning";default:return"badge-light-secondary"}},C=t=>{switch(t){case"active":return"啟用";case"inactive":return"停用";case"suspended":return"暫停";default:return t}};return e.jsxs(_,{children:[l&&e.jsx(o,{message:l.message,type:l.type}),e.jsx(W,{title:"客戶詳情",breadcrumbs:[{label:"CRM 客戶管理",href:"/crm/customer/list"},{label:"客戶詳情",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsx("h3",{className:"fw-bold m-0",children:r.companyName})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("button",{className:"btn btn-sm btn-light",onClick:()=>a("/crm/customer/list"),children:"返回列表"})})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card card-flush h-100",children:[e.jsx("div",{className:"card-header pt-5",children:e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"基本資訊"})})}),e.jsx("div",{className:"card-body pt-0",children:e.jsx("div",{className:"table-responsive",children:e.jsx("table",{className:"table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold min-w-150px",children:"公司名稱"}),e.jsx("td",{className:"text-gray-800",children:r.companyName})]}),r.companyCode&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"公司代碼"}),e.jsx("td",{className:"text-gray-800",children:r.companyCode})]}),r.taxId&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"統一編號"}),e.jsx("td",{className:"text-gray-800",children:r.taxId})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"狀態"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${g(r.status)} fw-bold`,children:C(r.status)})})]}),r.phone&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"公司電話"}),e.jsxs("td",{className:"text-gray-800",children:[e.jsx(y,{iconName:"phone",className:"fs-7 me-1"}),r.phone]})]}),r.email&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"公司郵箱"}),e.jsxs("td",{className:"text-gray-800",children:[e.jsx(y,{iconName:"sms",className:"fs-7 me-1"}),r.email]})]}),r.address&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"公司地址"}),e.jsx("td",{className:"text-gray-800",children:r.address})]}),r.website&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"公司網站"}),e.jsx("td",{className:"text-gray-800",children:e.jsx("a",{href:r.website,target:"_blank",rel:"noopener noreferrer",children:r.website})})]})]})})})})]})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card card-flush h-100",children:[e.jsx("div",{className:"card-header pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"聯絡人資訊"}),e.jsxs("span",{className:"text-muted pt-1 fw-semibold fs-7",children:["共 ",((k=r.contacts)==null?void 0:k.length)||0," 位聯絡人"]})]})}),e.jsx("div",{className:"card-body pt-0",children:r.contacts&&r.contacts.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-600 fw-bold fs-7 text-uppercase",children:[e.jsx("th",{children:"姓名"}),e.jsx("th",{children:"職稱"}),e.jsx("th",{children:"聯絡方式"})]})}),e.jsx("tbody",{children:r.contacts.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[t.name,t.isPrimary&&e.jsx("span",{className:"badge badge-light-primary ms-2",children:"主要"})]})}),e.jsx("td",{children:t.title||"-"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column gap-1",children:[t.phone&&e.jsxs("span",{className:"text-gray-600 fs-7",children:[e.jsx(y,{iconName:"phone",className:"fs-7 me-1"}),t.phone]}),t.mobile&&e.jsxs("span",{className:"text-gray-600 fs-7",children:[e.jsx(y,{iconName:"phone",className:"fs-7 me-1"}),t.mobile]}),t.email&&e.jsxs("span",{className:"text-gray-600 fs-7",children:[e.jsx(y,{iconName:"sms",className:"fs-7 me-1"}),t.email]}),!t.phone&&!t.mobile&&!t.email&&e.jsx("span",{className:"text-muted fs-7",children:"-"})]})})]},t.id||t.name))})]})}):e.jsx("div",{className:"text-center text-muted py-10",children:e.jsx("p",{children:"尚無聯絡人資料"})})})]})})]})})]})})]})}const ze=10,se=s=>s?new Date(s).toLocaleDateString("zh-TW"):"-",Fe=s=>{if(!s)return"-";switch(s){case"fixed":return"固定價格";case"volume":return"按量計費";case"distance":return"按距離計費";case"time":return"按時間計費";case"hybrid":return"混合模式";default:return s}},$e=s=>{if(!s)return{label:"-",className:"badge-light-secondary"};switch(s){case"draft":return{label:"草稿",className:"badge-light-secondary"};case"active":return{label:"啟用",className:"badge-light-success"};case"expired":return{label:"已過期",className:"badge-light-warning"};case"archived":return{label:"已歸檔",className:"badge-light-dark"};default:return{label:s,className:"badge-light-secondary"}}},_e=({searchKeyword:s,showAlert:a,onEdit:l})=>{const[c,o]=n.useState([]),[r,p]=n.useState(0),[j,h]=n.useState(1),[i,d]=n.useState(1),[m,x]=n.useState(!1),[b,g]=n.useState(null),[C,k]=n.useState(!1),[t,w]=n.useState(!1),[R,E]=n.useState(!1),S=n.useCallback(async()=>{x(!0),w(!1);try{const v={page:i-1,size:ze,keyword:s!=null&&s.trim()?s.trim():void 0},Z=await De(v,a);o(Z.content),p(Z.totalElements),h(Z.totalPages||1)}catch(v){Y.fromAxiosError(v).isServerError?(w(!0),E(!0)):a("取得合約模板列表失敗，請稍後再試","danger")}finally{x(!1)}},[i,s,a]),P=n.useCallback(()=>{A(),E(!1),w(!1),S()},[S]),z=n.useCallback(()=>{w(!1),S()},[S]);n.useEffect(()=>{d(1)},[s]),n.useEffect(()=>{S()},[S]);const U=v=>g(v),$=async()=>{if(!b)return;const v=b.id;if(!v){a("缺少合約模板識別碼，無法刪除","danger");return}try{k(!0),await Se(String(v),a)&&(await S(),g(null))}finally{k(!1)}};if(t)return e.jsxs(e.Fragment,{children:[e.jsx(ae,{onRetry:z,showMockOption:!0,onUseMock:P}),e.jsx(le,{open:R,onConfirm:P,onCancel:()=>E(!1)})]});const N=[{header:"合約名稱",className:"min-w-200px"},{header:"關聯客戶",className:"min-w-150px"},{header:"計費模式",className:"min-w-120px"},{header:"生效日期",className:"min-w-120px"},{header:"到期日期",className:"min-w-120px"},{header:"狀態",className:"min-w-100px"},{header:"操作",className:"text-end min-w-200px"}];return e.jsxs(e.Fragment,{children:[e.jsx(re,{columns:N,rows:c,loading:m,emptyText:"沒有合約模板資料",page:i,totalPages:j,totalElements:r,onPrev:()=>d(v=>Math.max(1,v-1)),onNext:()=>d(v=>Math.min(j||1,v+1)),renderRow:v=>{const Z=$e(v.status);return e.jsxs("tr",{children:[e.jsx("td",{className:"fw-bold text-gray-900",children:v.name}),e.jsx("td",{children:v.customerName||e.jsx("span",{className:"text-muted",children:"通用模板"})}),e.jsx("td",{children:Fe(v.billingMode)}),e.jsx("td",{children:se(v.effectiveDate)}),e.jsx("td",{children:se(v.expiryDate)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${Z.className} fw-bold`,children:Z.label})}),e.jsx("td",{className:"text-end",onClick:f=>f.stopPropagation(),children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[l&&e.jsx("button",{className:"btn btn-light-warning btn-sm",onClick:f=>{f.preventDefault(),l(v)},title:"編輯",children:e.jsx(y,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-light-danger btn-sm",onClick:f=>{f.preventDefault(),U(v)},title:"刪除",children:e.jsx(y,{iconName:"trash",className:"fs-2"})})]})})]},String(v.id??Math.random()))}}),b&&e.jsx(te,{open:!!b,title:"刪除合約模板",deleting:C,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除合約模板 ",e.jsx("strong",{children:b.name})," 嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>C?null:g(null),onConfirm:$})]})},G=s=>s.trim(),Ue=({open:s,onClose:a,onSaved:l,showAlert:c,editingContract:o})=>{const r=!!o,[p,j]=n.useState(""),[h,i]=n.useState(""),[d,m]=n.useState("draft"),[x,b]=n.useState(""),[g,C]=n.useState(""),[k,t]=n.useState(""),[w,R]=n.useState([]),[E,S]=n.useState([]),[P,z]=n.useState(!1);n.useEffect(()=>{if(s){if(!o){j(""),i(""),m("draft"),b(""),C(""),t(""),R([]),S([{mode:"volume"}]);return}j(o.name||""),i(o.customerId||""),m(o.status||"draft"),b(o.effectiveDate||""),C(o.expiryDate||"")}},[s,o]);const U=()=>G(p)?E.length===0?(c("請至少設定一個計費規則","warning"),!1):!0:(c("請輸入合約名稱","warning"),!1),$=async()=>{if(U())try{if(z(!0),r&&o){const u={name:G(p),customerId:G(h)||void 0,status:d,effectiveDate:x||void 0,expiryDate:g||void 0,clauses:w.length>0?w:void 0,billingRules:E.length>0?E:void 0,note:G(k)||void 0};await we(o.id,u,c)}else{const u={name:G(p),customerId:G(h)||void 0,effectiveDate:x||void 0,expiryDate:g||void 0,clauses:w.length>0?w:void 0,billingRules:E,note:G(k)||void 0};await Te(u,c)}l()}catch(u){console.error(u),c("儲存失敗，請稍後再試","danger")}finally{z(!1)}},N=()=>{R([...w,{title:"",content:"",order:w.length+1}])},v=u=>{R(w.filter((M,T)=>T!==u))},Z=(u,M,T)=>{const B=[...w];B[u]={...B[u],[M]:T},R(B)},f=()=>{S([...E,{mode:"volume"}])},F=u=>{S(E.filter((M,T)=>T!==u))},D=(u,M,T)=>{const B=[...E];B[u]={...B[u],[M]:T},S(B)};return s?e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,.25)"},role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(y,{iconName:r?"message-edit":"plus",className:"fs-2 me-2"}),r?"編輯合約模板":"新增合約模板"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:a,disabled:P,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"row g-5 mb-5",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label required",children:"合約名稱"}),e.jsx("input",{className:"form-control",value:p,onChange:u=>j(u.target.value),placeholder:"請輸入合約名稱",autoFocus:!r})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"關聯客戶 ID"}),e.jsx("input",{className:"form-control",value:h,onChange:u=>i(u.target.value),placeholder:"留空則為通用模板"})]}),r&&e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"狀態"}),e.jsxs("select",{className:"form-select",value:d,onChange:u=>m(u.target.value),children:[e.jsx("option",{value:"draft",children:"草稿"}),e.jsx("option",{value:"active",children:"啟用"}),e.jsx("option",{value:"expired",children:"已過期"}),e.jsx("option",{value:"archived",children:"已歸檔"})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"生效日期"}),e.jsx("input",{className:"form-control",type:"date",value:x,onChange:u=>b(u.target.value)})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"到期日期"}),e.jsx("input",{className:"form-control",type:"date",value:g,onChange:u=>C(u.target.value)})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{className:"mb-0",children:"標準條款"}),e.jsxs("button",{className:"btn btn-sm btn-light-primary",onClick:N,children:[e.jsx(y,{iconName:"plus",className:"fs-7"}),"新增條款"]})]}),w.map((u,M)=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-flex justify-content-end mb-2",children:e.jsx("button",{className:"btn btn-sm btn-light-danger",onClick:()=>v(M),children:e.jsx(y,{iconName:"trash",className:"fs-7"})})}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"條款標題"}),e.jsx("input",{className:"form-control",value:u.title,onChange:T=>Z(M,"title",T.target.value),placeholder:"例如：服務範圍"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"條款內容"}),e.jsx("textarea",{className:"form-control",rows:3,value:u.content,onChange:T=>Z(M,"content",T.target.value),placeholder:"請輸入條款內容"})]})]})]})},M)),w.length===0&&e.jsx("div",{className:"text-center text-muted py-5",children:e.jsx("p",{children:"尚無標準條款，點擊「新增條款」開始新增"})})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{className:"mb-0",children:"計費規則"}),e.jsxs("button",{className:"btn btn-sm btn-light-primary",onClick:f,children:[e.jsx(y,{iconName:"plus",className:"fs-7"}),"新增規則"]})]}),E.map((u,M)=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-flex justify-content-end mb-2",children:e.jsx("button",{className:"btn btn-sm btn-light-danger",onClick:()=>F(M),children:e.jsx(y,{iconName:"trash",className:"fs-7"})})}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label required",children:"計費模式"}),e.jsxs("select",{className:"form-select",value:u.mode,onChange:T=>D(M,"mode",T.target.value),children:[e.jsx("option",{value:"fixed",children:"固定價格"}),e.jsx("option",{value:"volume",children:"按量計費"}),e.jsx("option",{value:"distance",children:"按距離計費"}),e.jsx("option",{value:"time",children:"按時間計費"}),e.jsx("option",{value:"hybrid",children:"混合模式"})]})]}),u.mode==="fixed"&&e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"基礎價格"}),e.jsx("input",{className:"form-control",type:"number",value:u.basePrice||"",onChange:T=>D(M,"basePrice",Number(T.target.value)),placeholder:"請輸入價格"})]}),u.mode!=="fixed"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"單價"}),e.jsx("input",{className:"form-control",type:"number",value:u.unitPrice||"",onChange:T=>D(M,"unitPrice",Number(T.target.value)),placeholder:"請輸入單價"})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"計費單位"}),e.jsx("input",{className:"form-control",value:u.unit||"",onChange:T=>D(M,"unit",T.target.value),placeholder:"例如：元/立方公尺"})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"最低收費"}),e.jsx("input",{className:"form-control",type:"number",value:u.minCharge||"",onChange:T=>D(M,"minCharge",Number(T.target.value)),placeholder:"可選"})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"最高收費"}),e.jsx("input",{className:"form-control",type:"number",value:u.maxCharge||"",onChange:T=>D(M,"maxCharge",Number(T.target.value)),placeholder:"可選"})]})]})]})},M))]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"form-label",children:"備註"}),e.jsx("textarea",{className:"form-control",rows:3,value:k,onChange:u=>t(u.target.value),placeholder:"可選"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-light",onClick:a,disabled:P,children:"取消"}),e.jsx("button",{className:"btn btn-primary",onClick:$,disabled:P,children:P?"儲存中…":"儲存"})]})]})})}):null};function Be(){const{alert:s,showAlert:a,Alert:l}=Q(),[c,o]=n.useState(""),[r,p]=n.useState(""),[j,h]=n.useState(0),[i,d]=n.useState(!1),[m,x]=n.useState(null),b=t=>{t.key==="Enter"&&o(r.trim())},g=()=>{h(t=>t+1),d(!1),x(null)},C=()=>{x(null),d(!0)},k=t=>{x(t),d(!0)};return n.useEffect(()=>{},[a]),e.jsxs(_,{children:[s&&e.jsx(l,{message:s.message,type:s.type}),e.jsx(W,{title:"合約模板",breadcrumbs:[{label:"CRM 客戶管理",href:"#"},{label:"合約模板",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(y,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-250px ps-14",placeholder:"合約名稱 / 客戶名稱…",value:r,onChange:t=>p(t.target.value),onKeyDown:b})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end gap-2 flex-wrap",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:C,children:[e.jsx(y,{iconName:"plus",className:"fs-2"}),"新增合約模板"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(_e,{searchKeyword:c,showAlert:a,onEdit:k},j)})]})}),e.jsx(Ue,{open:i,onClose:()=>{d(!1),x(null)},showAlert:a,editingContract:m,onSaved:g})]})}function Ge(){const{alert:s,showAlert:a,Alert:l}=Q(),[c,o]=n.useState(""),[r,p]=n.useState(null),[j,h]=n.useState(!1),[i,d]=n.useState({customerId:"",containerNo:"",pickupAddress:"",deliveryAddress:"",pickupDate:"",deliveryDate:"",containerType:"",note:""}),[m,x]=n.useState(!1),b=async()=>{if(!c.trim()){a("請輸入貨櫃號","warning");return}h(!0);try{const t=await Pe(c.trim(),a);p(t),t||a("找不到該貨櫃的進度資訊","warning")}catch(t){console.error(t)}finally{h(!1)}},g=async()=>{if(!i.customerId.trim()){a("請輸入客戶 ID","warning");return}if(!i.containerNo.trim()){a("請輸入貨櫃號","warning");return}if(!i.pickupAddress.trim()){a("請輸入提貨地址","warning");return}if(!i.deliveryAddress.trim()){a("請輸入送貨地址","warning");return}if(!i.pickupDate.trim()){a("請選擇提貨日期","warning");return}x(!0);try{const t=await Me(i,a);t&&(a(`提單建立成功！提單編號：${t.bookingNo}`,"success"),d({customerId:"",containerNo:"",pickupAddress:"",deliveryAddress:"",pickupDate:"",deliveryDate:"",containerType:"",note:""}))}catch(t){console.error(t)}finally{x(!1)}},C=t=>{switch(t){case"pending":return"badge-light-warning";case"in_transit":return"badge-light-primary";case"arrived":return"badge-light-info";case"delivered":return"badge-light-success";case"returned":return"badge-light-secondary";default:return"badge-light-secondary"}},k=t=>{switch(t){case"pending":return"待處理";case"in_transit":return"運送中";case"arrived":return"已到達";case"delivered":return"已交付";case"returned":return"已歸還";default:return t}};return e.jsxs(_,{children:[s&&e.jsx(l,{message:s.message,type:s.type}),e.jsx(W,{title:"客戶入口",breadcrumbs:[{label:"CRM 客戶管理",href:"#"},{label:"客戶入口",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"row g-5",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"貨櫃進度查詢"}),e.jsx("span",{className:"text-muted pt-1 fw-semibold fs-7",children:"輸入貨櫃號查詢即時進度"})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"form-label required",children:"貨櫃號"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("input",{className:"form-control",value:c,onChange:t=>o(t.target.value),placeholder:"例如：TGHU1234567",onKeyDown:t=>{t.key==="Enter"&&b()}}),e.jsx("button",{className:"btn btn-primary",onClick:b,disabled:j,children:j?"查詢中…":"查詢"})]})]}),r&&e.jsx("div",{className:"card card-flush bg-light",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"fw-bold mb-4",children:"查詢結果"}),e.jsx("div",{className:"table-responsive",children:e.jsx("table",{className:"table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold min-w-150px",children:"貨櫃號"}),e.jsx("td",{className:"text-gray-800",children:r.containerNo})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"訂單編號"}),e.jsx("td",{className:"text-gray-800",children:r.orderNo})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"狀態"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${C(r.status)} fw-bold`,children:k(r.status)})})]}),r.currentLocation&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"當前位置"}),e.jsx("td",{className:"text-gray-800",children:r.currentLocation})]}),r.pickupDate&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"提貨日期"}),e.jsx("td",{className:"text-gray-800",children:new Date(r.pickupDate).toLocaleDateString("zh-TW")})]}),r.estimatedDeliveryDate&&e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 fw-bold",children:"預計交付日期"}),e.jsx("td",{className:"text-gray-800",children:new Date(r.estimatedDeliveryDate).toLocaleDateString("zh-TW")})]})]})})}),r.trackingEvents&&r.trackingEvents.length>0&&e.jsxs("div",{className:"mt-5",children:[e.jsx("h6",{className:"fw-bold mb-3",children:"追蹤事件"}),e.jsx("div",{className:"timeline timeline-border-dashed",children:r.trackingEvents.map(t=>e.jsxs("div",{className:"timeline-item",children:[e.jsx("div",{className:"timeline-line w-40px"}),e.jsx("div",{className:"timeline-icon symbol symbol-circle symbol-40px",children:e.jsx("div",{className:"symbol-label bg-light",children:e.jsx(y,{iconName:"check",className:"fs-2 text-primary"})})}),e.jsx("div",{className:"timeline-content mb-10 mt-n1",children:e.jsxs("div",{className:"pe-3 mb-5",children:[e.jsx("div",{className:"fs-5 fw-semibold mb-2",children:t.description}),e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("span",{className:"text-muted me-2 fs-7",children:new Date(t.time).toLocaleString("zh-TW")}),t.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted me-2",children:"•"}),e.jsxs("span",{className:"text-muted fs-7",children:[e.jsx(y,{iconName:"geolocation",className:"fs-7 me-1"}),t.location]})]})]}),t.operator&&e.jsx("span",{className:"badge badge-light-primary fs-7",children:t.operator})]})})]},t.id))})]})]})})]})]})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"線上提單"}),e.jsx("span",{className:"text-muted pt-1 fw-semibold fs-7",children:"填寫提單資訊建立新訂單"})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-5",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label required",children:"客戶 ID"}),e.jsx("input",{className:"form-control",value:i.customerId,onChange:t=>d({...i,customerId:t.target.value}),placeholder:"請輸入客戶 ID"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label required",children:"貨櫃號"}),e.jsx("input",{className:"form-control",value:i.containerNo,onChange:t=>d({...i,containerNo:t.target.value}),placeholder:"例如：TGHU1234567"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label required",children:"提貨地址"}),e.jsx("textarea",{className:"form-control",rows:2,value:i.pickupAddress,onChange:t=>d({...i,pickupAddress:t.target.value}),placeholder:"請輸入提貨地址"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label required",children:"送貨地址"}),e.jsx("textarea",{className:"form-control",rows:2,value:i.deliveryAddress,onChange:t=>d({...i,deliveryAddress:t.target.value}),placeholder:"請輸入送貨地址"})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label required",children:"提貨日期"}),e.jsx("input",{className:"form-control",type:"date",value:i.pickupDate,onChange:t=>d({...i,pickupDate:t.target.value})})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"送貨日期"}),e.jsx("input",{className:"form-control",type:"date",value:i.deliveryDate,onChange:t=>d({...i,deliveryDate:t.target.value})})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"貨櫃類型"}),e.jsx("input",{className:"form-control",value:i.containerType,onChange:t=>d({...i,containerType:t.target.value}),placeholder:"例如：20呎、40呎"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"備註"}),e.jsx("textarea",{className:"form-control",rows:3,value:i.note,onChange:t=>d({...i,note:t.target.value}),placeholder:"可選"})]}),e.jsx("div",{className:"col-12",children:e.jsx("button",{className:"btn btn-primary w-100",onClick:g,disabled:m,children:m?"提交中…":"提交提單"})})]})})]})})]})})]})}const X=[{title:"CRM 客戶管理",path:"/crm/customer/list",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],Ua=()=>e.jsxs(xe,{children:[e.jsx(K,{path:"",element:e.jsx(he,{to:"dashboard",replace:!0})}),e.jsx(K,{path:"dashboard",element:e.jsxs(e.Fragment,{children:[e.jsx(H,{breadcrumbs:X,children:"CRM 儀表板"}),e.jsx(be,{})]})}),e.jsx(K,{path:"customer/list",element:e.jsxs(e.Fragment,{children:[e.jsx(H,{breadcrumbs:X,children:"客戶清單"}),e.jsx(Le,{})]})}),e.jsx(K,{path:"customer/:id/detail",element:e.jsxs(e.Fragment,{children:[e.jsx(H,{breadcrumbs:X,children:"客戶詳情"}),e.jsx(Oe,{})]})}),e.jsx(K,{path:"contract/list",element:e.jsxs(e.Fragment,{children:[e.jsx(H,{breadcrumbs:X,children:"合約模板"}),e.jsx(Be,{})]})}),e.jsx(K,{path:"portal",element:e.jsxs(e.Fragment,{children:[e.jsx(H,{breadcrumbs:X,children:"客戶入口"}),e.jsx(Ge,{})]})})]});export{Ua as default};
