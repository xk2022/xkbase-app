import{r as a,j as e}from"./react-DwkAs-v9.js";import{e as L,C as F,K as y,f as Y,P as D}from"./index-wbzsHQ-6.js";import{A as I}from"./AppToolbar-BZHSVYI7.js";import{f as G,d as V,c as W,u as Z,a as J}from"./Query-DNtB1onu.js";import{a as A,g as Q,d as X,e as M}from"./react-router-Df4HDh8c.js";import{C as ee}from"./ConfirmDeleteModal-BXGAXcew.js";import{P as se}from"./PagedTable-fW2f3xMh.js";import{u as _,t as $,C as K,a as te}from"./formUtils-DYBw-NTu.js";import{u as ae}from"./useFormMeta-CziDqAIO.js";import{S as le}from"./react-bootstrap-BUaeuJHt.js";import"./apexcharts-sziEC8OT.js";import"./react-dom-DVTd-Q6a.js";import"./scheduler-CylivXx-.js";import"./axios-mH-cpkvd.js";import"./formik-B67XZPDW.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-ClCkCI8n.js";import"./react-fast-compare-0sFLRPh9.js";import"./hoist-non-react-statics-C-8QU_9G.js";import"./react-is-8JwjhRSi.js";import"./yup-BLKqc-jj.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-7gDswQQa.js";import"./clsx-B-dksMZM.js";import"./react-router-dom-BJfVfmV5.js";import"./@remix-run-DUdlTjFu.js";import"./chart.js-xWmoy_ii.js";import"./@kurkle-D8fDXNIl.js";import"./@tanstack-BGZqBxWN.js";import"./react-copy-to-clipboard-C4AWj7CK.js";import"./copy-to-clipboard-BvYTofsP.js";import"./toggle-selection-BHUZwh74.js";import"./prism-react-renderer-BV8xJdsO.js";import"./react-select-Z1ywkuii.js";import"./@babel-B036hIWL.js";import"./@emotion-Cdt29Dgm.js";import"./stylis-YPZU7XtI.js";import"./@floating-ui-DZ2V_EUC.js";import"./use-isomorphic-layout-effect-CgCMJW-V.js";import"./memoize-one-DxrTgWdQ.js";import"./@popperjs-D8Kg5PqX.js";import"./react-topbar-progress-indicator-BI-R5WY2.js";import"./topbar-C3UDlew2.js";import"./bootstrap-D7dJWYZj.js";import"./classnames-Bztn78Bv.js";import"./dom-helpers-C9Bu-4wA.js";import"./@restart-rvtB3BAN.js";import"./dequal-tFQomdd2.js";import"./warning-DaFg7xBm.js";import"./prop-types-smO-eibg.js";import"./uncontrollable-C0VNg-tm.js";import"./react-transition-group-DSbRRiC3.js";const re=()=>{const s=A(),{alert:l,showAlert:i,Alert:x}=L(),[p,f]=a.useState(!0),[u,r]=a.useState([]),c=a.useCallback(async()=>{f(!0);try{const b=await G({page:0,size:1e3},i);r(b.content||[])}catch(n){console.error(n),i("取得權限列表失敗","danger")}finally{f(!1)}},[i]);a.useEffect(()=>{c()},[c]);const o=a.useMemo(()=>{const n=u.length,b=u.filter(j=>j.enabled).length,g=n-b,d={};u.forEach(j=>{d[j.systemCode]=(d[j.systemCode]||0)+1});const C=[...u].sort((j,t)=>{const m=j.createdTime?new Date(j.createdTime).getTime():0;return(t.createdTime?new Date(t.createdTime).getTime():0)-m}).slice(0,5);return{total:n,enabled:b,disabled:g,bySystem:d,recent:C}},[u]),S=n=>{if(!n)return"-";try{const b=new Date(n);return Number.isNaN(b.getTime())?n:b.toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return n}};return e.jsxs(F,{children:[l&&e.jsx(x,{message:l.message,type:l.type}),e.jsx(I,{title:"權限總覽",breadcrumbs:[{label:"權限管理",href:"#",active:!1},{label:"權限",active:!1},{label:"總覽",active:!0}]}),e.jsx("div",{className:"app-container container-fluid",children:p?e.jsx("div",{className:"d-flex justify-content-center py-10",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"載入中..."})})}):e.jsxs("div",{className:"row g-6",children:[e.jsx("div",{className:"col-12 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("span",{className:"text-muted fw-semibold fs-7 d-block",children:"總權限數"}),e.jsx("span",{className:"text-gray-800 fw-bold fs-2x",children:o.total})]}),e.jsx(y,{iconName:"shield-tick",className:"fs-1 text-primary"})]})})})}),e.jsx("div",{className:"col-12 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("span",{className:"text-muted fw-semibold fs-7 d-block",children:"啟用中"}),e.jsx("span",{className:"text-gray-800 fw-bold fs-2x",children:o.enabled})]}),e.jsx(y,{iconName:"check-circle",className:"fs-1 text-success"})]})})})}),e.jsx("div",{className:"col-12 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("span",{className:"text-muted fw-semibold fs-7 d-block",children:"已停用"}),e.jsx("span",{className:"text-gray-800 fw-bold fs-2x",children:o.disabled})]}),e.jsx(y,{iconName:"cross-circle",className:"fs-1 text-danger"})]})})})}),e.jsx("div",{className:"col-12 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("span",{className:"text-muted fw-semibold fs-7 d-block",children:"系統數量"}),e.jsx("span",{className:"text-gray-800 fw-bold fs-2x",children:Object.keys(o.bySystem).length})]}),e.jsx(y,{iconName:"element-11",className:"fs-1 text-info"})]})})})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"各系統權限數量"}),e.jsx("span",{className:"text-muted mt-1 fw-semibold fs-7",children:"依系統代碼分組統計"})]}),e.jsx("div",{className:"card-toolbar",children:e.jsxs("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:()=>s("/upms/permission/list"),children:["查看全部",e.jsx(y,{iconName:"arrow-right",className:"fs-4 ms-1"})]})})]}),e.jsx("div",{className:"card-body pt-0",children:Object.keys(o.bySystem).length===0?e.jsxs("div",{className:"text-center py-10 text-muted",children:[e.jsx(y,{iconName:"shield-tick",className:"fs-2x text-muted mb-3"}),e.jsx("p",{className:"mb-0",children:"目前沒有權限資料"})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"系統代碼"}),e.jsx("th",{className:"min-w-100px text-end",children:"權限數量"}),e.jsx("th",{className:"min-w-100px text-end",children:"操作"})]})}),e.jsx("tbody",{children:Object.entries(o.bySystem).sort(([,n],[,b])=>b-n).map(([n,b])=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge badge-light-info fs-6 fw-bold",children:n})}),e.jsx("td",{className:"text-end",children:e.jsx("span",{className:"text-gray-800 fw-bold",children:b})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:()=>s(`/upms/permission/list?systemCode=${n}`),children:"查看"})})]},n))})]})})})]})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"最近建立的權限"}),e.jsx("span",{className:"text-muted mt-1 fw-semibold fs-7",children:"顯示最近 5 筆建立的權限"})]}),e.jsx("div",{className:"card-toolbar",children:e.jsxs("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:()=>s("/upms/permission/create"),children:[e.jsx(y,{iconName:"plus",className:"fs-2"}),"新增權限"]})})]}),e.jsx("div",{className:"card-body pt-0",children:o.recent.length===0?e.jsxs("div",{className:"text-center py-10 text-muted",children:[e.jsx(y,{iconName:"shield-tick",className:"fs-2x text-muted mb-3"}),e.jsx("p",{className:"mb-0",children:"目前沒有權限資料"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary mt-3",onClick:()=>s("/upms/permission/create"),children:"立即建立權限"})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-200px",children:"權限代碼"}),e.jsx("th",{className:"min-w-150px",children:"權限名稱"}),e.jsx("th",{className:"min-w-100px",children:"系統"}),e.jsx("th",{className:"min-w-150px",children:"建立時間"}),e.jsx("th",{className:"min-w-100px text-end",children:"操作"})]})}),e.jsx("tbody",{children:o.recent.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge badge-light-info fs-7 fw-bold",children:n.code})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-800 fw-bold",children:n.name})}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-light-primary fs-7",children:n.systemCode})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fs-7",children:S(n.createdTime)})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:()=>s(`/upms/permission/${n.id}/detail`),children:"查看詳情"})})]},n.id))})]})})})]})})]})})]})},ne=10,ce=s=>{if(!s)return"-";try{const l=new Date(s);if(Number.isNaN(l.getTime()))return s;const i=l.getFullYear(),x=String(l.getMonth()+1).padStart(2,"0"),p=String(l.getDate()).padStart(2,"0"),f=String(l.getHours()).padStart(2,"0"),u=String(l.getMinutes()).padStart(2,"0");return`${i}/${x}/${p} ${f}:${u}`}catch{return s}},ie=s=>s==null?e.jsx("span",{className:"text-muted",children:"-"}):s?e.jsx("span",{className:"badge badge-light-success fw-bolder",children:"啟用"}):e.jsx("span",{className:"badge badge-light-secondary fw-bolder",children:"停用"}),de=({searchKeyword:s,showAlert:l,onEdit:i,onReload:x})=>{const p=A(),[f,u]=a.useState([]),[r,c]=a.useState(0),[o,S]=a.useState(1),[n,b]=a.useState(1),[g,d]=a.useState(!1),[C,j]=a.useState(null),[t,m]=a.useState(!1),N=a.useMemo(()=>{const h=s==null?void 0:s.trim();return h||void 0},[s]),w=a.useCallback(async()=>{d(!0);try{const h={page:n-1,size:ne,keyword:N},v=await G(h,l);u(v.content??[]),c(v.totalElements??0),S(v.totalPages||1)}finally{d(!1)}},[n,N,l]);a.useEffect(()=>{b(1)},[N]),a.useEffect(()=>{w()},[w]);const k=a.useCallback(h=>{p(`/upms/permission/${h.id}/detail`)},[p]),E=h=>j(h),P=a.useCallback(async()=>{if(!C)return;const h=C.id;if(!h){l("缺少權限識別碼，無法刪除","danger");return}try{m(!0),await V(String(h),l)&&(await w(),x==null||x(),j(null))}finally{m(!1)}},[C,w,x,l]),H=[{header:"權限代碼",className:"min-w-200px"},{header:"權限名稱",className:"min-w-200px"},{header:"系統",className:"min-w-125px"},{header:"資源",className:"min-w-125px"},{header:"動作",className:"min-w-125px"},{header:"狀態",className:"min-w-100px"},{header:"建立時間",className:"min-w-150px"},{header:"操作",className:"text-end min-w-100px"}];return e.jsxs(e.Fragment,{children:[e.jsx(se,{columns:H,rows:f,loading:g,emptyText:"沒有權限資料",page:n,totalPages:o,totalElements:r,onPrev:()=>b(h=>Math.max(1,h-1)),onNext:()=>b(h=>Math.min(o||1,h+1)),tableClassName:"table align-middle table-row-dashed fs-6 gy-5 dataTable no-footer",renderRow:h=>e.jsxs("tr",{className:"cursor-pointer table-row-hover text-gray-600 fw-bold",onClick:()=>k(h),children:[e.jsx("td",{children:e.jsx("span",{className:"badge badge-light-info fs-7 fw-bold",children:h.code??"-"})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-800 fw-bold",children:h.name??"-"})}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-light-primary fs-7",children:h.systemCode??"-"})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-700",children:h.resourceCode??"-"})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-700",children:h.actionCode??"-"})}),e.jsx("td",{children:ie(h.enabled)}),e.jsx("td",{children:h.createdTime?e.jsx("span",{className:"text-muted fw-semibold",children:ce(h.createdTime)}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"text-end",onClick:v=>v.stopPropagation(),children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-light-primary btn-sm",onClick:v=>{v.preventDefault(),v.stopPropagation(),k(h)},title:"查看詳情",children:e.jsx(y,{iconName:"eye",className:"fs-2"})}),i&&e.jsx("button",{className:"btn btn-light-warning btn-sm",onClick:v=>{v.preventDefault(),v.stopPropagation(),i(h)},title:"編輯",children:e.jsx(y,{iconName:"message-edit",className:"fs-2"})}),e.jsx("button",{className:"btn btn-light-danger btn-sm",onClick:v=>{v.preventDefault(),v.stopPropagation(),E(h)},title:"刪除",children:e.jsx(y,{iconName:"trash",className:"fs-2"})})]})})]},String(h.id??h.code))}),C&&e.jsx(ee,{open:!!C,title:"刪除權限",deleting:t,message:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["確定要刪除權限"," ",e.jsx("strong",{children:C.code??C.id??"-"})," 嗎？"]}),e.jsx("p",{className:"text-muted mb-0",children:"此操作無法復原，請再次確認。"})]}),onClose:()=>t?null:j(null),onConfirm:P})]})};function oe(){const{alert:s,showAlert:l,Alert:i}=L(),x=A(),[p,f]=a.useState(""),[u,r]=a.useState(""),[c,o]=a.useState(0),S=d=>{d.key==="Enter"&&f(u.trim())},n=()=>{o(d=>d+1)},b=()=>{x("/upms/permission/create")},g=d=>{x(`/upms/permission/${d.id}/detail`)};return a.useEffect(()=>{},[]),e.jsxs(F,{children:[s&&e.jsx(i,{message:s.message,type:s.type}),e.jsx(I,{title:"權限列表",breadcrumbs:[{label:"權限管理",href:"#"},{label:"權限",active:!0}]}),e.jsx("div",{className:"flex-column-fluid",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header border-0 pt-6",children:[e.jsx("div",{className:"card-title",children:e.jsxs("div",{className:"d-flex align-items-center position-relative my-1",children:[e.jsx(y,{iconName:"magnifier",className:"fs-1 position-absolute ms-6"}),e.jsx("input",{type:"text",className:"form-control form-control-solid w-300px ps-14",placeholder:"權限代碼 / 權限名稱…",value:u,onChange:d=>r(d.target.value),onKeyDown:S})]})}),e.jsx("div",{className:"card-toolbar",children:e.jsx("div",{className:"d-flex justify-content-end gap-2 flex-wrap",children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:b,children:[e.jsx(y,{iconName:"plus",className:"fs-2"}),"新增權限"]})})})]}),e.jsx("div",{className:"card-body py-4",children:e.jsx(de,{searchKeyword:p,showAlert:l,onEdit:g,onReload:n},c)})]})})]})}const me=[{value:"CREATE",label:"CREATE（新增）"},{value:"READ",label:"READ（查詢）"},{value:"UPDATE",label:"UPDATE（更新）"},{value:"DELETE",label:"DELETE（刪除）"},{value:"LIST",label:"LIST（列表）"},{value:"MANAGE",label:"MANAGE（管理/全權）"}],xe=({submitting:s=!1,onSubmit:l,onCancel:i})=>{const[x,p]=a.useState([]),[f,u]=a.useState(!1),[r,c]=a.useState({systemCode:"",resourceCode:"",actionCode:"READ",name:"",description:"",enabled:!0,sortOrder:0}),{touch:o,markSubmitted:S,showError:n,invalidClass:b}=ae();a.useEffect(()=>{let t=!0;return(async()=>{u(!0);try{const k=((await Y({page:0,size:200,keyword:""})).content??[]).map(E=>({code:E.code,name:E.name}));t&&(p(k),!r.systemCode&&k.length>0&&c(E=>({...E,systemCode:k[0].code})))}catch{t&&p([])}finally{t&&u(!1)}})(),()=>{t=!1}},[]);const g=a.useMemo(()=>{const t=_(r.systemCode),m=_(r.resourceCode),N=_(r.actionCode),w=t&&m?`${t}_${m}`:"",k=t&&m&&N?`${t}_${m}_${N}`:"";return{systemCode:t,resourceCode:m,actionCode:N,groupKey:w,code:k}},[r.systemCode,r.resourceCode,r.actionCode]),d=a.useMemo(()=>{const t={},m=g.systemCode,N=g.resourceCode,w=g.actionCode,k=$(r.name),E=$(r.description);m?K.test(m)||(t.systemCode="格式不正確（2~50，英數 + _-，且需以英數開頭）"):t.systemCode="系統代碼為必填",N?K.test(N)||(t.resourceCode="格式不正確（2~50，英數 + _-，且需以英數開頭）"):t.resourceCode="資源代碼為必填",w?K.test(w)||(t.actionCode="格式不正確（2~50，英數 + _-，且需以英數開頭）"):t.actionCode="動作代碼為必填",k?k.length>100&&(t.name="權限名稱長度不可超過 100"):t.name="權限名稱為必填",E&&E.length>500&&(t.description="說明長度不可超過 500");const P=Number(r.sortOrder);return Number.isNaN(P)?t.sortOrder="排序必須為數字":P<0?t.sortOrder="排序不可小於 0":Number.isInteger(P)||(t.sortOrder="排序必須為整數"),t},[r.name,r.description,r.sortOrder,g.systemCode,g.resourceCode,g.actionCode]),C=t=>m=>c(N=>({...N,[t]:m.target.value})),j=async t=>{t.preventDefault(),S(),!Object.keys(d).length&&await l({...r,systemCode:g.systemCode,resourceCode:g.resourceCode,actionCode:g.actionCode,name:$(r.name),description:te($(r.description)),enabled:!!r.enabled,sortOrder:Number(r.sortOrder)})};return e.jsxs("form",{onSubmit:j,className:"form",children:[e.jsxs("div",{className:"row g-6",children:[e.jsxs("div",{className:"col-12 col-lg-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:["系統代碼 ",e.jsx("span",{className:"text-danger",children:"*"})]}),x.length>0?e.jsx("select",{className:`form-select form-select-solid ${b("systemCode",d)}`,value:r.systemCode,onChange:t=>c(m=>({...m,systemCode:t.target.value.toUpperCase()})),onBlur:o("systemCode"),disabled:s||f,children:x.map(t=>e.jsxs("option",{value:t.code,children:[t.code,"（",t.name,"）"]},t.code))}):e.jsx("input",{className:`form-control form-control-solid ${b("systemCode",d)}`,placeholder:"例如：UPMS / TOM / ADM",value:r.systemCode,onChange:t=>c(m=>({...m,systemCode:t.target.value.toUpperCase()})),onBlur:o("systemCode"),disabled:s,autoFocus:!0}),e.jsx("div",{className:"form-text text-muted",children:x.length>0?"已從系統清單載入，可直接選擇":"尚未載入系統清單時可手動輸入；會自動轉大寫"}),n("systemCode",d)&&e.jsx("div",{className:"invalid-feedback",children:d.systemCode})]}),e.jsxs("div",{className:"col-12 col-lg-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:["資源代碼 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{className:`form-control form-control-solid ${b("resourceCode",d)}`,placeholder:"例如：USER / ROLE / PERMISSION / ORDER",value:r.resourceCode,onChange:t=>c(m=>({...m,resourceCode:t.target.value.toUpperCase()})),onBlur:o("resourceCode"),disabled:s}),n("resourceCode",d)&&e.jsx("div",{className:"invalid-feedback",children:d.resourceCode})]}),e.jsxs("div",{className:"col-12 col-lg-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:["動作代碼 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("select",{className:`form-select form-select-solid ${b("actionCode",d)}`,value:r.actionCode,onChange:t=>c(m=>({...m,actionCode:t.target.value.toUpperCase()})),onBlur:o("actionCode"),disabled:s,children:me.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),n("actionCode",d)&&e.jsx("div",{className:"invalid-feedback",children:d.actionCode})]}),e.jsxs("div",{className:"col-12 col-lg-6",children:[e.jsx("label",{className:"form-label fw-bold",children:"分組鍵（groupKey）"}),e.jsx("input",{className:"form-control form-control-solid",value:g.groupKey,readOnly:!0,disabled:!0}),e.jsxs("div",{className:"form-text text-muted",children:["自動組合：",e.jsx("code",{children:"SYSTEM_RESOURCE"})]})]}),e.jsxs("div",{className:"col-12 col-lg-6",children:[e.jsx("label",{className:"form-label fw-bold",children:"權限代碼（code）"}),e.jsx("input",{className:"form-control form-control-solid",value:g.code,readOnly:!0,disabled:!0}),e.jsxs("div",{className:"form-text text-muted",children:["自動組合：",e.jsx("code",{children:"SYSTEM_RESOURCE_ACTION"})]})]}),e.jsxs("div",{className:"col-12 col-lg-8",children:[e.jsxs("label",{className:"form-label fw-bold",children:["權限名稱 ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{className:`form-control form-control-solid ${b("name",d)}`,placeholder:"例如：使用者-查詢 / 訂單-建立 / 派遣-管理",value:r.name,onChange:C("name"),onBlur:o("name"),disabled:s}),n("name",d)&&e.jsx("div",{className:"invalid-feedback",children:d.name})]}),e.jsxs("div",{className:"col-12 col-lg-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"排序"}),e.jsx("input",{className:`form-control form-control-solid ${b("sortOrder",d)}`,type:"number",min:0,step:1,placeholder:"例如：0",value:r.sortOrder??0,onChange:t=>{const m=t.target.value,N=m===""?0:Number(m);c(w=>({...w,sortOrder:Number.isNaN(N)?w.sortOrder:Math.max(0,Math.trunc(N))}))},onBlur:o("sortOrder"),disabled:s}),n("sortOrder",d)&&e.jsx("div",{className:"invalid-feedback d-block",children:d.sortOrder})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:!!r.enabled,onChange:t=>c(m=>({...m,enabled:t.target.checked})),disabled:s}),e.jsx("label",{className:"form-check-label",children:"啟用"})]}),e.jsx("div",{className:"text-muted fs-8 mt-1",children:"停用後通常不允許授權（視後端規則）"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-bold",children:"說明"}),e.jsx("textarea",{className:`form-control form-control-solid ${b("description",d)}`,placeholder:"可留空（例如：提供後台列表查詢權限）",rows:3,value:r.description??"",onChange:C("description"),onBlur:o("description"),disabled:s}),n("description",d)&&e.jsx("div",{className:"invalid-feedback d-block",children:d.description})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-3 mt-10",children:[e.jsx("button",{type:"button",className:"btn btn-light",onClick:i,disabled:s,children:"取消"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s,children:"新增權限"})]})]})},B=s=>(s??"").trim(),he=s=>{const l=B(s);return l||void 0},q=s=>B(s).toUpperCase(),ue=s=>{const l=B(s);if(!l)return;const i=Number.parseInt(l,10);return Number.isFinite(i)?i:void 0},be=s=>({systemCode:q(s.systemCode),resourceCode:q(s.resourceCode),actionCode:q(s.actionCode),name:B(s.name),description:he(s.description),enabled:s.enabled??!0,sortOrder:typeof s.sortOrder=="number"?s.sortOrder:ue(String(s.sortOrder??""))}),je=()=>{const s=A(),{alert:l,showAlert:i,Alert:x}=L(),[p,f]=a.useState(!1),u=a.useCallback(()=>{s(-1)},[s]),r=a.useCallback(async c=>{f(!0);try{if(await W(be(c),i)){s("/upms/permission/list");return}}catch(o){console.error(o),i("系統發生錯誤，請稍後再試","danger")}finally{f(!1)}},[s,i]);return e.jsxs(F,{children:[l&&e.jsx(x,{message:l.message,type:l.type}),e.jsx(I,{title:"新增權限",breadcrumbs:[{label:"UPMS 權限管理",href:"#",active:!1},{label:"權限",active:!1},{label:"新增",active:!0}]}),e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx(xe,{submitting:p,onSubmit:r,onCancel:u})})})})]})},O=s=>s==null||s===""?"-":String(s),T=s=>s.trim(),R=(s,l=0)=>{const i=typeof s=="number"?s:Number(s);return Number.isNaN(i)?l:Math.trunc(i)},z=s=>{const l=T(s.name),i=T(s.description);return l?l.length>100?"權限名稱長度不可超過 100":i.length>500?"權限描述長度不可超過 500":Number.isFinite(s.sortOrder)?s.sortOrder<0?"排序不可小於 0":null:"排序必須為數字":"權限名稱不可為空"},pe=({detail:s,reload:l,showAlert:i})=>{const x=a.useMemo(()=>({name:s.name??"",description:s.description??"",enabled:s.enabled??!1,sortOrder:R(s.sortOrder,0)}),[s]),[p,f]=a.useState(!1),[u,r]=a.useState(!1),[c,o]=a.useState(x),S=a.useMemo(()=>T(c.name)!==T(x.name)||T(c.description)!==T(x.description)||!!c.enabled!=!!x.enabled||R(c.sortOrder,0)!==R(x.sortOrder,0),[c,x]),n=a.useMemo(()=>z(c),[c]);a.useEffect(()=>{p||o(x)},[x,p]);const b=()=>{o(x),f(!0)},g=()=>{o(x),f(!1)},d=async()=>{const j=z(c);if(j){i==null||i(j,"warning");return}if(!S){f(!1);return}r(!0);try{const t={name:T(c.name),description:T(c.description),enabled:!!c.enabled,sortOrder:R(c.sortOrder,0)};await Z(s.id,t),i==null||i("更新成功","success"),f(!1),await l()}catch(t){console.error(t),i==null||i("更新失敗，請稍後再試","danger")}finally{r(!1)}},C=s.enabled?e.jsx("span",{className:"badge badge-light-success",children:"啟用"}):e.jsx("span",{className:"badge badge-light-secondary",children:"停用"});return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header align-items-center",children:[e.jsx("div",{className:"card-title m-0",children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(y,{iconName:"information-4",className:"fs-2"}),e.jsx("h3",{className:"fw-bold m-0",children:"基本資訊"})]})}),e.jsx("div",{className:"card-toolbar",children:p?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:d,disabled:u||!!n||!S,title:S?n??"":"尚未修改",children:u?e.jsxs("span",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"spinner-border spinner-border-sm"}),"更新中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{iconName:"check",className:"fs-3 me-1"}),"更新"]})}),e.jsx("button",{type:"button",className:"btn btn-sm btn-light",onClick:g,disabled:u,children:"取消"})]}):e.jsxs("button",{type:"button",className:"btn btn-sm btn-light-primary",onClick:b,children:[e.jsx(y,{iconName:"pencil",className:"fs-3 me-1"}),"編輯"]})})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"table-responsive",children:e.jsx("table",{className:"table table-row-dashed table-row-gray-200 align-middle gs-0 gy-3",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted w-150px",children:"權限代碼"}),e.jsx("td",{className:"fw-semibold",children:e.jsx("span",{className:"badge badge-light text-gray-800",children:O(s.code)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"System"}),e.jsx("td",{className:"fw-semibold",children:e.jsx("span",{className:"badge badge-light text-gray-800",children:O(s.systemCode)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"Resource"}),e.jsx("td",{className:"fw-semibold",children:e.jsx("span",{className:"badge badge-light text-gray-800",children:O(s.resourceCode)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"Action"}),e.jsx("td",{className:"fw-semibold",children:e.jsx("span",{className:"badge badge-light text-gray-800",children:O(s.actionCode)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"分組鍵"}),e.jsx("td",{className:"fw-semibold",children:e.jsx("span",{className:"badge badge-light text-gray-800",children:O(s.groupKey)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"權限名稱"}),e.jsx("td",{className:"fw-semibold",children:p?e.jsx("input",{className:"form-control form-control-sm",value:c.name,onChange:j=>o(t=>({...t,name:j.target.value})),placeholder:"例如：使用者-查詢 / 訂單-建立",disabled:u,maxLength:100}):O(s.name)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"權限描述"}),e.jsx("td",{className:"fw-semibold",children:p?e.jsx("textarea",{className:"form-control form-control-sm",rows:3,value:c.description,onChange:j=>o(t=>({...t,description:j.target.value})),placeholder:"可留空",disabled:u,maxLength:500}):e.jsx("div",{className:"text-gray-800",style:{whiteSpace:"pre-wrap"},children:O(s.description)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"排序"}),e.jsx("td",{className:"fw-semibold",children:p?e.jsx("input",{className:"form-control form-control-sm",type:"number",min:0,step:1,value:c.sortOrder,onChange:j=>{const t=j.target.value,m=t===""?0:Number(t);o(N=>({...N,sortOrder:Number.isNaN(m)?N.sortOrder:Math.max(0,Math.trunc(m))}))},disabled:u}):O(s.sortOrder)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:"啟用狀態"}),e.jsx("td",{className:"fw-semibold",children:p?e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"form-check form-switch form-check-custom form-check-solid m-0",children:e.jsx("input",{className:"form-check-input",type:"checkbox",checked:!!c.enabled,onChange:j=>o(t=>({...t,enabled:j.target.checked})),disabled:u})}),e.jsx("span",{className:"text-muted fs-8",children:c.enabled?"啟用中（可被指派給角色）":"停用（保留資料，不建議硬刪）"})]}):C})]})]})})}),e.jsx("div",{className:"d-flex justify-content-between align-items-center mt-3",children:e.jsxs("div",{className:"text-muted fs-8",children:["UUID：",O(s.id)]})})]})]})},fe=()=>{const{id:s}=Q(),{alert:l,showAlert:i,Alert:x}=L(),[p,f]=a.useState(!0),[u,r]=a.useState(null),c=a.useCallback(async()=>{if(s){f(!0);try{const o=await J(s);r(o)}catch(o){console.error(o),i("取得權限詳情失敗","danger"),r(null)}finally{f(!1)}}},[s,i]);return a.useEffect(()=>{c()},[]),e.jsxs(F,{children:[l&&e.jsx(x,{message:l.message,type:l.type}),e.jsx(I,{title:"權限詳情",breadcrumbs:[{label:"權限管理",href:"#"},{label:"權限",active:!1},{label:"詳情",active:!0}]}),e.jsx("div",{className:"app-container container-fluid",children:p?e.jsx("div",{className:"d-flex justify-content-center py-10",children:e.jsx(le,{animation:"border"})}):u?e.jsxs("div",{className:"row g-6",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsx(pe,{detail:u,reload:c})}),e.jsx("div",{className:"col-12 col-lg-6"}),e.jsx("div",{className:"col-12 col-lg-6"}),e.jsx("div",{className:"col-12 col-lg-6"})]}):e.jsx("div",{className:"text-center py-10 text-muted",children:"查無權限資料"})})]})},U=[{title:"權限管理",path:"/upms/permission/list",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],fs=()=>e.jsxs(X,{children:[e.jsx(M,{path:"overview",element:e.jsxs(e.Fragment,{children:[e.jsx(D,{breadcrumbs:U,children:"權限總覽"}),e.jsx(re,{})]})}),e.jsx(M,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(D,{breadcrumbs:U,children:"權限列表"}),e.jsx(oe,{})]})}),e.jsx(M,{path:"create",element:e.jsxs(e.Fragment,{children:[e.jsx(D,{breadcrumbs:U,children:"新增權限"}),e.jsx(je,{})]})}),e.jsx(M,{path:":id/detail",element:e.jsxs(e.Fragment,{children:[e.jsx(D,{breadcrumbs:U,children:"權限詳情"}),e.jsx(fe,{})]})})]});export{fs as default};
